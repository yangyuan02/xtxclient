!function(){"use strict";var videoPlayer=angular.module("angular-chat",["ChatModel"]);videoPlayer.directive("chatBox",["$rootScope","$templateCache","$compile","$stateParams","$location","ChatModel","CommonProvider","appConfig",function($rootScope,$templateCache,$compile,$stateParams,$location,ChatModel,CommonProvider,appConfig){return{restrict:"A",replace:!0,scope:{roomid:"=roomId",isPlayback:"=isPlayback"},templateUrl:"partials/home/course/chatbox.html",link:function($scope,element,attrs){if($scope.messages=[],$scope.historys=[],$scope.section=$stateParams.section_id||!1,$scope.room={id:$scope.roomid,user:$rootScope.user,uid:$rootScope.user.id,pwd:$rootScope.user.phone,playback:$scope.isPlayback||!1,faces:Easemob.im.EMOTIONS,logined:!1,occupants:[],error:!1},$scope.chat={content:"",emotion:{show:!1},pictype:["jpg","gif","png","bmp"],notification:!1},$scope.imagePreview=function(image){return $rootScope.modal.imagePreview(image)},!$scope.room.id||!$scope.room.uid||!$scope.room.pwd){if($scope.room.playback||($scope.room.error=!0),$scope.room.playback){$scope.messages.push({msg_type:"status",content:"历史讨论记录"});var getMoreHistory=function(params){var params=params||{};CommonProvider.promise({model:ChatModel,method:"message",params:{section_id:$scope.section,page:params.page||1,per_page:10},success:function(messages){0==messages.pagination.total&&$scope.messages.push({msg_type:"status",content:"无历史讨论"}),$scope.historys=messages;for(var current_user,messages=messages.result,occupants=angular.copy($scope.room.occupants),i=0;i<messages.length;i++)current_user=Number(messages[i].from),$scope.room.occupants.contain(current_user)||$scope.room.occupants.push(current_user),messages[i].date=messages[i].ext.weichat.date||moment(messages[i].send_time).format("YYYY-MM-DD HH:mm:ss"),"txt"==messages[i].msg_type&&(messages[i].data=Easemob.im.Utils.parseLink(Easemob.im.Utils.parseEmotions(messages[i].msg))),"img"==messages[i].msg_type&&(messages[i].url=appConfig.fileUrl+messages[i].url,messages[i].data='<a href="" onclick="angular.element(this).scope().imagePreview(\''+messages[i].url+'\');return false;"><img src="'+messages[i].url+'"></a>');occupants.toString()!=$scope.room.occupants.toString()&&$scope.room.occupants.length&&$scope.$emit("chatRoomUserChanged",$scope.room.occupants),$scope.messages=$scope.messages.concat(messages)}})};getMoreHistory(),$("#J_chat_lists").scroll(function(){if(this.scrollTop+this.offsetHeight>=this.scrollHeight){var historys=$scope.historys;if(historys.pagination.current_page<historys.pagination.total_page)getMoreHistory({page:historys.pagination.current_page+1});else{if("status"==$scope.messages.last().msg_type)return!1;$scope.$apply(function(){$scope.messages.push({msg_type:"status",content:"没有更多记录"})})}}})}return!1}var emitOccupants=function(){var occupants=$scope.room.occupants;occupants.length&&$scope.$emit("chatRoomUserChanged",occupants)};$("body").click(function(event){var is_emotion_box="J_emotion_box"==$(event.toElement).attr("id")||$(event.toElement).hasClass("chat-tool-btn")||$(event.toElement).hasClass("icon")||$(event.toElement).parents("#J_emotion_box").length>0;!is_emotion_box&&$scope.chat.emotion.show&&$scope.$apply(function(){$scope.chat.emotion.show=!1})}),$scope.authorizeNotification=function(){Notification.requestPermission(function(permission){$scope.chat.notification=permission})},$scope.showNotification=function(message){if("granted"!=$scope.chat.notification)return!1;if(message.from==$scope.room.uid)return!1;new Notification("收到来自学天下直播室的新消息",{dir:"auto",lang:"",body:message.msg||message.content||(0==message.data.indexOf("<img")?"[表情]":"<"==message.data[0]?"[图片]":message.data),tag:message})},$scope.addEmotion=function(key){$scope.chat.content+=key,$scope.chat.emotion.show=!1};var conn=new Easemob.im.Connection({multiResources:Easemob.im.config.multiResources,https:Easemob.im.config.https,url:Easemob.im.config.xmppURL}),login=function(){conn.open({user:$scope.room.uid.toString(),pwd:$scope.room.pwd,appKey:"xuetianxia#xuetianxia-chat"})};login();var appendMsgTimer,logout=function(){conn.close(),conn.clear()},joinRoom=function(){conn.joinChatRoom({roomId:$scope.room.id}),queryOccupants()},queryOccupants=function(){conn.queryRoomOccupants({roomId:$scope.room.id,success:function(members){var occupants=[];if(members)for(var i=0;i<members.length;i++){var jid=members[i].jid;jid=jid.right(jid.length-jid.find("easemob.com/")),occupants.push(Number(jid))}$scope.room.occupants=occupants,emitOccupants()}})},appendMsg=function(message){$scope.messages.push(message);var listAutoToBottom=function(){$scope.showNotification(message);var $lists=$("#J_chat_lists");$lists[0]&&$lists[0].scrollHeight&&$lists.animate({scrollTop:$lists[0].scrollHeight},"slow")};return appendMsgTimer&&clearTimeout(appendMsgTimer),message.click?appendMsgTimer=setTimeout(listAutoToBottom,300):void(appendMsgTimer=setTimeout(listAutoToBottom,800))},appendStatusMsg=function(message){appendMsg({content:message,msg_type:"status"})};$scope.sendTextMessage=function(msg){if(!msg)return!1;var message={to:$scope.room.id,msg:msg,ext:{weichat:{date:moment().format("YYYY-MM-DD HH:mm:ss"),user:{name:$scope.room.user.name,gravatar:$scope.room.user.gravatar}}},type:"groupchat",roomType:"chatroom"};conn.sendTextMessage(message),message.data=Easemob.im.Utils.parseLink(Easemob.im.Utils.parseEmotions(msg)),message.date=message.ext.weichat.date||moment().format("YYYY-MM-DD HH:mm:ss"),message.from=$scope.room.uid,message.click=!0,$scope.chat.content="",appendMsg(message)},$scope.sendPicMessage=function(){var fileObj=Easemob.im.Helper.getFileUrl("J_emotion_pic");if(Easemob.im.Helper.isCanUploadFileAsync&&(null==fileObj.url||""==fileObj.url))return console.warn("未选择图片");var filetype=fileObj.filetype,filename=fileObj.filename;if(!Easemob.im.Helper.isCanUploadFileAsync||$scope.chat.pictype.contain(filetype)){var options={type:"groupchat",roomType:"chatroom",to:$scope.room.id,ext:{weichat:{date:moment().format("YYYY-MM-DD HH:mm:ss"),user:{name:$scope.room.user.name,gravatar:$scope.room.user.gravatar}}},fileInputId:"J_emotion_pic",filename:filename,apiUrl:Easemob.im.config.apiURL,onFileUploadError:function(error){console.log(error)},onFileUploadComplete:function(data){var img_src=fileObj.url||data.uri+"/"+data.entities[0].uuid,send_date=data.timestamp?moment(data.timestamp).format("YYYY-MM-DD HH:mm:ss"):moment().format("YYYY-MM-DD HH:mm:ss");appendMsg({click:!0,type:"groupchat",roomType:"chatroom",from:$scope.room.uid,to:$scope.room.id,data:'<a href="" onclick="angular.element(this).scope().imagePreview(\''+img_src+'\');return false;"><img src="'+img_src+'"></a>',date:send_date,ext:{weichat:{date:send_date,user:{name:$scope.room.user.name,gravatar:$scope.room.user.gravatar}}}}),$scope.$apply()}};conn.sendPicture(options)}else $rootScope.modal.error({message:"不支持此图片类型"+filetype,info:"图片格式不支持"})};var handleTextMessage=function(message){var new_msg=angular.copy(message);$scope.$apply(function(){new_msg.ext=new_msg.ext||{},new_msg.ext.weichat=new_msg.ext.weichat||{},new_msg.date=new_msg.ext.weichat.date||moment().format("YYYY-MM-DD HH:mm:ss");var message_content=new_msg.data,new_message_content="";if("string"!=typeof message_content)for(var i=0;i<message_content.length;i++){var msg=message_content[i],type=msg.type,data=msg.data;switch(type){case"emotion":new_message_content+='<img src="'+data+'"/>';break;case"pic":case"audio":case"video":break;case"txt":new_message_content+=data;break;default:new_message_content+=data}}else new_message_content+=message_content;new_msg.data=new_message_content,appendMsg(new_msg)})},handlePicMessage=function(_message){var message={};message.ext=_message.ext||{},message.ext.weichat=message.ext.weichat||{},message.date=message.ext.weichat.date||moment().format("YYYY-MM-DD HH:mm:ss"),message.data='<a href="" onclick="angular.element(this).scope().imagePreview(\''+_message.url+'\');return false;"><img src="'+_message.url+'"></a>',message.from=_message.from,message.to=_message.to,message.type="groupchat",message.roomType="chatroom",appendMsg(message),$scope.$apply()};$("#J_chat_textarea").keydown(function(event){if((event.altKey||event.ctrlKey||event.shiftKey)&&13==event.keyCode)event.returnValue=!0;else if(13==event.keyCode)return event.returnValue=!1,$scope.$apply(function(){$scope.sendTextMessage($scope.chat.content)}),!1}),conn.listen({onOpened:function(){$scope.room.logined=!0,appendStatusMsg("服务器连接成功"),conn.setPresence(),conn.isOpened()&&conn.heartBeat(conn),joinRoom()},onClosed:function(){appendStatusMsg("连接关闭")},onTextMessage:function(message){handleTextMessage(message)},onEmotionMessage:function(message){handleTextMessage(message)},onPictureMessage:function(message){handlePicMessage(message)},onAudioMessage:function(message){},onLocationMessage:function(message){},onFileMessage:function(message){},onVideoMessage:function(message){},onPresence:function(message){var jid=message.fromJid;jid=jid.right(jid.length-jid.find("easemob.com/"));var originUid=Number(jid);originUid&&!$scope.room.occupants.contain(originUid)&&($scope.room.occupants.push(originUid),emitOccupants());var msg=jid==$scope.room.uid?"加入聊天室成功":"新用户加入聊天室";appendStatusMsg(msg)},onRoster:function(message){},onInviteMessage:function(message){},onError:function(err){appendStatusMsg(err.msg),1==err.type&&login()}}),$(window).bind("beforeunload",function(){conn&&logout()}),$scope.$on("$locationChangeStart",function(){conn&&logout()})}}}])}(),function(angular){var Module=angular.module("datePicker",[]);Module.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5}),Module.filter("mFormat",function(){return function(m,format,tz){return moment.isMoment(m)?tz?moment.tz(m,tz).format(format):m.format(format):moment(m).format(format)}}),Module.directive("datePicker",["datePickerConfig","datePickerUtils",function(datePickerConfig,datePickerUtils){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(scope,element,attrs,ngModel){function prepareViews(){scope.views=datePickerConfig.views.concat(),scope.view=attrs.view||datePickerConfig.view,scope.views=scope.views.slice(scope.views.indexOf(attrs.maxView||"year"),scope.views.indexOf(attrs.minView||"minutes")+1),1!==scope.views.length&&-1!==scope.views.indexOf(scope.view)||(scope.view=scope.views[0])}function getDate(name){return datePickerUtils.getDate(scope,attrs,name)}datePickerUtils.setParams(attrs.timezone);var arrowClick=!1,tz=scope.tz=attrs.timezone,createMoment=datePickerUtils.createMoment,eventIsForPicker=datePickerUtils.eventIsForPicker,step=parseInt(attrs.step||datePickerConfig.step,10),partial=!!attrs.partial,minDate=getDate("minDate"),maxDate=getDate("maxDate"),pickerID=element[0].id,now=scope.now=createMoment(),selected=scope.date=createMoment(scope.model||now),autoclose="true"===attrs.autoClose;scope.model||selected.minute(Math.ceil(selected.minute()/step)*step).second(0),scope.template=attrs.template||datePickerConfig.template,scope.watchDirectChanges=void 0!==attrs.watchDirectChanges,scope.callbackOnSetDate=attrs.dateChange?datePickerUtils.findFunction(scope,attrs.dateChange):void 0,prepareViews(),scope.setView=function(nextView){-1!==scope.views.indexOf(nextView)&&(scope.view=nextView)},scope.selectDate=function(date){if(attrs.disabled)return!1;if(isSame(scope.date,date)&&(date=scope.date),date=clipDate(date),!date)return!1;scope.date=date;var nextView=scope.views[scope.views.indexOf(scope.view)+1];(!nextView||partial||scope.model)&&setDate(date),nextView?scope.setView(nextView):autoclose?(element.addClass("hidden"),scope.$emit("hidePicker")):prepareViewData()};function setDate(date){date&&(scope.model=date,ngModel&&ngModel.$setViewValue(date)),scope.$emit("setDate",scope.model,scope.view),scope.callbackOnSetDate&&scope.callbackOnSetDate(attrs.datePicker,scope.date)}function update(){var view=scope.view;datePickerUtils.setParams(tz),scope.model&&!arrowClick&&(scope.date=createMoment(scope.model),arrowClick=!1);var date=scope.date;switch(view){case"year":scope.years=datePickerUtils.getVisibleYears(date);break;case"month":scope.months=datePickerUtils.getVisibleMonths(date);break;case"date":scope.weekdays=scope.weekdays||datePickerUtils.getDaysOfWeek(),scope.weeks=datePickerUtils.getVisibleWeeks(date);break;case"hours":scope.hours=datePickerUtils.getVisibleHours(date);break;case"minutes":scope.minutes=datePickerUtils.getVisibleMinutes(date,step)}prepareViewData()}function watch(){return"date"!==scope.view?scope.view:scope.date?scope.date.month():null}scope.$watch(watch,update),scope.watchDirectChanges&&scope.$watch("model",function(){arrowClick=!1,update()});function prepareViewData(){var i,j,view=scope.view,date=scope.date,classes=[],classList="";if(datePickerUtils.setParams(tz),"date"===view){var week,weeks=scope.weeks;for(i=0;i<weeks.length;i++)for(week=weeks[i],classes.push([]),j=0;j<week.length;j++)classList="",datePickerUtils.isSameDay(date,week[j])&&(classList+="active"),isNow(week[j],view)&&(classList+=" now"),week[j].month()===date.month()&&inValidRange(week[j])||(classList+=" disabled"),classes[i].push(classList)}else{var params=datePickerConfig.viewConfig[view],dates=scope[params[0]],compareFunc=params[1];for(i=0;i<dates.length;i++)classList="",datePickerUtils[compareFunc](date,dates[i])&&(classList+="active"),isNow(dates[i],view)&&(classList+=" now"),inValidRange(dates[i])||(classList+=" disabled"),classes.push(classList)}scope.classes=classes}scope.next=function(delta){var date=moment(scope.date);switch(delta=delta||1,scope.view){case"year":case"month":date.year(date.year()+delta);break;case"date":date.month(date.month()+delta);break;case"hours":case"minutes":date.hours(date.hours()+delta)}date=clipDate(date),date&&(scope.date=date,setDate(date),arrowClick=!0,update())};function inValidRange(date){var valid=!0;return minDate&&minDate.isAfter(date)&&(valid=isSame(minDate,date)),maxDate&&maxDate.isBefore(date)&&(valid&=isSame(maxDate,date)),valid}function isSame(date1,date2){return!!date1.isSame(date2,datePickerConfig.momentNames[scope.view])}function clipDate(date){return minDate&&minDate.isAfter(date)?minDate:maxDate&&maxDate.isBefore(date)?maxDate:date}function isNow(date,view){var is=!0;switch(view){case"minutes":is&=~~(now.minutes()/step)===~~(date.minutes()/step);case"hours":is&=now.hours()===date.hours();case"date":is&=now.date()===date.date();case"month":is&=now.month()===date.month();case"year":is&=now.year()===date.year()}return is}scope.prev=function(delta){return scope.next(-delta||-1)},pickerID&&scope.$on("pickerUpdate",function(event,pickerIDs,data){if(eventIsForPicker(pickerIDs,pickerID)){var updateViews=!1,updateViewData=!1;angular.isDefined(data.minDate)&&(minDate=data.minDate?data.minDate:!1,updateViewData=!0),angular.isDefined(data.maxDate)&&(maxDate=data.maxDate?data.maxDate:!1,updateViewData=!0),angular.isDefined(data.minView)&&(attrs.minView=data.minView,updateViews=!0),angular.isDefined(data.maxView)&&(attrs.maxView=data.maxView,updateViews=!0),attrs.view=data.view||attrs.view,updateViews&&prepareViews(),updateViewData&&update()}})}}}]),angular.module("datePicker").factory("datePickerUtils",function(){var tz,createNewDate=function(year,month,day,hour,minute){var utc=Date.UTC(0|year,0|month,0|day,0|hour,0|minute);return tz?moment.tz(utc,tz):moment(utc)};return{getVisibleMinutes:function(m,step){var pushedDate,minute,year=m.year(),month=m.month(),day=m.date(),hour=m.hours(),offset=m.utcOffset()/60,minutes=[];for(minute=0;60>minute;minute+=step)pushedDate=createNewDate(year,month,day,hour-offset,minute),minutes.push(pushedDate);return minutes},getVisibleWeeks:function(m){m=moment(m);var startYear=m.year(),startMonth=m.month();m.date(1);var day=m.day();0===day?m.date(-5):m.date(m.date()-day),1===m.date()&&m.date(-6);for(var weeks=[];weeks.length<6&&!(m.year()===startYear&&m.month()>startMonth);)weeks.push(this.getDaysOfWeek(m)),m.add(7,"d");return weeks},getVisibleYears:function(d){var m=moment(d),year=m.year();m.year(year-year%10),year=m.year();for(var pushedDate,actualOffset,offset=m.utcOffset()/60,years=[],i=0;12>i;i++)pushedDate=createNewDate(year,0,1,0-offset),actualOffset=pushedDate.utcOffset()/60,actualOffset!==offset&&(pushedDate=createNewDate(year,0,1,0-actualOffset),offset=actualOffset),years.push(pushedDate),year++;return years},getDaysOfWeek:function(m){m=m?m:tz?moment.tz(tz).day(0):moment().day(0);for(var pushedDate,actualOffset,year=m.year(),month=m.month(),day=m.date(),days=[],offset=m.utcOffset()/60,i=0;7>i;i++)pushedDate=createNewDate(year,month,day,0-offset,0,!1),actualOffset=pushedDate.utcOffset()/60,actualOffset!==offset&&(pushedDate=createNewDate(year,month,day,0-actualOffset,0,!1)),days.push(pushedDate),day++;return days},getVisibleMonths:function(m){for(var pushedDate,actualOffset,year=m.year(),offset=m.utcOffset()/60,months=[],month=0;12>month;month++)pushedDate=createNewDate(year,month,1,0-offset,0,!1),actualOffset=pushedDate.utcOffset()/60,actualOffset!==offset&&(pushedDate=createNewDate(year,month,1,0-actualOffset,0,!1)),months.push(pushedDate);return months},getVisibleHours:function(m){var hour,pushedDate,actualOffset,year=m.year(),month=m.month(),day=m.date(),hours=[],offset=m.utcOffset()/60;for(hour=0;24>hour;hour++)pushedDate=createNewDate(year,month,day,hour-offset,0,!1),actualOffset=pushedDate.utcOffset()/60,actualOffset!==offset&&(pushedDate=createNewDate(year,month,day,hour-actualOffset,0,!1)),hours.push(pushedDate);return hours},isAfter:function(model,date){return model&&model.unix()>=date.unix()},isBefore:function(model,date){return model.unix()<=date.unix()},isSameYear:function(model,date){return model&&model.year()===date.year()},isSameMonth:function(model,date){return this.isSameYear(model,date)&&model.month()===date.month()},isSameDay:function(model,date){return this.isSameMonth(model,date)&&model.date()===date.date()},isSameHour:function(model,date){return this.isSameDay(model,date)&&model.hours()===date.hours()},isSameMinutes:function(model,date){return this.isSameHour(model,date)&&model.minutes()===date.minutes()},setParams:function(zone){tz=zone},findFunction:function(scope,name){var parentScope=scope;do if(parentScope=parentScope.$parent,angular.isFunction(parentScope[name]))return parentScope[name];while(parentScope.$parent);return!1},findParam:function(scope,name){var parentScope=scope;do if(parentScope=parentScope.$parent,parentScope[name])return parentScope[name];while(parentScope.$parent);return!1},createMoment:function(m){return tz?moment.tz(m,tz):moment.isMoment(m)?moment.unix(m.unix()):moment(m)},getDate:function(scope,attrs,name){var result=!1;return attrs[name]&&(result=this.createMoment(attrs[name]),result.isValid()||(result=this.findParam(scope,attrs[name]),result&&(result=this.createMoment(result)))),result},eventIsForPicker:function(targetIDs,pickerID){return angular.isArray(targetIDs)&&targetIDs.indexOf(pickerID)>-1||targetIDs===pickerID}}});var Module=angular.module("datePicker");Module.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function($compile,datePickerUtils,dateTimeConfig){function getTemplate(attrs,id,model,min,max){return dateTimeConfig.template(angular.extend(attrs,{ngModel:model,minDate:min&&moment.isMoment(min)?min.format():!1,maxDate:max&&moment.isMoment(max)?max.format():!1}),id)}function randomName(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(scope,element,attrs){var dateChange=null,pickerRangeID=element[0].id,pickerIDs=[randomName(),randomName()],createMoment=datePickerUtils.createMoment,eventIsForPicker=datePickerUtils.eventIsForPicker;scope.dateChange=function(modelName,newDate){dateChange&&dateChange(modelName,newDate)};function setMax(date){scope.$broadcast("pickerUpdate",pickerIDs[0],{maxDate:date})}function setMin(date){scope.$broadcast("pickerUpdate",pickerIDs[1],{minDate:date})}pickerRangeID&&scope.$on("pickerUpdate",function(event,targetIDs,data){eventIsForPicker(targetIDs,pickerRangeID)&&scope.$broadcast("pickerUpdate",pickerIDs,data)}),datePickerUtils.setParams(attrs.timezone),scope.start=createMoment(scope.start),scope.end=createMoment(scope.end),scope.$watchGroup(["start","end"],function(dates){setMin(dates[0]),setMax(dates[1])}),angular.isDefined(attrs.dateChange)&&(dateChange=datePickerUtils.findFunction(scope,attrs.dateChange)),attrs.onSetDate="dateChange";var template='<div><table><tr><td valign="top">'+getTemplate(attrs,pickerIDs[0],"start",!1,scope.end)+'</td><td valign="top">'+getTemplate(attrs,pickerIDs[1],"end",scope.start,!1)+"</td></tr></table></div>",picker=$compile(template)(scope);element.append(picker)}}}]);var PRISTINE_CLASS="ng-pristine",DIRTY_CLASS="ng-dirty",Module=angular.module("datePicker");Module.constant("dateTimeConfig",{template:function(attrs,id){return"<div "+(id?'id="'+id+'" ':"")+'date-picker="'+attrs.ngModel+'" '+(attrs.view?'view="'+attrs.view+'" ':"")+(attrs.maxView?'max-view="'+attrs.maxView+'" ':"")+(attrs.maxDate?'max-date="'+attrs.maxDate+'" ':"")+(attrs.autoClose?'auto-close="'+attrs.autoClose+'" ':"")+(attrs.template?'template="'+attrs.template+'" ':"")+(attrs.minView?'min-view="'+attrs.minView+'" ':"")+(attrs.minDate?'min-date="'+attrs.minDate+'" ':"")+(attrs.partial?'partial="'+attrs.partial+'" ':"")+(attrs.step?'step="'+attrs.step+'" ':"")+(attrs.onSetDate?'date-change="'+attrs.onSetDate+'" ':"")+(attrs.ngModel?'ng-model="'+attrs.ngModel+'" ':"")+(attrs.timezone?'timezone="'+attrs.timezone+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),Module.directive("dateTimeAppend",function(){return{link:function(scope,element){element.bind("click",function(){element.find("input")[0].focus()})}}}),Module.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function($compile,$document,$filter,dateTimeConfig,$parse,datePickerUtils){var body=$document.find("body"),dateFilter=$filter("mFormat");return{require:"ngModel",scope:!0,link:function(scope,element,attrs,ngModel){var template,format=attrs.format||dateTimeConfig.format,parentForm=element.inheritedData("$formController"),views=$parse(attrs.views)(scope)||dateTimeConfig.views.concat(),view=attrs.view||views[0],index=views.indexOf(view),dismiss=attrs.autoClose?$parse(attrs.autoClose)(scope):dateTimeConfig.autoClose,picker=null,pickerID=element[0].id,position=attrs.position||dateTimeConfig.position,container=null,minDate=null,minValid=null,maxDate=null,maxValid=null,timezone=attrs.timezone||!1,eventIsForPicker=datePickerUtils.eventIsForPicker,dateChange=null,shownOnce=!1;-1===index&&views.splice(index,1),views.unshift(view);function formatter(value){return dateFilter(value,format,timezone)}function parser(viewValue){return viewValue.length===format.length?viewValue:void 0}function setMin(date){minDate=date,attrs.minDate=date?date.format():date,minValid=moment.isMoment(date)}function setMax(date){maxDate=date,attrs.maxDate=date?date.format():date,maxValid=moment.isMoment(date)}ngModel.$formatters.push(formatter),ngModel.$parsers.unshift(parser),angular.isDefined(attrs.minDate)&&(setMin(datePickerUtils.findParam(scope,attrs.minDate)),ngModel.$validators.min=function(value){return minValid?moment.isMoment(value)&&(minDate.isSame(value)||minDate.isBefore(value)):!0}),angular.isDefined(attrs.maxDate)&&(setMax(datePickerUtils.findParam(scope,attrs.maxDate)),ngModel.$validators.max=function(value){return maxValid?moment.isMoment(value)&&(maxDate.isSame(value)||maxDate.isAfter(value)):!0}),angular.isDefined(attrs.dateChange)&&(dateChange=datePickerUtils.findFunction(scope,attrs.dateChange));function getTemplate(){template=dateTimeConfig.template(attrs)}function updateInput(event){event.stopPropagation(),ngModel.$pristine&&(ngModel.$dirty=!0,ngModel.$pristine=!1,element.removeClass(PRISTINE_CLASS).addClass(DIRTY_CLASS),parentForm&&parentForm.$setDirty(),ngModel.$render())}function clear(){picker&&(picker.remove(),picker=null),container&&(container.remove(),container=null)}pickerID&&scope.$on("pickerUpdate",function(event,pickerIDs,data){if(eventIsForPicker(pickerIDs,pickerID))if(picker);else{var validateRequired=!1;angular.isDefined(data.minDate)&&(setMin(data.minDate),validateRequired=!0),angular.isDefined(data.maxDate)&&(setMax(data.maxDate),validateRequired=!0),angular.isDefined(data.minView)&&(attrs.minView=data.minView),angular.isDefined(data.maxView)&&(attrs.maxView=data.maxView),attrs.view=data.view||attrs.view,validateRequired&&ngModel.$validate(),angular.isDefined(data.format)&&(format=attrs.format=data.format||dateTimeConfig.format,ngModel.$modelValue=-1),getTemplate()}});function showPicker(){if(!picker){if(picker=$compile(template)(scope),scope.$digest(),shownOnce||(scope.$on("setDate",function(event,date,view){updateInput(event),dateChange&&dateChange(attrs.ngModel,date),dismiss&&views[views.length-1]===view&&clear()}),scope.$on("hidePicker",function(){element.triggerHandler("blur")}),scope.$on("$destroy",clear),shownOnce=!0),"absolute"===position){var pos=angular.extend(element.offset(),{height:element[0].offsetHeight});picker.css({top:pos.top+pos.height,left:pos.left,display:"block",position:position}),body.append(picker)}else container=angular.element("<div date-picker-wrapper></div>"),element[0].parentElement.insertBefore(container[0],element[0]),container.append(picker),picker.css({top:element[0].offsetHeight+"px",display:"block"});picker.bind("mousedown",function(evt){evt.preventDefault()})}}element.bind("focus",showPicker),element.bind("blur",clear),getTemplate()}}}]),angular.module("datePicker").run(["$templateCache",function($templateCache){$templateCache.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div ng-switch-when="date" class="no-animation">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()"><i class="icon icon-arrow-left"></i></th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|mFormat:\'YYYY MMMM\':tz"></th>\r\n        <th ng-click="next()"><i class="icon icon-arrow-right"></i></th>\r\n      </tr>\r\n      <tr>\r\n        <th ng-repeat="day in weekdays" style="overflow: hidden" class="no-animation" ng-bind="day|mFormat:\'ddd\':tz"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr ng-repeat="week in weeks" ng-init="$index2 = $index" class="no-animation">\r\n        <td ng-repeat="day in week" class="no-animation">\r\n          <span\r\n            ng-class="classes[$index2][$index]"\r\n            ng-click="selectDate(day)" ng-bind="day|mFormat:\'DD\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="year" class="no-animation">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(10)"><i class="icon icon-arrow-left"></i></th>\r\n        <th colspan="5" class="switch"ng-bind="years[0].year()+\' - \'+years[years.length-1].year()"></th>\r\n        <th ng-click="next(10)"><i class="icon icon-arrow-right"></i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="classes[$index]"\r\n                ng-repeat="year in years"\r\n                ng-click="selectDate(year)" ng-bind="year.year()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="month" class="no-animation">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()"><i class="icon icon-arrow-left"></i></th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|mFormat:\'YYYY\':tz"></th>\r\n        <th ng-click="next()"><i class="icon icon-arrow-right"></i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(month)"\r\n                ng-bind="month|mFormat:\'MMM\':tz" class="no-animation"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="hours" class="no-animation">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(24)"><i class="icon icon-arrow-left"></i></th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n        <th ng-click="next(24)"><i class="icon icon-arrow-right"></i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(hour)" ng-bind="hour|mFormat:\'HH:mm\':tz" class="no-animation"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="minutes" class="no-animation">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()"><i class="icon icon-arrow-left"></i></th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n        <th ng-click="next()"><i class="icon icon-arrow-right"></i></i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(minute)"\r\n                ng-bind="minute|mFormat:\'HH:mm\':tz" class="no-animation"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>')}])}(angular),angular.module("angular.lazyImage",[]),angular.module("angular.lazyImage").service("afklSrcSetService",["$window","$timeout",function($window,$timeout){"use strict";var INT_REGEXP=/^[0-9]+$/;function ImageInfo(options){this.src=options.src,this.w=options.w||1/0,this.h=options.h||1/0,this.x=options.x||1}var _parseDescriptors=function(descString){for(var descriptors=descString.split(/\s/),out={},i=0,l=descriptors.length;l>i;i++){var desc=descriptors[i];if(desc.length>0){var lastChar=desc.slice(-1),value=desc.substring(0,desc.length-1),intVal=parseInt(value,10),floatVal=parseFloat(value);value.match(INT_REGEXP)&&"w"===lastChar?out[lastChar]=intVal:value.match(INT_REGEXP)&&"h"===lastChar?out[lastChar]=intVal:isNaN(floatVal)||"x"!==lastChar||(out[lastChar]=floatVal)}}return out},_getBestCandidateIf=function(images,criteriaFn){for(var bestCandidate=images[0],i=0,l=images.length;l>i;i++){var candidate=images[i];criteriaFn(candidate,bestCandidate)&&(bestCandidate=candidate)}return bestCandidate},_removeCandidatesIf=function(images,criteriaFn){for(var i=images.length-1;i>=0;i--){var candidate=images[i];criteriaFn(candidate)&&images.splice(i,1)}return images},getBestImage=function(imageCandidates,view){if(imageCandidates){view||(view={w:$window.innerWidth||document.documentElement.clientWidth,h:$window.innerHeight||document.documentElement.clientHeight,x:$window.devicePixelRatio||1});var images=imageCandidates.slice(0),largestWidth=_getBestCandidateIf(images,function(a,b){return a.w>b.w});_removeCandidatesIf(images,function(){return function(a){return a.w<view.w}}(this)),0===images.length&&(images=[largestWidth]);var largestHeight=_getBestCandidateIf(images,function(a,b){return a.h>b.h});_removeCandidatesIf(images,function(){return function(a){return a.h<view.h}}(this)),0===images.length&&(images=[largestHeight]);var largestPxDensity=_getBestCandidateIf(images,function(a,b){return a.x>b.x;
});_removeCandidatesIf(images,function(){return function(a){return a.x<view.x}}(this)),0===images.length&&(images=[largestPxDensity]);var smallestWidth=_getBestCandidateIf(images,function(a,b){return a.w<b.w});_removeCandidatesIf(images,function(a){return a.w>smallestWidth.w});var smallestHeight=_getBestCandidateIf(images,function(a,b){return a.h<b.h});_removeCandidatesIf(images,function(a){return a.h>smallestHeight.h});var smallestPxDensity=_getBestCandidateIf(images,function(a,b){return a.x<b.x});return _removeCandidatesIf(images,function(a){return a.x>smallestPxDensity.x}),images[0]}},getSrcset=function(options){var imageCandidates=[],srcValue=options.src,srcsetValue=options.srcset;if(srcsetValue){var _addCandidate=function(img){for(var j=0,ln=imageCandidates.length;ln>j;j++){var existingCandidate=imageCandidates[j];if(existingCandidate.x===img.x&&existingCandidate.w===img.w&&existingCandidate.h===img.h)return}imageCandidates.push(img)},_parse=function(){for(var url,descriptors,input=srcsetValue,position=0,rawCandidates=[];""!==input;){for(;" "===input.charAt(0);)input=input.slice(1);position=input.indexOf(" "),-1!==position?(url=input.slice(0,position),input=input.slice(position+1),position=input.indexOf(","),-1===position?(descriptors=input,input=""):(descriptors=input.slice(0,position),input=input.slice(position+1)),rawCandidates.push({url:url,descriptors:descriptors})):(rawCandidates.push({url:input,descriptors:""}),input="")}for(var i=0,l=rawCandidates.length;l>i;i++){var candidate=rawCandidates[i],desc=_parseDescriptors(candidate.descriptors);_addCandidate(new ImageInfo({src:candidate.url,x:desc.x,w:desc.w,h:desc.h}))}srcValue&&_addCandidate(new ImageInfo({src:srcValue}))};_parse();var bestImage=getBestImage(imageCandidates),object={best:bestImage,candidates:imageCandidates};return imageCandidates=null,object}};function debounce(call,delay){var preventCalls=!1;return function(){preventCalls||(call(),preventCalls=!0,$timeout(function(){preventCalls=!1},delay))}}return{get:getSrcset,image:getBestImage,debounce:debounce}}]),angular.module("angular.lazyImage").directive("afklImageContainer",function(){"use strict";return{restrict:"A",controller:["$scope","$element",function($scope,$element){$element.data("afklImageContainer",$element)}]}}).directive("afklLazyImage",["$rootScope","$window","$timeout","afklSrcSetService","$parse",function($rootScope,$window,$timeout,srcSetService,$parse){"use strict";var bestImage=function(images){var sourceUrl,image=srcSetService.get({srcset:images});return image&&(sourceUrl=image.best.src),sourceUrl};return{restrict:"A",link:function(scope,element,attrs){var _concatImgAttrs=function(imgAttrs){var result=[];return options.imgAttrs&&(result=Array.prototype.map.call(imgAttrs,function(item){for(var key in item)if(item.hasOwnProperty(key))return String.prototype.concat.call(key,'="',item[key],'"')})),result.join(" ")},$container=element.inheritedData("afklImageContainer");$container||($container=angular.element(attrs.afklLazyImageContainer||$window));var timeout,loaded=!1,images=attrs.afklLazyImage,options=attrs.afklLazyImageOptions?$parse(attrs.afklLazyImageOptions)(scope):{},img=null,currentImage=null,offset=options.offset?options.offset:50,imgAttrs=_concatImgAttrs(options.imgAttrs),LOADING="afkl-lazy-image-loading";attrs.afklLazyImageLoaded=!1;var _containerScrollTop=function(){if($container.scrollTop){var scrollTopPosition=$container.scrollTop();if(scrollTopPosition)return scrollTopPosition}var c=$container[0];return void 0!==c.pageYOffset?c.pageYOffset:void 0!==c.scrollTop?c.scrollTop:document.documentElement.scrollTop||0},_containerInnerHeight=function(){if($container.innerHeight)return $container.innerHeight();var c=$container[0];return void 0!==c.innerHeight?c.innerHeight:void 0!==c.clientHeight?c.clientHeight:document.documentElement.clientHeight||0},_elementOffset=function(){if(element.offset)return element.offset().top;var box=element[0].getBoundingClientRect();return box.top+_containerScrollTop()-document.documentElement.clientTop},_elementOffsetContainer=function(){return element.offset?element.offset().top-$container.offset().top:element[0].getBoundingClientRect().top-$container[0].getBoundingClientRect().top},_setImage=function(){options.background?element[0].style.backgroundImage='url("'+currentImage+'")':img&&(img[0].src=currentImage)},_placeImage=function(){loaded=!0;var hasImage=bestImage(images);hasImage&&(options.background||img||(element.addClass(LOADING),img=angular.element("<img "+imgAttrs+" />"),img.one("load",_loaded),img.one("error",_error),element.append(img)),_checkIfNewImage()),$container.off("scroll",_onViewChange)},_checkIfNewImage=function(){if(loaded){var newImage=bestImage(images);newImage!==currentImage&&(currentImage=newImage,_setImage())}};_checkIfNewImage();var _loaded=function(){attrs.$set("afklLazyImageLoaded","done"),element.removeClass(LOADING)},_error=function(){attrs.$set("afklLazyImageLoaded","fail")},_onViewChange=function(){if(!loaded){var remaining,shouldLoad,windowBottom,height=_containerInnerHeight(),scroll=_containerScrollTop(),elOffset=$container[0]===$window?_elementOffset():_elementOffsetContainer();windowBottom=$container[0]===$window?height+scroll:height,remaining=elOffset-windowBottom,shouldLoad=offset>=remaining,shouldLoad&&_placeImage()}},_onViewChangeDebounced=srcSetService.debounce(_onViewChange,300),_onResize=function(){$timeout.cancel(timeout),timeout=$timeout(function(){_checkIfNewImage(),_onViewChange()},300)},_eventsOff=function(){$timeout.cancel(timeout),angular.element($window).off("resize",_onResize),angular.element($window).off("scroll",_onViewChangeDebounced),$container[0]!==$window&&($container.off("resize",_onResize),$container.off("scroll",_onViewChangeDebounced)),img&&img.remove(),img=timeout=currentImage=void 0};return angular.element($window).on("resize",_onResize),angular.element($window).on("scroll",_onViewChangeDebounced),$container[0]!==$window&&($container.on("resize",_onResize),$container.on("scroll",_onViewChangeDebounced)),attrs.$observe("afklLazyImage",function(){images=attrs.afklLazyImage,loaded&&_placeImage()}),options.nolazy&&_placeImage(),scope.$on("afkl.lazyImage.destroyed",_onResize),scope.$on("$destroy",function(){return $rootScope.$broadcast("afkl.lazyImage.destroyed"),_eventsOff()}),_onViewChange()}}}]),/*! 
 * angular-loading-bar v0.9.0
 * https://chieffancypants.github.io/angular-loading-bar
 * Copyright (c) 2016 Wes Cruver
 * License: MIT
 */
/*
 * angular-loading-bar
 *
 * intercepts XHR requests and creates a loading bar.
 * Based on the excellent nprogress work by rstacruz (more info in readme)
 *
 * (c) 2013 Wes Cruver
 * License: MIT
 */
function(){angular.module("angular.loading",["cfp.loadingBarInterceptor"]),angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]),angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function($httpProvider){var interceptor=["$q","$cacheFactory","$timeout","$rootScope","$log","cfpLoadingBar",function($q,$cacheFactory,$timeout,$rootScope,$log,cfpLoadingBar){var startTimeout,reqsTotal=0,reqsCompleted=0,latencyThreshold=cfpLoadingBar.latencyThreshold;function setComplete(){$timeout.cancel(startTimeout),cfpLoadingBar.complete(),reqsCompleted=0,reqsTotal=0}function isCached(config){var cache,defaultCache=$cacheFactory.get("$http"),defaults=$httpProvider.defaults;!config.cache&&!defaults.cache||config.cache===!1||"GET"!==config.method&&"JSONP"!==config.method||(cache=angular.isObject(config.cache)?config.cache:angular.isObject(defaults.cache)?defaults.cache:defaultCache);var cached=void 0!==cache?void 0!==cache.get(config.url):!1;return void 0!==config.cached&&cached!==config.cached?config.cached:(config.cached=cached,cached)}return{request:function(config){return config.ignoreLoadingBar||isCached(config)||($rootScope.$broadcast("cfpLoadingBar:loading",{url:config.url}),0===reqsTotal&&(startTimeout=$timeout(function(){cfpLoadingBar.start()},latencyThreshold)),reqsTotal++,cfpLoadingBar.set(reqsCompleted/reqsTotal)),config},response:function(response){return response&&response.config?(response.config.ignoreLoadingBar||isCached(response.config)||(reqsCompleted++,$rootScope.$broadcast("cfpLoadingBar:loaded",{url:response.config.url,result:response}),reqsCompleted>=reqsTotal?setComplete():cfpLoadingBar.set(reqsCompleted/reqsTotal)),response):($log.error("Broken interceptor detected: Config object not supplied in response:\n https://github.com/chieffancypants/angular-loading-bar/pull/50"),response)},responseError:function(rejection){return rejection&&rejection.config?(rejection.config.ignoreLoadingBar||isCached(rejection.config)||(reqsCompleted++,$rootScope.$broadcast("cfpLoadingBar:loaded",{url:rejection.config.url,result:rejection}),reqsCompleted>=reqsTotal?setComplete():cfpLoadingBar.set(reqsCompleted/reqsTotal)),$q.reject(rejection)):($log.error("Broken interceptor detected: Config object not supplied in rejection:\n https://github.com/chieffancypants/angular-loading-bar/pull/50"),$q.reject(rejection))}}}];$httpProvider.interceptors.push(interceptor)}]),angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.autoIncrement=!0,this.includeSpinner=!0,this.includeBar=!0,this.latencyThreshold=100,this.startSize=.03,this.parentSelector="body",this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>',this.loadingBarTemplate='<div id="J_loading_bar"><div class="bar"><div class="peg"></div></div></div>',this.$get=["$injector","$document","$timeout","$rootScope",function($injector,$document,$timeout,$rootScope){var $animate,incTimeout,completeTimeout,$parentSelector=this.parentSelector,loadingBarContainer=angular.element(this.loadingBarTemplate),loadingBar=loadingBarContainer.find("div").eq(0),spinner=angular.element(this.spinnerTemplate),started=!1,status=0,autoIncrement=this.autoIncrement,includeSpinner=this.includeSpinner,includeBar=this.includeBar,startSize=this.startSize;function _start(){if($animate||($animate=$injector.get("$animate")),$timeout.cancel(completeTimeout),!started){var document=$document[0],parent=document.querySelector?document.querySelector($parentSelector):$document.find($parentSelector)[0];parent||(parent=document.getElementsByTagName("body")[0]);var $parent=angular.element(parent),$after=parent.lastChild&&angular.element(parent.lastChild);$rootScope.$broadcast("cfpLoadingBar:started"),started=!0,includeBar&&$animate.enter(loadingBarContainer,$parent,$after),includeSpinner&&$animate.enter(spinner,$parent,loadingBarContainer),_set(startSize)}}function _set(n){if(started){var pct=100*n+"%";loadingBar.css("width",pct),status=n,autoIncrement&&($timeout.cancel(incTimeout),incTimeout=$timeout(function(){_inc()},200))}}function _inc(){if(!(_status()>=1)){var rnd=0,stat=_status();rnd=stat>=0&&.25>stat?(3*Math.random()+3)/100:stat>=.25&&.65>stat?3*Math.random()/100:stat>=.65&&.9>stat?2*Math.random()/100:stat>=.9&&.99>stat?.005:0;var pct=_status()+rnd;_set(pct)}}function _status(){return status}function _complete(){return $animate||($animate=$injector.get("$animate")),$rootScope.$broadcast("cfpLoadingBar:completed"),_set(1),!1}return{start:_start,set:_set,status:_status,inc:_inc,complete:_complete,autoIncrement:this.autoIncrement,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})}(),angular.module("angular.modal",[]).factory("templateEngine",["$rootScope","$http","$templateCache","$compile",function($rootScope,$http,$templateCache,$compile){return function(params){return params.template?(params.success(params.template),!1):void $http.get(params.template_url,{cache:$templateCache}).success(function(tplContent){params.success(tplContent)}).error(function(){params.error()})}}]).factory("$modal",["$rootScope","templateEngine","$compile","$window","$document","$timeout","$interval",function($rootScope,templateEngine,$compile,$window,$document,$timeout,$interval){var modal_center=function(){var vertical_center=function(){var e_height=$("#J_modal_dialog").height(),w_height=$(window).height(),m_height=(w_height-e_height)/2;$("#J_modal_dialog").css("marginTop",m_height+"px")};vertical_center(),$(window).resize(vertical_center)},modal={timer_text:"",lazytime:0,callback:"",openCallback:"",onsubmit:"",oncancel:"",modal_promise:"",init:function(param){var _self=this,type=param.type,title=param.title||"提示信息",message=param.message||"",info=param.info||"",lazytime=param.lazytime||2,template_url=param.template_url,template=param.template,button=param.button||{confirm:"确定",cancel:"取消"},callback=param.callback,openCallback=param.openCallback,onsubmit=param.onsubmit,oncancel=param.oncancel,icon="",modal_class="",modal_body="",modal_info="",modal_footer="";_self.lazytime=lazytime,_self.callback=callback,_self.openCallback=openCallback,_self.onsubmit=onsubmit,_self.oncancel=oncancel,info&&(modal_info='<p class="info">'+info+"</p>");var appendModal=function(_modal){var template='<div id="J_modal_box" class="modal fade in show"><div id="J_modal_dialog" class="modal-dialog '+(_modal["class"]||"")+'"><div class="modal-content"><div class="modal-header"><button type="button" class="close" ng-click="modal.close()"><i class="icon icon-close h3"></i></button><h4 class="modal-title">'+title+"</h4></div>"+_modal.body+(_modal.footer||"")+'</div></div></div><div id="J_modal_backdrop" class="modal-backdrop fade"></div>',scope=$rootScope.$new(!0).$root,modal_html=$compile(template)(scope),append_modal=function(){$("#J_main_container").append(modal_html),setTimeout(function(){$("#J_modal_backdrop").addClass("in"),modal_center()},10),_self.openCallback&&$timeout(_self.openCallback,40)};$("#J_modal_box").length&&setTimeout(append_modal,250),$("#J_modal_box").length||append_modal()};switch(type){case"success":case"error":case"warning":icon="icon-"+type,lazytime>0&&this.autoClose(),modal_class="modal-message",modal_body='<div id="J_modal_body" class="modal-body"><i class="icon '+icon+'"></i>'+message+modal_info+'<p class="info timer">'+lazytime+"秒后窗口将自动关闭</p></div>";break;case"confirm":icon="icon-warning",modal_class="modal-confirm",modal_body='<div id="J_modal_body" class="modal-body"><i class="icon '+icon+'"></i>'+message+modal_info+"</div>",modal_footer='<div class="modal-footer" id="J_modal_footer"><button type="button" class="btn btn-primary" ng-click="modal.submit()">'+button.confirm+'</button><button type="button" class="btn btn-default" ng-click="modal.cancel()">'+button.cancel+"</button></div>";break;case"custom":return void templateEngine({template_url:template_url,template:template,success:function(tplContent){modal_body='<div id="J_modal_body" class="modal-body clearfix">'+tplContent+"</div>",appendModal({"class":"modal-custom",body:modal_body})},error:function(){modal.init({type:"error",info:"加载错误",message:"由于网络原因加载失败"})}})}appendModal({"class":modal_class,body:modal_body,footer:modal_footer})},initImage:function(param){var url=param.url||"";if(!url)return modal.init({type:"error",info:"图片错误",message:"无效图片地址"}),!1;var img=new Image;img.onload=function(){var template='<div id="J_modal_box" class="modal modal-image fade in show"><div id="J_modal_dialog" class="modal-dialog"><div class="modal-content"><button type="button" class="close" ng-click="modal.close()"><i class="icon icon-close h3"></i></button><img src="'+url+'"></div></div></div><div id="J_modal_backdrop" class="modal-backdrop fade"></div>',scope=$rootScope.$new(!0).$root,modal_html=$compile(template)(scope);$("#J_main_container").append(modal_html),$timeout(function(){$("#J_modal_backdrop").addClass("in"),modal_center()},10)},img.onerror=function(){modal.init({type:"error",info:"图片错误",message:"图片加载失败"})},img.src=url},initLoading:function(param){if(!$("#J_loading_box").length){var loader=param.loader||"images/loader.gif",template='<div id="J_loading_box" class="modal modal-loading fade out show"><div class="loader"><img src="'+loader+'"></div>',scope=$rootScope.$new(!0).$root,loading_html=$compile(template)(scope);$("#J_main_container").append(loading_html),$timeout(function(){$("#J_loading_box").removeClass("out").addClass("in")},100)}},success:function(param){param.type="success",param.lazytime=param.lazytime||1,this.init(param)},error:function(param){param.type="error",param.lazytime=param.lazytime||2,this.init(param)},warning:function(param){param.type="warning",this.init(param)},confirm:function(param){param.type="confirm",this.init(param)},custom:function(param){param.type="custom",this.init(param)},loading:function(param){void 0==param&&(param={}),param.type="loading",this.initLoading(param)},image:function(param){param.type="image",this.initImage(param)},confirmSubmit:function(){var _self=this,onsubmit=this.onsubmit;_self.close(),"function"==typeof onsubmit?onsubmit():eval(onsubmit)},confirmCancel:function(){var _self=this,oncancel=this.oncancel;_self.close(),"function"==typeof oncancel?oncancel():eval(oncancel)},closeCallback:function(){var _self=this,callback=this.callback;"function"==typeof callback?callback():eval(callback),_self.close()},close:function(){$("#J_modal_box").removeClass("in"),$("#J_modal_backdrop").removeClass("in"),$("#J_modal_box").length||this.remove(),$("#J_modal_box").length&&$timeout(this.remove,250),$interval.cancel(this.modal_promise)},autoClose:function(){var _self=this,timer=_self.lazytime,modal_promise=$interval(function(){timer-=1,angular.element(document.getElementById("J_modal_body").querySelector(".timer")).html(timer+"秒后窗口将自动关闭"),0==timer&&(_self.closeCallback(),$interval.cancel(modal_promise),timer=_self.lazytime=0)},1e3);_self.modal_promise=modal_promise},remove:function(){angular.element(document.getElementById("J_modal_box")).remove(),angular.element(document.getElementById("J_modal_backdrop")).remove()},closeLoading:function(){$("#J_loading_box").length&&($("#J_loading_box").removeClass("in").addClass("out"),$timeout(function(){$("#J_loading_box").remove()},260))},closeAll:function(){var _self=this;_self.closeLoading(),_self.close()}};return modal}]),function(){var relatedSelect=angular.module("angular-related-select",[]);relatedSelect.controller("RSController",["$rootScope","$modal","$scope",function($rootScope,$modal,$scope){$scope.disSelects=[],$scope.ckdSelects=[],$scope.ckdSelectCates=[],$scope.ckdSelectId=0,$scope.$watch("allSelects",function(allSelects){if(!allSelects||!allSelects.length)return!1;if($scope.is_edit){if($scope.editSelectId){var allSelects=$scope.allSelects,editSelectId=$scope.editSelectId,select=allSelects.find(editSelectId,"id","children"),initCates=function(select){if(select.id){var parent=allSelects.parent(select.id,"id","children");parent&&($scope.disSelects.unshift(parent.children),$scope.ckdSelects.unshift(parent.id),initCates(parent))}};initCates(select),$scope.ckdSelects.shift(),$scope.ckdSelects.push(select.id);for(var i=0;i<$scope.ckdSelects.length;i++)$scope.ckdSelectCates.push($scope.disSelects[i].find($scope.ckdSelects[i],"id"))}}else $scope.disSelects.push(allSelects)}),$scope.selectChange=function(params){if(!params.id)return!1;$scope.disSelects.splice(params.index+1,$scope.disSelects.length-params.index+1),$scope.ckdSelects.splice(params.index+1,$scope.ckdSelects.length-params.index+1);var children=$scope.disSelects[params.index].find(params.id,"id").children;children&&children.length&&$scope.disSelects.push(children),$scope.ckdSelectId=$scope.ckdSelects[$scope.ckdSelects.length-1],$scope.selectChangeCallBack&&angular.isFunction($scope.selectChangeCallBack)&&$scope.selectChangeCallBack({ckdSelectId:$scope.ckdSelectId,disSelects:$scope.disSelects})}}]),relatedSelect.directive("relatedSelect",function(){return{restrict:"A",scope:{is_edit:"=isEdit",allSelects:"=selects",editSelectId:"=selectId",selectChangeCallBack:"=selectChange"},templateUrl:function(element,attrs){return attrs.templateUrl||"partials/template/related-select/related-select.html"},controller:"RSController",replace:!0,link:function(scope,element,attrs){}}})}(),function(window,angular){var module=angular.module("angular-sortable-view",[]);module.directive("svRoot",[function(){function shouldBeAfter(elem,pointer,isGrid){return isGrid?elem.x-pointer.x<0:elem.y-pointer.y<0}function getSortableElements(key){return ROOTS_MAP[key]}function removeSortableElements(key){delete ROOTS_MAP[key]}var sortingInProgress,ROOTS_MAP=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function($scope,$attrs,$interpolate,$parse){var mapKey=$interpolate($attrs.svRoot)($scope)||$scope.$id;ROOTS_MAP[mapKey]||(ROOTS_MAP[mapKey]=[]);var candidates,$placeholder,options,$helper,$original,$target,isGrid=!1,onSort=$parse($attrs.svOnSort);$attrs.svOnStart=$attrs.$$element[0].attributes["sv-on-start"],$attrs.svOnStart=$attrs.svOnStart&&$attrs.svOnStart.value,$attrs.svOnStop=$attrs.$$element[0].attributes["sv-on-stop"],$attrs.svOnStop=$attrs.svOnStop&&$attrs.svOnStop.value;var onStart=$parse($attrs.svOnStart),onStop=$parse($attrs.svOnStop);if(this.sortingInProgress=function(){return sortingInProgress},$attrs.svGrid){if(isGrid="true"===$attrs.svGrid?!0:"false"===$attrs.svGrid?!1:null,null===isGrid)throw"Invalid value of sv-grid attribute"}else $scope.$watchCollection(function(){return getSortableElements(mapKey)},function(collection){isGrid=!1;var array=collection.filter(function(item){return!item.container}).map(function(item){return{part:item.getPart().id,y:item.element[0].getBoundingClientRect().top}}),dict=Object.create(null);array.forEach(function(item){dict[item.part]?dict[item.part].push(item.y):dict[item.part]=[item.y]}),Object.keys(dict).forEach(function(key){dict[key].sort(),dict[key].forEach(function(item,index){index<dict[key].length-1&&item>0&&item===dict[key][index+1]&&(isGrid=!0)})})});this.$moveUpdate=function(opts,mouse,svElement,svOriginal,svPlaceholder,originatingPart,originatingIndex){var svRect=svElement[0].getBoundingClientRect();"element"===opts.tolerance&&(mouse={x:~~(svRect.left+svRect.width/2),y:~~(svRect.top+svRect.height/2)}),sortingInProgress=!0,candidates=[],$placeholder||(svPlaceholder?($placeholder=svPlaceholder.clone(),$placeholder.removeClass("ng-hide")):($placeholder=svOriginal.clone(),$placeholder.addClass("sv-visibility-hidden"),$placeholder.addClass("sv-placeholder"),$placeholder.css({height:svRect.height+"px",width:svRect.width+"px"})),svOriginal.after($placeholder),svOriginal.addClass("ng-hide"),$original=svOriginal,options=opts,$helper=svElement,onStart($scope,{$helper:{element:$helper},$part:originatingPart.model(originatingPart.scope),$index:originatingIndex,$item:originatingPart.model(originatingPart.scope)[originatingIndex]}),$scope.$root&&$scope.$root.$$phase||$scope.$apply()),$helper[0].reposition({x:mouse.x+document.body.scrollLeft-mouse.offset.x*svRect.width,y:mouse.y+document.body.scrollTop-mouse.offset.y*svRect.height}),getSortableElements(mapKey).forEach(function(se,index){if(null==opts.containment||elementMatchesSelector(se.element,opts.containment)||elementMatchesSelector(se.element,opts.containment+" *")){var rect=se.element[0].getBoundingClientRect(),center={x:~~(rect.left+rect.width/2),y:~~(rect.top+rect.height/2)};se.container||!se.element[0].scrollHeight&&!se.element[0].scrollWidth||candidates.push({element:se.element,q:(center.x-mouse.x)*(center.x-mouse.x)+(center.y-mouse.y)*(center.y-mouse.y),view:se.getPart(),targetIndex:se.getIndex(),after:shouldBeAfter(center,mouse,isGrid)}),se.container&&!se.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&candidates.push({element:se.element,q:(center.x-mouse.x)*(center.x-mouse.x)+(center.y-mouse.y)*(center.y-mouse.y),view:se.getPart(),targetIndex:0,container:!0})}});var pRect=$placeholder[0].getBoundingClientRect(),pCenter={x:~~(pRect.left+pRect.width/2),y:~~(pRect.top+pRect.height/2)};candidates.push({q:(pCenter.x-mouse.x)*(pCenter.x-mouse.x)+(pCenter.y-mouse.y)*(pCenter.y-mouse.y),element:$placeholder,placeholder:!0}),candidates.sort(function(a,b){return a.q-b.q}),candidates.forEach(function(cand,index){0!==index||cand.placeholder||cand.container?0===index&&cand.container?($target=cand,cand.element.append($placeholder)):cand.element.removeClass("sv-candidate"):($target=cand,cand.element.addClass("sv-candidate"),cand.after?cand.element.after($placeholder):insertElementBefore(cand.element,$placeholder))})},this.$drop=function(originatingPart,index,options){if($placeholder){if(options.revert){var placeholderRect=$placeholder[0].getBoundingClientRect(),helperRect=$helper[0].getBoundingClientRect(),distance=Math.sqrt(Math.pow(helperRect.top-placeholderRect.top,2)+Math.pow(helperRect.left-placeholderRect.left,2)),duration=+options.revert*distance/200;duration=Math.min(duration,+options.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(prefix){"undefined"!=typeof $helper[0].style[prefix+"transition"]&&($helper[0].style[prefix+"transition"]="all "+duration+"ms ease")}),setTimeout(afterRevert,duration),$helper.css({top:placeholderRect.top+document.body.scrollTop+"px",left:placeholderRect.left+document.body.scrollLeft+"px"})}else afterRevert();function afterRevert(){if(sortingInProgress=!1,$placeholder.remove(),$helper.remove(),$original.removeClass("ng-hide"),candidates=void 0,$placeholder=void 0,options=void 0,$helper=void 0,$original=void 0,onStop($scope,{$part:originatingPart.model(originatingPart.scope),$index:index,$item:originatingPart.model(originatingPart.scope)[index]}),$target){$target.element.removeClass("sv-candidate");var spliced=originatingPart.model(originatingPart.scope).splice(index,1),targetIndex=$target.targetIndex;$target.view===originatingPart&&$target.targetIndex>index&&targetIndex--,$target.after&&targetIndex++,$target.view.model($target.view.scope).splice(targetIndex,0,spliced[0]),$target.view===originatingPart&&index===targetIndex||onSort($scope,{$partTo:$target.view.model($target.view.scope),$partFrom:originatingPart.model(originatingPart.scope),$item:spliced[0],$indexTo:targetIndex,$indexFrom:index})}$target=void 0,$scope.$root&&$scope.$root.$$phase||$scope.$apply()}}},this.addToSortableElements=function(se){getSortableElements(mapKey).push(se)},this.removeFromSortableElements=function(se){var elems=getSortableElements(mapKey),index=elems.indexOf(se);index>-1&&(elems.splice(index,1),0===elems.length&&removeSortableElements(mapKey))}}]}}]),module.directive("svPart",["$parse",function($parse){return{restrict:"A",require:"^svRoot",controller:["$scope",function($scope){$scope.$ctrl=this,this.getPart=function(){return $scope.part},this.$drop=function(index,options){$scope.$sortableRoot.$drop($scope.part,index,options)}}],scope:!0,link:function($scope,$element,$attrs,$sortable){if(!$attrs.svPart)throw new Error("no model provided");var model=$parse($attrs.svPart);if(!model.assign)throw new Error("model not assignable");$scope.part={id:$scope.$id,element:$element,model:model,scope:$scope},$scope.$sortableRoot=$sortable;var sortablePart={element:$element,getPart:$scope.$ctrl.getPart,container:!0};$sortable.addToSortableElements(sortablePart),$scope.$on("$destroy",function(){$sortable.removeFromSortableElements(sortablePart)})}}}]),module.directive("svElement",["$parse",function($parse){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function($scope){$scope.$ctrl=this}],link:function($scope,$element,$attrs,$controllers){$element.addClass("drag-element");var sortableElement={element:$element,getPart:$controllers[0].getPart,getIndex:function(){return $scope.$index}};$controllers[1].addToSortableElements(sortableElement),$scope.$on("$destroy",function(){$controllers[1].removeFromSortableElements(sortableElement)});var handle=$element;handle.on("mousedown touchstart",onMousedown),$scope.$watch("$ctrl.handle",function(customHandle){customHandle&&(handle.off("mousedown touchstart",onMousedown),handle=customHandle,handle.on("mousedown touchstart",onMousedown))});var helper;$scope.$watch("$ctrl.helper",function(customHelper){customHelper&&(helper=customHelper)});var placeholder;$scope.$watch("$ctrl.placeholder",function(customPlaceholder){customPlaceholder&&(placeholder=customPlaceholder)});var moveExecuted,html=(angular.element(document.body),angular.element(document.documentElement));function onMousedown(e){if(touchFix(e),!$controllers[1].sortingInProgress()&&(0==e.button||"mousedown"!==e.type)){moveExecuted=!1;var opts=$parse($attrs.svElement)($scope);if(opts=angular.extend({},{tolerance:"pointer",revert:200,containment:"html"},opts),opts.containment)var containmentRect=closestElement.call($element,opts.containment)[0].getBoundingClientRect();var clone,target=$element,clientRect=$element[0].getBoundingClientRect();helper||(helper=$controllers[0].helper),placeholder||(placeholder=$controllers[0].placeholder),helper?(clone=helper.clone(),clone.removeClass("ng-hide"),clone.css({left:clientRect.left+document.body.scrollLeft+"px",top:clientRect.top+document.body.scrollTop+"px"}),target.addClass("sv-visibility-hidden")):(clone=target.clone(),clone.addClass("sv-helper").css({left:clientRect.left+document.body.scrollLeft+"px",top:clientRect.top+document.body.scrollTop+"px",width:clientRect.width+"px"})),clone[0].reposition=function(coords){var targetLeft=coords.x,targetTop=coords.y,helperRect=clone[0].getBoundingClientRect(),body=document.body;containmentRect&&(targetTop<containmentRect.top+body.scrollTop&&(targetTop=containmentRect.top+body.scrollTop),targetTop+helperRect.height>containmentRect.top+body.scrollTop+containmentRect.height&&(targetTop=containmentRect.top+body.scrollTop+containmentRect.height-helperRect.height),targetLeft<containmentRect.left+body.scrollLeft&&(targetLeft=containmentRect.left+body.scrollLeft),targetLeft+helperRect.width>containmentRect.left+body.scrollLeft+containmentRect.width&&(targetLeft=containmentRect.left+body.scrollLeft+containmentRect.width-helperRect.width)),this.style.left=targetLeft-body.scrollLeft+"px",this.style.top=targetTop-body.scrollTop+"px"};var pointerOffset={x:(e.clientX-clientRect.left)/clientRect.width,y:(e.clientY-clientRect.top)/clientRect.height};html.addClass("sv-sorting-in-progress"),html.on("mousemove touchmove",onMousemove).on("mouseup touchend touchcancel",function mouseup(e){html.off("mousemove touchmove",onMousemove),html.off("mouseup touchend",mouseup),html.removeClass("sv-sorting-in-progress"),moveExecuted&&$controllers[0].$drop($scope.$index,opts),$element.removeClass("sv-visibility-hidden")});function onMousemove(e){touchFix(e),moveExecuted||($element.parent().prepend(clone),moveExecuted=!0),$controllers[1].$moveUpdate(opts,{x:e.clientX,y:e.clientY,offset:pointerOffset},clone,$element,placeholder,$controllers[0].getPart(),$scope.$index)}}}}}}]),module.directive("svHandle",function(){return{require:"?^svElement",link:function($scope,$element,$attrs,$ctrl){$element.addClass("drag-handle"),$ctrl&&($ctrl.handle=$element.add($ctrl.handle))}}}),module.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function($scope,$element,$attrs,$ctrl){$element.addClass("sv-helper").addClass("ng-hide"),$ctrl[1]?$ctrl[1].helper=$element:$ctrl[0]&&($ctrl[0].helper=$element)}}}),module.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function($scope,$element,$attrs,$ctrl){$element.addClass("sv-placeholder").addClass("ng-hide"),$ctrl[1]?$ctrl[1].placeholder=$element:$ctrl[0]&&($ctrl[0].placeholder=$element)}}}),angular.element(document.head).append(["<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));function touchFix(e){if(!("clientX"in e||"clientY"in e)){var touches=e.touches||e.originalEvent.touches;touches&&touches.length&&(e.clientX=touches[0].clientX,e.clientY=touches[0].clientY),e.preventDefault()}}function getPreviousSibling(element){if(element=element[0],element.previousElementSibling)return angular.element(element.previousElementSibling);for(var sib=element.previousSibling;null!=sib&&1!=sib.nodeType;)sib=sib.previousSibling;return angular.element(sib)}function insertElementBefore(element,newElement){var prevSibl=getPreviousSibling(element);prevSibl.length>0?prevSibl.after(newElement):element.parent().prepend(newElement)}var dde=document.documentElement,matchingFunction=dde.matches?"matches":dde.matchesSelector?"matchesSelector":dde.webkitMatches?"webkitMatches":dde.webkitMatchesSelector?"webkitMatchesSelector":dde.msMatches?"msMatches":dde.msMatchesSelector?"msMatchesSelector":dde.mozMatches?"mozMatches":dde.mozMatchesSelector?"mozMatchesSelector":null;if(null==matchingFunction)throw"This browser doesn't support the HTMLElement.matches method";function elementMatchesSelector(element,selector){return element instanceof angular.element&&(element=element[0]),null!==matchingFunction?element[matchingFunction](selector):void 0}var closestElement=angular.element.prototype.closest||function(selector){for(var el=this[0].parentNode;el!==document.documentElement&&!el[matchingFunction](selector);)el=el.parentNode;return el[matchingFunction](selector)?angular.element(el):angular.element()};"function"!=typeof angular.element.prototype.add&&(angular.element.prototype.add=function(elem){var i,res=angular.element();for(elem=angular.element(elem),i=0;i<this.length;i++)res.push(this[i]);for(i=0;i<elem.length;i++)res.push(elem[i]);return res})}(window,window.angular),angular.module("ui.router.stateHelper",["ui.router"]).provider("stateHelper",["$stateProvider",function(e){function t(e){e.parent&&(e.name=(angular.isObject(e.parent)?e.parent.name:e.parent)+"."+e.name)}function a(e){e.children.forEach(function(e,t,a){a[t+1]&&(e.nextSibling=a[t+1].name),a[t-1]&&(e.previousSibling=a[t-1].name)})}var n=this;this.state=function(r){var i=Array.prototype.slice.apply(arguments),l={keepOriginalNames:!1,siblingTraversal:!1};return"boolean"==typeof i[1]?l.keepOriginalNames=i[1]:"object"==typeof i[1]&&angular.extend(l,i[1]),l.keepOriginalNames||t(r),e.state(r),r.children&&r.children.length&&(r.children.forEach(function(e){e.parent=r,n.state(e,l)}),l.siblingTraversal&&a(r)),n},this.setNestedState=this.state,n.$get=angular.noop}]),function(){angular.module("angular.validation.rule",["angular.validation"]).config(["$validationProvider",function($validationProvider){var expression={price:function(value,scope,element,attrs,param){return Number(value)>=0},required:function(value,scope,element,attrs,param){return void 0!==value&&""!==value},url:/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/,email:/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/,mobile:/^(13[0-9]{9})|(18[0-9]{9})|(15[0-9]{9})|(14[57][0-9]{8})|(17[0-9]{9})$/,number:/^\d+\.?\d*$/,minlength:function(value,scope,element,attrs,param){return"number"==typeof value?value.toString().length>=param:value.length>=param},maxlength:function(value,scope,element,attrs,param){return"number"==typeof value?value.toString().length<=param:value.length<=param},pwdVerify:function(value,scope,element,attrs,param){if(!(param.indexOf(".")>0))return value==scope.$parent[param];for(var paramArrays=param.split("."),params=new Object,i=0;i<paramArrays.length-1;i++)params[paramArrays[i]]=paramArrays[i+1];for(var key in params)return value==scope.$parent[key][params[key]]},min:function(value,scope,element,attrs,param){return parseInt(value)>=parseInt(param)},max:function(value,scope,element,attrs,param){return parseInt(value)<=parseInt(param)},custom:function(value,scope,element,attrs,param){if(param.indexOf("(")>0&&param.indexOf(")")>0){var fun_before=param.indexOf("("),fun_after=param.indexOf(")"),fun=param.substring(0,fun_before),pam=param.substring(fun_before+1,fun_after);return!!eval("scope.$parent."+fun+"("+scope.$parent[pam]+");")}return"!"==param[0]?!scope.$parent[param.substr(1)]:!!scope.$parent[param]}},defaultMsg={price:{error:"请输入价格",success:" "},required:{error:"此项必填",success:" "},url:{error:"URL格式不正确",success:" "},email:{error:"邮箱格式不正确",success:" "},mobile:{error:"手机号码不正确",success:" "},number:{error:"格式应为数字",success:" "},minlength:{error:"长度不正确",success:" "},maxlength:{error:"长度不正确",success:" "},pwdVerify:{error:"两次密码不相符",success:" "},min:{error:"不可少于最小值限制",success:" "},max:{error:"不可超过最大值限制",success:" "},custom:{error:"不符合要求",success:" "}};$validationProvider.setExpression(expression).setDefaultMsg(defaultMsg)}])}.call(this),function(){angular.module("angular.validation",["angular.validation.provider","angular.validation.directive"])}.call(this),function(){angular.module("angular.validation.provider",[]).provider("$validation",function(){var $injector,$scope,$http,$q,$timeout,_this=this,setup=function(injector){$injector=injector,$scope=$injector.get("$rootScope"),$http=$injector.get("$http"),$q=$injector.get("$q"),$timeout=$injector.get("$timeout")},expression={},defaultMsg={};this.setExpression=function(obj){return angular.extend(expression,obj),_this},this.getExpression=function(exprs){return expression[exprs]},this.setDefaultMsg=function(obj){return angular.extend(defaultMsg,obj),_this},this.getDefaultMsg=function(msg){return defaultMsg[msg]},this.setErrorHTML=function(func){return func.constructor===Function?(_this.getErrorHTML=func,_this):void 0},this.getErrorHTML=function(message){return'<p class="validation-invalid">'+message+"</p>"},this.setSuccessHTML=function(func){return func.constructor===Function?(_this.getSuccessHTML=func,_this):void 0},this.getSuccessHTML=function(message){return'<p class="validation-valid">'+message+"</p>"},this.showSuccessMessage=!0,this.showErrorMessage=!0,this.checkValid=function(form){return void 0===form.$valid?!1:form&&form.$valid===!0},this.validate=function(form){var deferred=$q.defer(),idx=0;if(void 0===form)return console.error("This is not a regular Form name scope"),deferred.reject("This is not a regular Form name scope"),deferred.promise;if(form.validationId)$scope.$broadcast(form.$name+"submit-"+form.validationId,idx++);else if(form.constructor===Array)for(var k in form)$scope.$broadcast(form[k].$name+"submit-"+form[k].validationId,idx++);else for(var i in form)"$"!==i[0]&&form[i].hasOwnProperty("$dirty")&&$scope.$broadcast(i+"submit-"+form[i].validationId,idx++);return deferred.promise.success=function(fn){return deferred.promise.then(function(value){
fn(value)}),deferred.promise},deferred.promise.error=function(fn){return deferred.promise.then(null,function(value){fn(value)}),deferred.promise},$timeout(function(){_this.checkValid(form)?deferred.resolve("success"):deferred.reject("error")}),deferred.promise},this.validCallback=null,this.invalidCallback=null,this.reset=function(form){if(void 0===form)return void console.error("This is not a regular Form name scope");if(form.validationId)$scope.$broadcast(form.$name+"reset-"+form.validationId);else if(form.constructor===Array)for(var k in form)$scope.$broadcast(form[k].$name+"reset-"+form[k].validationId);else for(var i in form)"$"!==i[0]&&form[i].hasOwnProperty("$dirty")&&$scope.$broadcast(i+"reset-"+form[i].validationId)},this.$get=["$injector",function($injector){return setup($injector),{setErrorHTML:this.setErrorHTML,getErrorHTML:this.getErrorHTML,setSuccessHTML:this.setSuccessHTML,getSuccessHTML:this.getSuccessHTML,setExpression:this.setExpression,getExpression:this.getExpression,setDefaultMsg:this.setDefaultMsg,getDefaultMsg:this.getDefaultMsg,showSuccessMessage:this.showSuccessMessage,showErrorMessage:this.showErrorMessage,checkValid:this.checkValid,validate:this.validate,validCallback:this.validCallback,invalidCallback:this.invalidCallback,reset:this.reset}}]})}.call(this),function(){angular.module("angular.validation.directive",["angular.validation.provider"]).directive("validator",["$injector",function($injector){var $validationProvider=$injector.get("$validation"),$q=$injector.get("$q"),$timeout=$injector.get("$timeout"),validFunc=function(element,validMessage,validation,scope,ctrl){var messageElem,messageToShow=validMessage||$validationProvider.getDefaultMsg(validation).success;return messageElem=scope.messageId?angular.element(document.querySelector("#"+scope.messageId)):element.next(),$validationProvider.showSuccessMessage&&messageToShow&&messageElem.html($validationProvider.getSuccessHTML(messageToShow)),ctrl.$setValidity(ctrl.$name,!0),scope.validCallback&&scope.validCallback({message:messageToShow}),$validationProvider.validCallback&&$validationProvider.validCallback(element),!0},invalidFunc=function(element,validMessage,validation,scope,ctrl){var messageElem,messageToShow=validMessage||$validationProvider.getDefaultMsg(validation).error;return messageElem=scope.messageId?angular.element(document.querySelector("#"+scope.messageId)):element.next(),$validationProvider.showErrorMessage&&messageToShow&&messageElem.html($validationProvider.getErrorHTML(messageToShow)),ctrl.$setValidity(ctrl.$name,!1),scope.invalidCallback&&scope.invalidCallback({message:messageToShow}),$validationProvider.invalidCallback&&$validationProvider.invalidCallback(element),!1},focusElements={},checkValidation=function(scope,element,attrs,ctrl,validation,value){var validators=validation.slice(0),validatorExpr=validators[0].trim(),paramIndex=validatorExpr.indexOf("="),validator=-1===paramIndex?validatorExpr:validatorExpr.substr(0,paramIndex),validatorParam=-1===paramIndex?null:validatorExpr.substr(paramIndex+1),leftValidation=validators.slice(1),successMessage=validator+"SuccessMessage",errorMessage=validator+"ErrorMessage",expression=$validationProvider.getExpression(validator),valid={success:function(){return validFunc(element,attrs[successMessage],validator,scope,ctrl),leftValidation.length?checkValidation(scope,element,attrs,ctrl,leftValidation,value):!0},error:function(){return invalidFunc(element,attrs[errorMessage],validator,scope,ctrl)}};return void 0===expression?(console.error('You are using undefined validator "%s"',validator),leftValidation.length?checkValidation(scope,element,attrs,ctrl,leftValidation,value):void 0):expression.constructor===Function?$q.all([$validationProvider.getExpression(validator)(value,scope,element,attrs,validatorParam)]).then(function(data){return data&&data.length>0&&data[0]?valid.success():valid.error()},function(){return valid.error()}):expression.constructor===RegExp&&void 0!==value&&null!==value&&$validationProvider.getExpression(validator).test(value)?valid.success():valid.error()},s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid=function(){return s4()+s4()+s4()+s4()};return{restrict:"A",require:"ngModel",scope:{model:"=ngModel",initialValidity:"=initialValidity",validCallback:"&",invalidCallback:"&",messageId:"@"},link:function(scope,element,attrs,ctrl){var initialValidity,watch=function(){},validation=attrs.validator.split(","),uid=ctrl.validationId=guid();"boolean"==typeof scope.initialValidity&&(initialValidity=scope.initialValidity),scope.messageId||element.after('<span class="validation-msg"></span>'),ctrl.$setValidity(ctrl.$name,initialValidity),scope.$on(ctrl.$name+"reset-"+uid,function(){watch(),$timeout(function(){ctrl.$setViewValue(""),ctrl.$setPristine(),ctrl.$setValidity(ctrl.$name,void 0),ctrl.$render(),scope.messageId?angular.element(document.querySelector("#"+scope.messageId)).html(""):element.next().html("")})}),function(){return scope.$on(ctrl.$name+"submit-"+uid,function(event,index){var value=ctrl.$viewValue,isValid=!1;isValid=checkValidation(scope,element,attrs,ctrl,validation,value),"submit"===attrs.validMethod&&(watch(),watch=scope.$watch("model",function(value,oldValue){value!==oldValue&&(void 0!==value&&null!==value||(value=""),isValid=checkValidation(scope,element,attrs,ctrl,validation,value))}));var setFocus=function(isValid){isValid?delete focusElements[index]:(focusElements[index]=element[0],$timeout(function(){focusElements[Math.min.apply(null,Object.keys(focusElements))].focus()},0))};isValid.constructor===Object?isValid.then(setFocus):setFocus(isValid)}),"blur"===attrs.validMethod?void element.bind("blur",function(){var value=ctrl.$viewValue;scope.$apply(function(){checkValidation(scope,element,attrs,ctrl,validation,value)})}):void("submit"!==attrs.validMethod&&"submit-only"!==attrs.validMethod&&scope.$watch("model",function(value){if(ctrl.$pristine&&ctrl.$viewValue)ctrl.$setViewValue(ctrl.$viewValue);else if(ctrl.$pristine)return void(scope.messageId?angular.element(document.querySelector("#"+scope.messageId)).html(""):element.next().html(""));checkValidation(scope,element,attrs,ctrl,validation,value)}))}(),$timeout(function(){attrs.$observe("noValidationMessage",function(value){var el;el=scope.messageId?angular.element(document.querySelector("#"+scope.messageId)):element.next(),"true"==value||value===!0?el.css("display","none"):"false"!=value&&value!==!1||el.css("display","block")})})}}}]).directive("validationSubmit",["$injector",function($injector){var $validationProvider=$injector.get("$validation"),$timeout=$injector.get("$timeout"),$parse=$injector.get("$parse");return{priority:1,require:"?ngClick",link:function(scope,element,attrs){var form=$parse(attrs.validationSubmit)(scope);$timeout(function(){element.off("click"),element.on("click",function(e){e.preventDefault(),$validationProvider.validate(form).success(function(){$parse(attrs.ngClick)(scope)})})})}}}]).directive("validationReset",["$injector",function($injector){var $validationProvider=$injector.get("$validation"),$timeout=$injector.get("$timeout"),$parse=$injector.get("$parse");return{link:function(scope,element,attrs){var form=$parse(attrs.validationReset)(scope);$timeout(function(){element.on("click",function(e){e.preventDefault(),$validationProvider.reset(form)})})}}}])}.call(this),function(){"use strict";var videoPlayer=angular.module("angular-video-player",[]);videoPlayer.directive("videoPlayer",["$rootScope","$compile","$location",function($rootScope,$compile,$location){return{restrict:"A",replace:!0,scope:{data:"=data"},template:function(){var player=['<div class="video-player">','<video id="J_video_player" class="video-js vjs-default-skin"></video>',"</div>"].join("");return player},link:function($scope,element,attrs){$scope.status=0,videojs.addLanguage("zh-CN",{Play:"播放",Pause:"暂停","Current Time":"当前时间","Duration Time":"时长","Remaining Time":"剩余时间","Stream Type":"媒体流类型",LIVE:"直播",Loaded:"加载完毕",Progress:"进度",Fullscreen:"全屏","Non-Fullscreen":"退出全屏",Mute:"静音",Unmute:"取消静音","Playback Rate":"播放码率",Subtitles:"字幕","subtitles off":"字幕关闭",Captions:"内嵌字幕","captions off":"内嵌字幕关闭",Chapters:"节目段落","You aborted the media playback":"视频播放被终止","A network error caused the media download to fail part-way.":"网络错误导致视频下载中途失败, 请刷新重试。","The media could not be loaded, either because the server or network failed or because the format is not supported.":"视频因格式不支持或者服务器或网络的问题无法加载。","The media playback was aborted due to a corruption problem or because the media used features your browser did not support.":"由于视频文件损坏或是该视频使用了你的浏览器不支持的功能，播放终止。","No compatible source was found for this media.":"无法找到此视频兼容的源。","The media is encrypted and we do not have the keys to decrypt it.":"视频已加密，无法解密。"}),$scope.playerInit=function(video_data){$scope.status=1,$scope.player=null;var video_start=video_data.start||0,video_live=!(!video_data.is_live||2!=video_data.live_status),video_src=video_live?video_data.urls.hls.ORIGIN:video_data.urls;videojs.options.flash.swf="scripts/player/video-js.swf";var video_opts={controls:!0,autoplay:!0,preload:"auto",poster:"images/qrcode.png",wdith:"100%",height:"500",playbackRates:[.7,1,1.5,2],controlBar:{remainingTimeDisplay:!1,durationDisplay:{},currentTimeDisplay:{},volumeMenuButton:{inline:!1,vertical:!0}},language:"zh-CN",techOrder:["html5","flash"]};video_live||(video_opts.plugins={videoJsResolutionSwitcher:{"default":2,dynamicLabel:!0}}),$scope.player=videojs("J_video_player",video_opts,function(){video_live||(this.updateSrc([{type:"video/mp4",src:video_src.H,label:"原画",res:1},{type:"video/mp4",src:video_src.M,label:"高清",res:2},{type:"video/mp4",src:video_src.L,label:"流畅",res:3}]),this.on("resolutionchange",function(){$scope.$emit("videoPlayerResolution",this.src())})),video_live&&this.src({src:video_src,type:"application/x-mpegURL",withCredentials:!1}),this.on("play",function(){$scope.$emit("videoPlayerPlaying",!0)}),this.on("pause",function(){$scope.$emit("videoPlayerPause",!0)}),this.on("ended",function(){$scope.$emit("videoPlayerEnded",!0)}),this.on("loadeddata",function(){!video_live&&video_start&&this.currentTime(video_start),$scope.$emit("videoPlayerLoadeddata",!0)}),this.on("timeupdate",function(){$scope.$emit("videoPlayerTimeUpdate",this.currentTime())})}),$scope.playerDispose=function(){$scope.player&&$scope.player.dispose&&$scope.player.dispose(),$scope.player=null},$scope.$on("doVideoPlayerPause",function(){$scope.player.pause()}),$scope.$on("doVideoPlayerPlay",function(){$scope.player.play()}),$scope.$on("doVideoPlayerRefreshPlay",function(){$scope.player.currentTime(0),$scope.player.play()})},$scope.$watch("data",function(newData,oldData){newData||1!=$scope.status||$scope.playerDispose(),newData&&newData.urls&&0==$scope.status&&$scope.playerInit(newData)}),$scope.$on("$locationChangeStart",$scope.playerDispose)}}}])}(),angular.module("angular.bootstrap.carousel",[]).controller("CarouselController",["$scope","$element","$interval","$animate",function($scope,$element,$interval,$animate){$scope.active_slide_index=0;var currentInterval,isPlaying,self=this,slides=self.slides=$scope.slides=[],NEW_ANIMATE=angular.version.minor>=4,NO_TRANSITION="uib-noTransition",SLIDE_DIRECTION="uib-slideDirection",currentIndex=-1;self.currentSlide=null;var destroyed=!1;self.select=$scope.select=function(nextSlide,direction){var nextIndex=$scope.indexOfSlide(nextSlide);void 0===direction&&(direction=nextIndex>self.getCurrentIndex()?"next":"prev"),nextSlide&&nextSlide!==self.currentSlide&&!$scope.$currentTransition&&goNext(nextSlide,nextIndex,direction)};function goNext(slide,index,direction){destroyed||(angular.extend(slide,{direction:direction,active:!0}),angular.extend(self.currentSlide||{},{direction:direction,active:!1}),$animate.enabled()&&!$scope.noTransition&&!$scope.$currentTransition&&slide.$element&&self.slides.length>1&&(slide.$element.data(SLIDE_DIRECTION,slide.direction),self.currentSlide&&self.currentSlide.$element&&self.currentSlide.$element.data(SLIDE_DIRECTION,slide.direction),$scope.$currentTransition=!0,NEW_ANIMATE?$animate.on("addClass",slide.$element,function(element,phase){"close"===phase&&($scope.$currentTransition=null,$animate.off("addClass",element))}):slide.$element.one("$animate:close",function(){$scope.$currentTransition=null})),self.currentSlide=slide,currentIndex=index,$scope.active_slide_index=currentIndex,restartTimer())}$scope.$on("$destroy",function(){destroyed=!0});function getSlideByIndex(index){if(angular.isUndefined(slides[index].index))return slides[index];var i;slides.length;for(i=0;i<slides.length;++i)if(slides[i].index==index)return slides[i]}self.getCurrentIndex=function(){return self.currentSlide&&angular.isDefined(self.currentSlide.index)?+self.currentSlide.index:currentIndex},$scope.indexOfSlide=function(slide){return angular.isDefined(slide.index)?+slide.index:slides.indexOf(slide)},$scope.next=function(){var newIndex=(self.getCurrentIndex()+1)%slides.length;return 0===newIndex&&$scope.noWrap()?void $scope.pause():self.select(getSlideByIndex(newIndex),"next")},$scope.prev=function(){var newIndex=self.getCurrentIndex()-1<0?slides.length-1:self.getCurrentIndex()-1;return $scope.noWrap()&&newIndex===slides.length-1?void $scope.pause():self.select(getSlideByIndex(newIndex),"prev")},$scope.isActive=function(slide){return self.currentSlide===slide},$scope.$watch("interval",restartTimer),$scope.$on("$destroy",resetTimer);function restartTimer(){resetTimer();var interval=+$scope.interval;!isNaN(interval)&&interval>0&&(currentInterval=$interval(timerFn,interval))}function resetTimer(){currentInterval&&($interval.cancel(currentInterval),currentInterval=null)}function timerFn(){var interval=+$scope.interval;isPlaying&&!isNaN(interval)&&interval>0&&slides.length?$scope.next():$scope.pause()}$scope.play=function(){isPlaying||(isPlaying=!0,restartTimer())},$scope.pause=function(){$scope.noPause||(isPlaying=!1,resetTimer())},self.addSlide=function(slide,element){slide.$element=element,slides.push(slide),1===slides.length||slide.active?(self.select(slides[slides.length-1]),1===slides.length&&$scope.play()):slide.active=!1},self.removeSlide=function(slide){angular.isDefined(slide.index)&&slides.sort(function(a,b){return+a.index>+b.index});var index=slides.indexOf(slide);slides.splice(index,1),slides.length>0&&slide.active?index>=slides.length?self.select(slides[index-1]):self.select(slides[index]):currentIndex>index&&currentIndex--,0===slides.length&&(self.currentSlide=null)},$scope.$watch("noTransition",function(noTransition){$element.data(NO_TRANSITION,noTransition)})}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",controllerAs:"carousel",require:"carousel",templateUrl:function(element,attrs){return attrs.templateUrl||"partials/template/carousel/carousel.html"},scope:{interval:"=",noTransition:"=",noPause:"=",noWrap:"&"}}}]).directive("slide",function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:function(element,attrs){return attrs.templateUrl||"partials/template/carousel/slide.html"},scope:{active:"=?",actual:"=?",index:"=?"},link:function(scope,element,attrs,carouselCtrl){carouselCtrl.addSlide(scope,element),scope.$on("$destroy",function(){carouselCtrl.removeSlide(scope)}),scope.$watch("active",function(active){active&&carouselCtrl.select(scope)})}}}).animation(".item",["$injector","$animate",function($injector,$animate){var NO_TRANSITION="uib-noTransition",SLIDE_DIRECTION="uib-slideDirection",$animateCss=null;$injector.has("$animateCss")&&($animateCss=$injector.get("$animateCss"));function removeClass(element,className,callback){element.removeClass(className),callback&&callback()}return{beforeAddClass:function(element,className,done){if("active"==className&&element.parent()&&!element.parent().data(NO_TRANSITION)){var stopped=!1,direction=element.data(SLIDE_DIRECTION),directionClass="next"==direction?"left":"right",removeClassFn=removeClass.bind(this,element,directionClass+" "+direction,done);return element.addClass(direction),$animateCss?$animateCss(element,{addClass:directionClass}).start().done(removeClassFn):$animate.addClass(element,directionClass).then(function(){stopped||removeClassFn(),done()}),function(){stopped=!0}}done()},beforeRemoveClass:function(element,className,done){if("active"===className&&element.parent()&&!element.parent().data(NO_TRANSITION)){var stopped=!1,direction=element.data(SLIDE_DIRECTION),directionClass="next"==direction?"left":"right",removeClassFn=removeClass.bind(this,element,directionClass,done);return $animateCss?$animateCss(element,{addClass:directionClass}).start().done(removeClassFn):$animate.addClass(element,directionClass).then(function(){stopped||removeClassFn(),done()}),function(){stopped=!0}}done()}}}]),angular.module("CollapseDirective",[]).directive("uibCollapse",["$animate","$injector",function($animate,$injector){var $animateCss=$injector.has("$animateCss")?$injector.get("$animateCss"):null;return{link:function(scope,element,attrs){function expand(){element.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),$animateCss?$animateCss(element,{addClass:"in",easing:"ease",to:{height:element[0].scrollHeight+"px"}}).start().done(expandDone):$animate.addClass(element,"in",{to:{height:element[0].scrollHeight+"px"}}).then(expandDone)}function expandDone(){element.removeClass("collapsing").addClass("collapse").css({height:"auto"})}function collapse(){return element.hasClass("collapse")||element.hasClass("in")?(element.css({height:element[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),void($animateCss?$animateCss(element,{removeClass:"in",to:{height:"0"}}).start().done(collapseDone):$animate.removeClass(element,"in",{to:{height:"0"}}).then(collapseDone))):collapseDone()}function collapseDone(){element.css({height:"0"}),element.removeClass("collapsing").addClass("collapse")}scope.$watch(attrs.uibCollapse,function(shouldCollapse){shouldCollapse?collapse():expand()})}}}]),angular.module("CollapseDirective").value("$collapseSuppressWarning",!1).directive("collapse",["$animate","$injector","$log","$collapseSuppressWarning",function($animate,$injector,$log,$collapseSuppressWarning){var $animateCss=$injector.has("$animateCss")?$injector.get("$animateCss"):null;return{link:function(scope,element,attrs){$collapseSuppressWarning||$log.warn("collapse is now deprecated. Use uib-collapse instead.");function expand(){element.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),$animateCss?$animateCss(element,{addClass:"in",easing:"ease",to:{height:element[0].scrollHeight+"px"}}).start().done(expandDone):$animate.addClass(element,"in",{to:{height:element[0].scrollHeight+"px"}}).then(expandDone)}function expandDone(){element.removeClass("collapsing").addClass("collapse").css({height:"auto"})}function collapse(){return element.hasClass("collapse")||element.hasClass("in")?(element.css({height:element[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),void($animateCss?$animateCss(element,{removeClass:"in",to:{height:"0"}}).start().done(collapseDone):$animate.removeClass(element,"in",{to:{height:"0"}}).then(collapseDone))):collapseDone()}function collapseDone(){element.css({height:"0"}),element.removeClass("collapsing").addClass("collapse")}scope.$watch(attrs.collapse,function(shouldCollapse){shouldCollapse?collapse():expand()})}}}]),angular.module("CourseListDirective",[]).directive("courseList",function($window){return{scope:{courses:"=courseList"},replace:!0,restrict:"A",templateUrl:"partials/home/course/list-item.html",link:function(scope,element,attrs){}}}),angular.module("LayoutDirective",[]).directive("header",function(){return{restrict:"E",templateUrl:"partials/admin/layout/header.html"}}).directive("aside",function(){return{restrict:"E",templateUrl:"partials/admin/layout/sidebar.html"}}).directive("footer",function(){return{restrict:"E",templateUrl:"partials/admin/layout/footer.html"}}).directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(scope,element,attrs){element.replaceWith(element.children())}}}),angular.module("LoadingDirective",[]).directive("loading",function(){return{restrict:"A",template:"<div></div><div></div><div></div>",link:function(scope,element,attrs){attrs.loading&&"A"!=attrs.loading?"B"==attrs.loading?(angular.element(element).attr("class","loading line-spin-fade"),angular.element(element).html("<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>")):"C"==attrs.loading&&(angular.element(element).attr("class","loading line-scale"),angular.element(element).html("<div></div><div></div><div></div><div></div><div></div>")):angular.element(element).attr("class","loading ball-beat")}}}),angular.module("PaginationDirective",[]).controller("PaginationController",["$scope","$attrs","$parse",function($scope,$attrs,$parse){var self=this,ngModelCtrl={$setViewValue:angular.noop},setNumPages=$attrs.numPages?$parse($attrs.numPages).assign:angular.noop;this.init=function(ngModelCtrl_,config){ngModelCtrl=ngModelCtrl_,this.config=config,ngModelCtrl.$render=function(){self.render()},$attrs.itemsPerPage?$scope.$parent.$watch($parse($attrs.itemsPerPage),function(value){self.itemsPerPage=parseInt(value,10),$scope.totalPages=self.calculateTotalPages()}):this.itemsPerPage=config.itemsPerPage,$scope.$watch("totalItems",function(){$scope.totalPages=self.calculateTotalPages()}),$scope.$watch("totalPages",function(value){setNumPages($scope.$parent,value),$scope.page>value?$scope.selectPage(value):ngModelCtrl.$render()})},this.calculateTotalPages=function(){var totalPages=this.itemsPerPage<1?1:Math.ceil($scope.totalItems/this.itemsPerPage);return Math.max(totalPages||0,1)},this.render=function(){$scope.page=parseInt(ngModelCtrl.$viewValue,10)||1},$scope.selectPage=function(page,evt){evt&&evt.preventDefault();var clickAllowed=!$scope.ngDisabled||!evt;clickAllowed&&$scope.page!==page&&page>0&&page<=$scope.totalPages&&(evt&&evt.target&&evt.target.blur(),ngModelCtrl.$setViewValue(page),ngModelCtrl.$render())},$scope.getText=function(key){return $scope[key+"Text"]||self.config[key+"Text"]},$scope.noPrevious=function(){return 1===$scope.page},$scope.noNext=function(){return $scope.page===$scope.totalPages}}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"首页",previousText:"上一页",nextText:"下一页",lastText:"末页",rotate:!0}).directive("pagination",["$parse","paginationConfig",function($parse,paginationConfig){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@",ngDisabled:"="},require:["pagination","?ngModel"],controller:"PaginationController",controllerAs:"pagination",templateUrl:function(element,attrs){return attrs.templateUrl||"partials/template/pagination/pagination.html"},replace:!0,link:function(scope,element,attrs,ctrls){var paginationCtrl=ctrls[0],ngModelCtrl=ctrls[1];if(ngModelCtrl){var maxSize=angular.isDefined(attrs.maxSize)?scope.$parent.$eval(attrs.maxSize):paginationConfig.maxSize,rotate=angular.isDefined(attrs.rotate)?scope.$parent.$eval(attrs.rotate):paginationConfig.rotate;scope.boundaryLinks=angular.isDefined(attrs.boundaryLinks)?scope.$parent.$eval(attrs.boundaryLinks):paginationConfig.boundaryLinks,scope.directionLinks=angular.isDefined(attrs.directionLinks)?scope.$parent.$eval(attrs.directionLinks):paginationConfig.directionLinks,paginationCtrl.init(ngModelCtrl,paginationConfig),attrs.maxSize&&scope.$parent.$watch($parse(attrs.maxSize),function(value){maxSize=parseInt(value,10),paginationCtrl.render()});function makePage(number,text,isActive){return{number:number,text:text,active:isActive}}function getPages(currentPage,totalPages){var pages=[],startPage=1,endPage=totalPages,isMaxSized=angular.isDefined(maxSize)&&totalPages>maxSize;isMaxSized&&(rotate?(startPage=Math.max(currentPage-Math.floor(maxSize/2),1),endPage=startPage+maxSize-1,endPage>totalPages&&(endPage=totalPages,startPage=endPage-maxSize+1)):(startPage=(Math.ceil(currentPage/maxSize)-1)*maxSize+1,endPage=Math.min(startPage+maxSize-1,totalPages)));for(var number=startPage;endPage>=number;number++){var page=makePage(number,number,number===currentPage);pages.push(page)}if(isMaxSized&&!rotate){if(startPage>1){var previousPageSet=makePage(startPage-1,"...",!1);pages.unshift(previousPageSet)}if(totalPages>endPage){var nextPageSet=makePage(endPage+1,"...",!1);pages.push(nextPageSet)}}return pages}var originalRender=paginationCtrl.render;paginationCtrl.render=function(){originalRender(),scope.page>0&&scope.page<=scope.totalPages&&(scope.pages=getPages(scope.page,scope.totalPages))}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« 上一页",nextText:"下一页 »",align:!0}).directive("pager",["pagerConfig",function(pagerConfig){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@",ngDisabled:"="},require:["pager","?ngModel"],controller:"PaginationController",controllerAs:"pagination",templateUrl:function(element,attrs){return attrs.templateUrl||"partials/template/pagination/pager.html"},replace:!0,link:function(scope,element,attrs,ctrls){var paginationCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&(scope.align=angular.isDefined(attrs.align)?scope.$parent.$eval(attrs.align):pagerConfig.align,paginationCtrl.init(ngModelCtrl,pagerConfig))}}}]),angular.module("Qupload",["angular.modal","FileService"]).service("$qupload",["$http","$q","$localStorage",function($http,$q,$localStorage){function utf16to8(str){var out,i,len,c;for(out="",len=str.length,i=0;len>i;i++)c=str.charCodeAt(i),c>=1&&127>=c?out+=str.charAt(i):c>2047?(out+=String.fromCharCode(224|c>>12&15),out+=String.fromCharCode(128|c>>6&63),out+=String.fromCharCode(128|c>>0&63)):(out+=String.fromCharCode(192|c>>6&31),out+=String.fromCharCode(128|c>>0&63));return out}var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function base64encode(str){var out,i,len,c1,c2,c3;for(len=str.length,i=0,out="";len>i;){if(c1=255&str.charCodeAt(i++),i==len){out+=base64EncodeChars.charAt(c1>>2),out+=base64EncodeChars.charAt((3&c1)<<4),out+="==";break}if(c2=str.charCodeAt(i++),i==len){out+=base64EncodeChars.charAt(c1>>2),out+=base64EncodeChars.charAt((3&c1)<<4|(240&c2)>>4),out+=base64EncodeChars.charAt((15&c2)<<2),out+="=";break}c3=str.charCodeAt(i++),out+=base64EncodeChars.charAt(c1>>2),out+=base64EncodeChars.charAt((3&c1)<<4|(240&c2)>>4),out+=base64EncodeChars.charAt((15&c2)<<2|(192&c3)>>6),out+=base64EncodeChars.charAt(63&c3)}return out}var uploadEndPoint="http://up.qiniu.com";window&&window.location&&"https:"===window.location.protocol&&(uploadEndPoint="https://up.qbox.me");var defaultsSetting={chunkSize:4194304,mkblkEndPoint:uploadEndPoint+"/mkblk/",mkfileEndPoint:uploadEndPoint+"/mkfile/",maxRetryTimes:3};if(this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.slice&&!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice),!this.support)return null;var fileHashKeyFunc=function(file){return file.name+file.lastModified+file.size+file.type};this.upload=function(config){var deferred=$q.defer(),promise=deferred.promise,file=config.file;if(file){var blockRet=(fileHashKeyFunc(file),$localStorage.fileHashKey);blockRet||(blockRet=[]);var xhr,blkCount=file.size+4194303>>22,getChunck=function(file,startByte,endByte){return file[file.slice?"slice":file.mozSlice?"mozSlice":file.webkitSlice?"webkitSlice":"slice"](startByte,endByte)},getBlkSize=function(file,blkCount,blkIndex){return blkIndex===blkCount-1?file.size-4194304*blkIndex:4194304},mkfile=function(file,blockRet){if(0!==blockRet.length){for(var b,body="",i=0;i<blockRet.length-1;i++)b=angular.fromJson(blockRet[i]),body+=b.ctx+",";b=angular.fromJson(blockRet[blockRet.length-1]),body+=b.ctx;var url=defaultsSetting.mkfileEndPoint+file.size;config&&config.key&&(url+="/key/"+base64encode(utf16to8(config.key))),$http({url:url,method:"POST",data:body,headers:{Authorization:"UpToken "+config.token,"Content-Type":"text/plain"}}).success(function(e){deferred.resolve(e),$localStorage.fileHashKey=""}).error(function(e){deferred.reject(e)})}},mkblk=function(file,i,retry){if(i===blkCount)return void mkfile(file,blockRet);if(!retry)return void deferred.reject("max retried,still failure");var blkSize=getBlkSize(file,blkCount,i),offset=4194304*i,chunck=getChunck(file,offset,offset+blkSize);xhr=new XMLHttpRequest,xhr.open("POST",defaultsSetting.mkblkEndPoint+blkSize,!0),xhr.setRequestHeader("Authorization","UpToken "+config.token),xhr.upload.addEventListener("progress",function(evt){if(evt.lengthComputable){var nevt={totalSize:file.size,loaded:evt.loaded+offset};deferred.notify(nevt)}}),xhr.upload.onerror=function(){mkblk(config.file,i,--retry)},xhr.onreadystatechange=function(response){response&&4===xhr.readyState&&200===xhr.status&&(200===xhr.status?(blockRet[i]=xhr.responseText,$localStorage.fileHashKey=blockRet,mkblk(config.file,++i,defaultsSetting.maxRetryTimes)):mkblk(config.file,i,--retry))},xhr.send(chunck)};return mkblk(config.file,blockRet.length,defaultsSetting.maxRetryTimes),promise.abort=function(){xhr.abort(),$localStorage.fileHashKey=""},promise.pause=function(){xhr.abort()},promise}}}]).controller("FileController",["$localStorage","$rootScope","$scope","$attrs","$parse","$qupload","$modal","FileService",function($localStorage,$rootScope,$scope,$attrs,$parse,$qupload,$modal,FileService){var self=this;$scope.$parent.$parent.is_upload=!1,$rootScope.uploading=!1,$scope.select_files=[],$scope.is_modal=!1,$scope.upload_precent=0,$scope.file={path:"",data:""},this.getUptoken=function(type,key){var result="";if("file"==type)result=FileService.getFileUptoken({}).$promise;else if("video"==type){if(!key||""==key)return!1;result=FileService.getVideoUptoken({key:key}).$promise}return result},this.onUploaded=function(callback){"function"==typeof callback?callback($scope.file.data):eval(callback)},this.start=function(index,uptoken,key){$scope.select_files[index].progress={precent:0},$scope.select_files[index].upload=$qupload.upload({key:key,file:$scope.select_files[index].file,token:uptoken}),$scope.select_files[index].upload.then(function(response){if(1==response.code){$scope.$parent.$parent.is_upload=!1,$rootScope.uploading=!1,$scope.is_modal?alert("上传成功"):$modal.success({title:"操作成功",message:"上传成功"});var res=response.result;$scope.file.data=res,$scope.file.path=$rootScope.config.fileUrl+res.key,$scope.$parent.section&&($scope.$parent.section.status=1,$scope.video_status=1,$scope.videoStatusCheck())}else $scope.$parent.section&&($scope.$parent.section.status=-1,$scope.video_status=-1,$scope.videoStatusCheck()),$scope.is_modal?alert("上传失败"):$modal.error({title:"上传失败",message:response.message})},function(response){console.log(response),$rootScope.modal.closeLoading(),$scope.is_modal?alert("上传失败，上传发生了未知错误，请重试"):$modal.error({title:"上传错误",message:"上传发生了未知错误，请重试"}),$scope.$parent.section&&($scope.$parent.section.status=-1,$scope.video_status=-1,$scope.videoStatusCheck())},function(evt){$scope.$parent.$parent.is_upload=!0,$rootScope.uploading=!0,$scope.select_files[index].progress.precent=Math.floor(100*evt.loaded/evt.totalSize),$scope.upload_precent=Math.floor(100*evt.loaded/evt.totalSize),100==$scope.upload_precent&&($scope.video_text="正在处理")})},$scope.abort=function(index){$scope.select_files[index].upload.abort(),$scope.select_files.splice(index,1)},$scope.pause=function(index){$scope.select_files[index].upload.abort()},$scope.hoverEvent=function(action){var value=$scope.video_status;"over"==action&&0!=value?$scope.video_text="重新上传":$scope.videoStatusCheck()},$scope.videoStatusCheck=function(){var value=$scope.video_status;switch(value){case 0:$scope.video_text="上传视频";break;
case 1:$scope.video_text="正在转码";break;case 2:$scope.video_text="等待审核";break;case 3:$scope.video_text="发布成功";break;case-1:$scope.video_text="上传失败";break;case-2:$scope.video_text="转码失败";break;case-3:$scope.video_text="审核失败";break;default:$scope.video_text="重新上传"}},$scope.$watch("video_status",function(video_status){$scope.videoStatusCheck()}),$scope.onFileSelect=function($files,type,key,default_params,is_modal){$scope.is_modal=is_modal;var fileUpload=function(){$localStorage.fileHashKey="";var update_type="video"==type?"video":"file",token=self.getUptoken(update_type,key);token.then(function(res){if(1==res.code)for(var offsetx=$scope.select_files.length,i=0;i<$files.length;i++)$scope.select_files[i+offsetx]={file:$files[i]},self.start(i+offsetx,res.result,key);else $modal.error({title:"上传错误",message:res.message})})},params={};if(default_params&&(params=default_params),"image"!=type||params.max_size||(params.max_size=5),0==$files.length)return!1;if(params.max_size&&$files[0].size>1048576*params.max_size)return is_modal?alert("上传错误"):$modal.error({title:"上传错误",message:"请上传"+params.max_size+"M大小以内的文件！"}),!1;if("image"==type){if(!($files[0].type.indexOf("image")>=0))return is_modal?alert("上传错误，请上传正确格式的图片"):$modal.error({title:"上传错误",message:"请上传正确格式的图片"}),!1;if(params.min_height||params.min_width){var reader=new FileReader;return reader.readAsDataURL($files[0]),reader.onload=function(element){var data=element.target.result,image=new Image;image.onload=function(){var img_width=image.width,img_height=image.height;return img_height<params.min_height||img_width<params.min_width?(is_modal?alert("上传错误，图片尺寸最小为"+params.min_width+"×"+params.min_height):$modal.error({title:"上传错误",message:"图片尺寸最小为"+params.min_width+"×"+params.min_height}),!1):void fileUpload()},image.src=data},!1}}if("video"==type){if(""==key)return!1;if($files[0].type.indexOf("video")<0)return is_modal?alert("上传错误，请上传正确视频格式的文件"):$modal.error({title:"上传错误",message:"请上传正确视频格式的文件"}),!1}fileUpload()}}]).directive("ngFileSelect",["$parse","$timeout",function($parse,$timeout){return{scope:{onUploaded:"&uploaded",disabled:"=ngDisabled"},controller:"FileController",restrict:"EA",templateUrl:function(element,attrs){return attrs.templateUrl||"partials/template/qupload/file.html"},transclude:!0,replace:!0,link:function(scope,element,attrs,ctrls){var fileSelect=$parse(attrs.ngFileSelect);angular.isDefined(attrs.defaultFile)?scope.$parent.$eval(attrs.defaultFile):"",angular.isDefined(attrs.defaultStatus)?scope.$parent.$eval(attrs.defaultStatus):"";if(scope.video_text="上传视频",scope.video_status=0,attrs.defaultStatus&&scope.$parent.$watch($parse(attrs.defaultStatus),function(value){scope.video_status=value}),attrs.defaultFile&&scope.$parent.$watch($parse(attrs.defaultFile),function(value){value&&(scope.file.path=value)}),void 0!=scope.disabled&&scope.$watch("disabled",function(){scope.disabled?(element.attr("disabled",!0),element.addClass("disabled"),element.parent().addClass("disabled")):(element.removeAttr("disabled"),element.removeClass("disabled"),element.parent().removeClass("disabled"))}),scope.$watch("file.data",function(){attrs.uploaded&&scope.$parent.$watch($parse(attrs.uploaded),function(callback){void 0!==callback&&ctrls.onUploaded(callback)})}),"input"!==element[0].tagName.toLowerCase()||"file"!==(element.attrs("type")&&element.attrs("type").toLowerCase())){for(var fileElem=angular.element('<input type="file">'),i=0;i<element[0].attributes.length;i++)fileElem.attr(element[0].attributes[i].name,element[0].attributes[i].value);element.append(fileElem),element=fileElem}element.bind("change",function(evt){var fileList,i,files=[];if(fileList=evt.__files_||evt.target.files,null!==fileList)for(i=0;i<fileList.length;i++)files.push(fileList.item(i));$timeout(function(){fileSelect(scope,{$files:files,$event:evt})})})}}}]),angular.module("ScrolledDirective",[]).directive("whenScrolled",function(){return function(scope,element,attrs){var raw=element[0];element.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attrs.whenScrolled)})}}),angular.module("TabsDirective",[]).controller("TabsetController",["$scope",function($scope){var ctrl=this,tabs=ctrl.tabs=$scope.tabs=[];ctrl.select=function(selectedTab){angular.forEach(tabs,function(tab){tab.active&&tab!==selectedTab&&(tab.active=!1,tab.onDeselect(),selectedTab.selectCalled=!1)}),selectedTab.active=!0,selectedTab.selectCalled||(selectedTab.onSelect(),selectedTab.selectCalled=!0)},ctrl.addTab=function(tab){tabs.push(tab),1===tabs.length&&tab.active!==!1?tab.active=!0:tab.active?ctrl.select(tab):tab.active=!1},ctrl.removeTab=function(tab){var index=tabs.indexOf(tab);if(tab.active&&tabs.length>1&&!destroyed){var newActiveIndex=index==tabs.length-1?index-1:index+1;ctrl.select(tabs[newActiveIndex])}tabs.splice(index,1)},ctrl.changeTo=function(tab){var index=tabs.indexOf(tab),newActiveIndex=index;ctrl.select(tabs[newActiveIndex])};var destroyed;$scope.$on("$destroy",function(){destroyed=!0})}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{type:"@"},controller:"TabsetController",templateUrl:"partials/template/tabs/tabset.html",link:function(scope,element,attrs){scope.vertical=angular.isDefined(attrs.vertical)?scope.$parent.$eval(attrs.vertical):!1,scope.justified=angular.isDefined(attrs.justified)?scope.$parent.$eval(attrs.justified):!1,scope.largesize=angular.isDefined(attrs.largesize)?scope.$parent.$eval(attrs.largesize):!1}}}).directive("tab",["$parse",function($parse){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"partials/template/tabs/tab.html",transclude:!0,scope:{active:"=?",heading:"@",icon:"@",onSelect:"&select",onDeselect:"&deselect",changeTo:"&change"},controller:function(){},link:function(scope,elm,attrs,tabsetCtrl,transclude){scope.$watch("active",function(active){active&&tabsetCtrl.select(scope)}),scope.disabled=!1,attrs.disable&&scope.$parent.$watch($parse(attrs.disable),function(value){scope.disabled=!!value}),scope.select=function(){scope.disabled||(scope.active=!0)},tabsetCtrl.addTab(scope),scope.$on("$destroy",function(){tabsetCtrl.removeTab(scope)}),scope.$transcludeFn=transclude}}}]).directive("tabHeadingTransclude",function(){return{restrict:"A",require:"^tab",link:function(scope,elm,attrs,tabCtrl){scope.$watch("headingElement",function(heading){heading&&(elm.html(""),elm.append(heading))})}}}).directive("tabContentTransclude",function(){return{restrict:"A",require:"^tabset",link:function(scope,elm,attrs){var tab=scope.$eval(attrs.tabContentTransclude);tab.$transcludeFn(tab.$parent,function(contents){angular.forEach(contents,function(node){isTabHeading(node)?tab.headingElement=node:elm.append(node)})})}};function isTabHeading(node){return node.tagName&&(node.hasAttribute("tab-heading")||node.hasAttribute("data-tab-heading")||node.hasAttribute("x-tab-heading")||"tab-heading"===node.tagName.toLowerCase()||"data-tab-heading"===node.tagName.toLowerCase()||"x-tab-heading"===node.tagName.toLowerCase())}}),angular.module("TooltipDirective",[]).directive("tooltip",function($window){return{restrict:"A",scope:{toolpos:"@",tooltip:"@",title:"@",tooltit:"="},link:function($scope,$element,$attrs){var tooltip=function(){var self=this;this.tigger=$scope.tooltip||"normal",this.position=$scope.toolpos||"center",this.title=$scope.tooltit||$scope.title||"",this.display=!1,this.visible=function(option){if(self.title=$scope.tooltit||$scope.title||"",!self.title)return!1;document.getElementById("J_tooltip")&&angular.element(document.getElementById("J_tooltip")).remove(),$element.addClass("tooltip-active");var tooltip_template='<div id="J_tooltip" class="tooltip tooltip-hidden">';tooltip_template+='<div class="tooltip-inner">',tooltip_template+='<span class="tooltip-text">'+self.title+"</span>",tooltip_template+='<span class="tooltip-sulg"></span>',tooltip_template+="</div></div>",angular.element(document.body).append(tooltip_template);var tool_element=angular.element(document.getElementById("J_tooltip")),tool_position=function(){switch(self.position){case"center":return $element[0].getBoundingClientRect().left+$element[0].offsetWidth/2-document.getElementById("J_tooltip").offsetWidth/2+"px";case"left":return $element[0].getBoundingClientRect().left-document.getElementById("J_tooltip").offsetWidth/2+"px";case"right":return $element[0].getBoundingClientRect().left+$element[0].offsetWidth-document.getElementById("J_tooltip").offsetWidth/2+"px";default:return $element[0].getBoundingClientRect().left+$element[0].offsetWidth/2-document.getElementById("J_tooltip").offsetWidth/2+"px"}};tool_element.css("left",tool_position()),tool_element.css("top",$element[0].getBoundingClientRect().top-40+"px"),tool_element.removeClass("tooltip-hidden"),tool_element.addClass("tooltip-display"),self.display=!0,option&&option.autohide&&setTimeout(function(){$element.removeClass("tooltip-active"),tool_element.removeClass("tooltip-display"),tool_element.addClass("tooltip-hidden"),$scope.tooltit=""},600),self.scroll(),self.resize()},this.hidden=function(){$element.removeClass("tooltip-active");var tool_element=angular.element(document.getElementById("J_tooltip"));tool_element.removeClass("tooltip-display"),tool_element.addClass("tooltip-hidden"),setTimeout(function(){tool_element.remove()},500),self.display=!1},this.hover=function(){var title=$attrs.title;$element.bind("mouseover",function(){void 0!=$attrs.title&&""!=$attrs.title&&($element.attr("title",""),self.visible())}),$element.bind("mouseout",function(){$element.attr("title",title),self.hidden()})},this.focus=function(){"INPUT"==$element[0].tagName.toUpperCase()?($element.bind("focus",function(){self.visible()}),$element.bind("blur",function(){self.hidden()})):($element.bind("click",function(){self.display?self.hidden():self.visible()}),$element.bind("blur",function(){self.hidden()}))},this.event=function(){$scope.$watch("tooltit",function(){self.title=$scope.tooltit,self.visible({autohide:!0})})},this.bind=function(){switch(self.tigger){case"normal":self.hover();break;case"focus":self.focus();break;case"event":self.event()}},this.scroll=function(){angular.element($window).bind("scroll",function(){angular.element(document.getElementById("J_tooltip"))&&self.hidden()})},this.resize=function(){angular.element($window).bind("resize",function(){})}},_tooltip=new tooltip;_tooltip.bind()}}}),angular.module("TotopDirective",[]).directive("goToTop",function($window){return{replace:!0,restrict:"A",template:'<a href="" class="go-to-top"><i class="icon icon-to-top"></i></a>',link:function(scope,element,attrs){var window_height=$window.innerHeight;angular.element($window).bind("resize",function(){window_height=$window.innerHeight}),$window.pageYOffset<=window_height/2&&(element.removeClass("display"),element.addClass("none"),element.prev().addClass("is-top")),angular.element($window).bind("scroll",function(){$window.pageYOffset<=window_height/2?(element.removeClass("display"),element.addClass("none"),element.prev().addClass("is-top")):(element.removeClass("none"),element.addClass("display"),element.prev().removeClass("is-top"))}),element.bind("click",function(){var scrollTo=function(element,to,duration){if(!(0>=duration)){var difference=to-element.scrollTop,perTick=difference/duration*10;setTimeout(function(){element.scrollTop=element.scrollTop+perTick,element.scrollTop!=to&&scrollTo(element,to,duration-10)},10)}};scrollTo(document.body,0,300)})}}}),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]),angular.module("TypeaheadDirective",["ui.bootstrap.position"]).factory("typeaheadParser",["$parse",function($parse){var TYPEAHEAD_REGEXP=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(input){var match=input.match(TYPEAHEAD_REGEXP);if(!match)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+input+'".');return{itemName:match[3],source:$parse(match[4]),viewMapper:$parse(match[2]||match[1]),modelMapper:$parse(match[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$window","$rootScope","$position","typeaheadParser",function($compile,$parse,$q,$timeout,$document,$window,$rootScope,$position,typeaheadParser){var HOT_KEYS=[9,13,27,38,40],eventDebounceTime=200;return{require:["ngModel","^?ngModelOptions"],link:function(originalScope,element,attrs,ctrls){var modelCtrl=ctrls[0],ngModelOptions=ctrls[1],minLength=originalScope.$eval(attrs.typeaheadMinLength);minLength||0===minLength||(minLength=1);var hasFocus,selected,waitTime=originalScope.$eval(attrs.typeaheadWaitMs)||0,isEditable=originalScope.$eval(attrs.typeaheadEditable)!==!1,isLoadingSetter=$parse(attrs.typeaheadLoading).assign||angular.noop,onSelectCallback=$parse(attrs.typeaheadOnSelect),isSelectOnBlur=angular.isDefined(attrs.typeaheadSelectOnBlur)?originalScope.$eval(attrs.typeaheadSelectOnBlur):!1,isNoResultsSetter=$parse(attrs.typeaheadNoResults).assign||angular.noop,inputFormatter=attrs.typeaheadInputFormatter?$parse(attrs.typeaheadInputFormatter):void 0,appendToBody=attrs.typeaheadAppendToBody?originalScope.$eval(attrs.typeaheadAppendToBody):!1,focusFirst=originalScope.$eval(attrs.typeaheadFocusFirst)!==!1,selectOnExact=attrs.typeaheadSelectOnExact?originalScope.$eval(attrs.typeaheadSelectOnExact):!1,parsedModel=$parse(attrs.ngModel),invokeModelSetter=$parse(attrs.ngModel+"($$$p)"),$setModelValue=function(scope,newValue){return angular.isFunction(parsedModel(originalScope))&&ngModelOptions&&ngModelOptions.$options&&ngModelOptions.$options.getterSetter?invokeModelSetter(scope,{$$$p:newValue}):parsedModel.assign(scope,newValue)},parserResult=typeaheadParser.parse(attrs.typeahead),scope=originalScope.$new(),offDestroy=originalScope.$on("$destroy",function(){scope.$destroy()});scope.$on("$destroy",offDestroy);var popupId="typeahead-"+scope.$id+"-"+Math.floor(1e4*Math.random());element.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":popupId});var popUpEl=angular.element("<div typeahead-popup></div>");popUpEl.attr({id:popupId,matches:"matches",active:"activeIdx",select:"select(activeIdx)","move-in-progress":"moveInProgress",query:"query",position:"position"}),angular.isDefined(attrs.typeaheadTemplateUrl)&&popUpEl.attr("template-url",attrs.typeaheadTemplateUrl),angular.isDefined(attrs.typeaheadPopupTemplateUrl)&&popUpEl.attr("popup-template-url",attrs.typeaheadPopupTemplateUrl);var resetMatches=function(){scope.matches=[],scope.activeIdx=-1,element.attr("aria-expanded",!1)},getMatchId=function(index){return popupId+"-option-"+index};scope.$watch("activeIdx",function(index){0>index?element.removeAttr("aria-activedescendant"):element.attr("aria-activedescendant",getMatchId(index))});var inputIsExactMatch=function(inputValue,index){return scope.matches.length>index&&inputValue?inputValue.toUpperCase()===scope.matches[index].label.toUpperCase():!1},getMatchesAsync=function(inputValue){var locals={$viewValue:inputValue};isLoadingSetter(originalScope,!0),isNoResultsSetter(originalScope,!1),$q.when(parserResult.source(originalScope,locals)).then(function(matches){var onCurrentRequest=inputValue===modelCtrl.$viewValue;if(onCurrentRequest&&hasFocus)if(matches&&matches.length>0){scope.activeIdx=focusFirst?0:-1,isNoResultsSetter(originalScope,!1),scope.matches.length=0;for(var i=0;i<matches.length;i++)locals[parserResult.itemName]=matches[i],scope.matches.push({id:getMatchId(i),label:parserResult.viewMapper(scope,locals),model:matches[i]});scope.query=inputValue,recalculatePosition(),element.attr("aria-expanded",!0),selectOnExact&&1===scope.matches.length&&inputIsExactMatch(inputValue,0)&&scope.select(0)}else resetMatches(),isNoResultsSetter(originalScope,!0);onCurrentRequest&&isLoadingSetter(originalScope,!1)},function(){resetMatches(),isLoadingSetter(originalScope,!1),isNoResultsSetter(originalScope,!0)})};appendToBody&&(angular.element($window).bind("resize",fireRecalculating),$document.find("body").bind("scroll",fireRecalculating));var timeoutEventPromise;scope.moveInProgress=!1;function fireRecalculating(){scope.moveInProgress||(scope.moveInProgress=!0,scope.$digest()),timeoutEventPromise&&$timeout.cancel(timeoutEventPromise),timeoutEventPromise=$timeout(function(){scope.matches.length&&recalculatePosition(),scope.moveInProgress=!1,scope.$digest()},eventDebounceTime)}function recalculatePosition(){scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top+=element.prop("offsetHeight")}resetMatches(),scope.query=void 0;var timeoutPromise,scheduleSearchWithTimeout=function(inputValue){timeoutPromise=$timeout(function(){getMatchesAsync(inputValue)},waitTime)},cancelPreviousTimeout=function(){timeoutPromise&&$timeout.cancel(timeoutPromise)};modelCtrl.$parsers.unshift(function(inputValue){return hasFocus=!0,0===minLength||inputValue&&inputValue.length>=minLength?waitTime>0?(cancelPreviousTimeout(),scheduleSearchWithTimeout(inputValue)):getMatchesAsync(inputValue):(isLoadingSetter(originalScope,!1),cancelPreviousTimeout(),resetMatches()),isEditable?inputValue:inputValue?void modelCtrl.$setValidity("editable",!1):(modelCtrl.$setValidity("editable",!0),null)}),modelCtrl.$formatters.push(function(modelValue){var candidateViewValue,emptyViewValue,locals={};return isEditable||modelCtrl.$setValidity("editable",!0),inputFormatter?(locals.$model=modelValue,inputFormatter(originalScope,locals)):(locals[parserResult.itemName]=modelValue,candidateViewValue=parserResult.viewMapper(originalScope,locals),locals[parserResult.itemName]=void 0,emptyViewValue=parserResult.viewMapper(originalScope,locals),candidateViewValue!==emptyViewValue?candidateViewValue:modelValue)}),scope.select=function(activeIdx){var model,item,locals={};selected=!0,locals[parserResult.itemName]=item=scope.matches[activeIdx].model,model=parserResult.modelMapper(originalScope,locals),$setModelValue(originalScope,model),modelCtrl.$setValidity("editable",!0),modelCtrl.$setValidity("parse",!0),onSelectCallback(originalScope,{$item:item,$model:model,$label:parserResult.viewMapper(originalScope,locals)}),resetMatches(),scope.$eval(attrs.typeaheadFocusOnSelect)!==!1&&$timeout(function(){element[0].focus()},0,!1)},element.bind("keydown",function(evt){if(0!==scope.matches.length&&-1!==HOT_KEYS.indexOf(evt.which)){if(-1===scope.activeIdx&&(9===evt.which||13===evt.which))return resetMatches(),void scope.$digest();evt.preventDefault(),40===evt.which?(scope.activeIdx=(scope.activeIdx+1)%scope.matches.length,scope.$digest()):38===evt.which?(scope.activeIdx=(scope.activeIdx>0?scope.activeIdx:scope.matches.length)-1,scope.$digest()):13===evt.which||9===evt.which?scope.$apply(function(){scope.select(scope.activeIdx)}):27===evt.which&&(evt.stopPropagation(),resetMatches(),scope.$digest())}}),element.bind("blur",function(){isSelectOnBlur&&scope.matches.length&&-1!==scope.activeIdx&&!selected&&(selected=!0,scope.$apply(function(){scope.select(scope.activeIdx)})),hasFocus=!1,selected=!1});var dismissClickHandler=function(evt){element[0]!==evt.target&&3!==evt.which&&0!==scope.matches.length&&(resetMatches(),$rootScope.$$phase||scope.$digest())};$document.bind("click",dismissClickHandler),originalScope.$on("$destroy",function(){$document.unbind("click",dismissClickHandler),appendToBody&&$popup.remove(),popUpEl.remove()});var $popup=$compile(popUpEl)(scope);appendToBody?$document.find("body").append($popup):element.after($popup)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"&",moveInProgress:"=",select:"&"},replace:!0,templateUrl:function(element,attrs){return attrs.popupTemplateUrl||"partials/template/typeahead/popup.html"},link:function(scope,element,attrs){scope.templateUrl=attrs.templateUrl,scope.isOpen=function(){return scope.matches.length>0},scope.isActive=function(matchIdx){return scope.active==matchIdx},scope.selectActive=function(matchIdx){scope.active=matchIdx},scope.selectMatch=function(activeIdx){scope.select({activeIdx:activeIdx})}}}}).directive("typeaheadMatch",["$templateRequest","$compile","$parse",function($templateRequest,$compile,$parse){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(scope,element,attrs){var tplUrl=$parse(attrs.templateUrl)(scope.$parent)||"partials/template/typeahead/match.html";$templateRequest(tplUrl).then(function(tplContent){$compile(tplContent.trim())(scope,function(clonedElement){element.replaceWith(clonedElement)})})}}}]).filter("typeaheadHighlight",["$sce","$injector","$log",function($sce,$injector,$log){var isSanitizePresent;isSanitizePresent=$injector.has("$sanitize");function escapeRegexp(queryToEscape){return queryToEscape.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function containsHtml(matchItem){return/<.*>/g.test(matchItem)}return function(matchItem,query){return!isSanitizePresent&&containsHtml(matchItem)&&$log.warn("Unsafe use of typeahead please use ngSanitize"),matchItem=query?(""+matchItem).replace(new RegExp(escapeRegexp(query),"gi"),"<strong>$&</strong>"):matchItem,isSanitizePresent||(matchItem=$sce.trustAsHtml(matchItem)),matchItem}}]),angular.module("Umeditor",[]).directive("umeditor",["$timeout",function($timeout){return{restrict:"EA",require:"ngModel",scope:{},link:function(scope,element,attrs,controller){var editor_id=attrs.id?attrs.id:"_editor"+Date.now();element[0].id=editor_id;var umeditor=UM.getEditor(editor_id);controller&&(umeditor.addListener("contentChange",function(){$timeout(function(argument){scope.$apply(function(){controller.$setViewValue(umeditor.getContent())})},0)}),controller.$render=function(){$timeout(function(){void 0!=controller.$viewValue&&umeditor.setContent(controller.$viewValue)},100)})}}}]),angular.module("AdvertiseController",["AdvertiseModel"]).controller("AdvertiseController",["$scope","$rootScope","$state","$stateParams","$location","$modal","AdvertiseModel","CommonProvider",function($scope,$rootScope,$state,$stateParams,$location,$modal,AdvertiseModel,CommonProvider){$scope.filter={},$scope.advertise_list={},$scope.advertiseAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:AdvertiseModel,method:"get",params:params,success:function(_advertise_list){$scope.advertise_list=_advertise_list}})},getItem:function(){CommonProvider.promise({model:AdvertiseModel,method:"item",params:{advertise_id:$stateParams.advertise_id},success:function(_advertise_item){_advertise_item.result.type=_advertise_item.result.type.toString(),$scope.advertise=_advertise_item.result}})},getAdConfig:function(){$rootScope.getConfig({name:"SITE_AD_CONFIG",role:"admin",group:2,success:function(config){$scope.ad_config=config.result}})},add:function(params){CommonProvider.promise({model:AdvertiseModel,method:"add",params:$scope.advertise,success:function(_advertise){$modal.success({message:_advertise.message,callback:function(){$location.path("/advertise/advertise/list/index")}})},error:function(_advertise){$modal.error({message:_advertise.message})}})},edit:function(params){$scope.advertise.type=Number($scope.advertise.type),CommonProvider.promise({model:AdvertiseModel,method:"put",params:$scope.advertise,success:function(_advertise){$modal.success({message:_advertise.message,callback:function(){$location.path("/article/advertise/list/index")}})},error:function(_advertise){$modal.error({message:_advertise.message})}})},del:function(params){return params.batch&&0==$scope.advertise_list.result.checked().length?($modal.error({message:"至少需要选中一个广告"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中广告吗？":"确定要删除此广告吗？",info:"广告删除后可在广告回收站中查看",onsubmit:function(){CommonProvider.promise({model:AdvertiseModel,method:params.batch?"delete":"del",params:params.batch?$scope.advertise_list.result.checked():params.advertise,success:function(_advertise){$modal.success({message:_advertise.message})},error:function(_advertise){$modal.error({message:_advertise.message})}})}})},getUploadThumb:function(data){data&&($scope.advertise.image=data.key)}}}]),angular.module("AnnouncementController",["AnnouncementModel","OrganizationModel"]).controller("AnnouncementController",["$scope","$rootScope","$state","$stateParams","$modal","AnnouncementModel","OrganizationModel","CommonProvider",function($scope,$rootScope,$state,$stateParams,$modal,AnnouncementModel,OrganizationModel,CommonProvider){$scope.announcement_list={},$scope.filter={type:"all",organization_id:null},$scope.announcementAction={filterChanged:function(){$scope.announcementAction.getLists()},getIndex:function(page){$scope.announcementAction.getLists(page),$scope.announcementAction.getOrganizations()},getOrganizations:function(){CommonProvider.promise({model:OrganizationModel,method:"get",params:{per_page:1e3,role:"admin"},success:function(_organizations){$scope.organizations=_organizations.result}})},getLists:function(page){var get_params={role:"admin",page:page||1},filters=$scope.filter;for(var key in filters)"all"!=filters[key]&&filters[key]&&(get_params[key]=filters[key]);CommonProvider.promise({model:AnnouncementModel,method:"get",params:get_params,success:function(_announcement_list){$scope.announcement_list=_announcement_list}})},getItem:function(){CommonProvider.promise({model:AnnouncementModel,method:"item",params:{announcement_id:$stateParams.announcement_id},success:function(announcement_item){$scope.announcement=announcement_item.result}})},item:function(params){params.modal?($rootScope.announcement_item=angular.copy(params.announcement.announcement),$modal.custom({title:"公告详情",template_url:"/partials/admin/article/announcement/item.html",callback:function(){delete $rootScope.announcement_item}})):$rootScope.modal.close()},add:function(params){params.modal?$modal.custom({title:"添加公告",template_url:"/partials/admin/organization/announcement/add.html"}):($scope.announcement.role="admin",CommonProvider.promise({model:AnnouncementModel,method:"add",params:$scope.announcement,success:function(_announcement){$rootScope.modal.close(),$modal.success({message:_announcement.message})},error:function(_announcement){$modal.error({message:_announcement.message})}}))},edit:function(params){params.modal?($rootScope.announcement_local=params.announcement,$rootScope.announcement_edit=angular.copy(params.announcement.announcement),$rootScope.announcement_edit.type=$rootScope.announcement_edit.type.toString(),$modal.custom({title:"编辑公告",template_url:"/partials/admin/organization/announcement/edit.html",callback:function(){delete $rootScope.announcement_edit}})):CommonProvider.promise({model:AnnouncementModel,method:"put",params:{body:$scope.announcement,id:$scope.announcement.id},success:function(_announcement){$rootScope.announcement_local.$parent.announcement=_announcement.result,$rootScope.modal.close(),$modal.success({message:_announcement.message,callback:function(){delete $rootScope.announcement_local}})},error:function(_announcement){$modal.error({message:_announcement.message})}})},del:function(params){if(params.batch&&0==$scope.announcement_list.result.checked().length)return $modal.error({message:"至少需要选中一条公告"}),!1;if(!params.batch)var params_del={announcement_id:params.announcement.announcement.id,role:"admin"};$modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中公告吗？":"确定要删除此公告吗？",info:"公告删除后可在公告回收站中查看",onsubmit:function(){CommonProvider.promise({model:AnnouncementModel,method:params.batch?"delete":"del",params:params.batch?$scope.announcement_list.result.checked():params_del,success:function(_announcement){$modal.success({message:_announcement.message})},error:function(_announcement){$modal.error({message:_announcement.message})}})}})}}}]),angular.module("ArticleController",["ArticleModel","CategoryModel","ArticleService"]).controller("ArticleController",["$scope","$rootScope","$state","$stateParams","$location","$modal","ArticleModel","CategoryModel","ArticleService","CommonProvider",function($scope,$rootScope,$state,$stateParams,$location,$modal,ArticleModel,CategoryModel,ArticleService,CommonProvider){$scope.filter={},$scope.params={},$scope.search={},$scope.article_list={},$scope.articleAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:ArticleModel,method:"get",params:params,success:function(article_list){$scope.article_list=article_list}})},getCategory:function(){var params={role:"admin",type:3};CommonProvider.promise({model:CategoryModel,method:"get",params:params,success:function(category_list){$scope.category_list=category_list.result}})},getItem:function(){CommonProvider.promise({model:ArticleModel,method:"item",params:{article_id:$stateParams.article_id},success:function(article_item){$scope.article=article_item.result}})},filterChanged:function(){var _self=this,status=$scope.filter.status;status?$scope.params.status=status:delete $scope.params.status,_self.getLists($scope.params)},getSearch:function(){var params=[{field:"title",operation:"like",value:$scope.search.keyword},{field:"content",operation:"like",value:$scope.search.keyword}];CommonProvider.search({service:new ArticleService,
method:"search",params:params,success:function(_article_list){$scope.article_list=_article_list}})},add:function(){CommonProvider.promise({model:ArticleModel,method:"add",params:$scope.article,success:function(_article){$modal.success({message:_article.message,callback:function(){$location.path("/article/manage/list/index")}})},error:function(_article){$modal.error({message:_article.message})}})},edit:function(){CommonProvider.promise({model:ArticleModel,method:"put",params:$scope.article,success:function(_article){$modal.success({message:_article.message,callback:function(){$location.path("/article/manage/list/index")}})},error:function(_article){$modal.error({message:_article.message})}})},del:function(params){return params.batch&&0==$scope.article_list.result.checked().length?($modal.error({message:"至少需要选中一篇文章"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中文章吗？":"确定要删除此文章吗？",info:"文章删除后可在文章回收站中查看",onsubmit:function(){CommonProvider.promise({model:ArticleModel,method:params.batch?"delete":"del",params:params.batch?$scope.article_list.result.checked():params.article,success:function(_article){$modal.success({message:_article.message})},error:function(_article){$modal.error({message:_article.message})}})}})},disable:function(params){return params.batch&&0==$scope.article_list.result.children.checked().length?($modal.error({message:"至少需要选中一个文章"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要禁用选中文章吗？":"确定要禁用此文章吗？",info:params.batch?"禁用后这些文章将不再前台显示":"禁用后该文章将不再前台显示",onsubmit:function(){CommonProvider.promise({model:ArticleModel,method:"disable",params:params.batch?$scope.article_list.result.children.checked():params.article,success:function(_article){$modal.success({message:_article.message})},error:function(_article){$modal.error({message:_article.message})}})}})},enable:function(params){return params.batch&&0==$scope.article_list.result.checked().length?($modal.error({message:"至少需要选中一个文章"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要启用选中文章吗？":"确定要启用此文章吗？",info:params.batch?"启用后这些文章将不再前台显示":"启用后该文章将不再前台显示",onsubmit:function(){CommonProvider.promise({model:ArticleModel,method:"enable",params:params.batch?$scope.article_list.result.checked():params.article,success:function(_article){$modal.success({message:_article.message})},error:function(_article){$modal.error({message:_article.message})}})}})}}}]),angular.module("AsideController",[]).controller("AsideController",["$rootScope","$scope","$state","$stateParams","$location",function($rootScope,$scope,$state,$stateParams,$location){$scope.default_active=!1,$scope.defaultActive=function(){$scope.default_active=!$state.current.parent},$scope.defaultActive(),$scope.$on("$stateChangeSuccess",function(event,next,current){$scope.state=$state.current,$scope.defaultActive()})}]),angular.module("AuditController",["AuditModel"]).controller("AuditController",["$scope","$rootScope","$state","$stateParams","$location","$modal","AuditModel","CommonProvider",function($scope,$rootScope,$state,$stateParams,$location,$modal,AuditModel,CommonProvider){$scope.filter={status:"all"},$scope.auditAction={filterChanged:function(){$scope.auditAction.getLists()},getLists:function(page){var get_params={order_method:"desc",page:page||1};"all"!=$scope.filter.status&&(get_params.status=$scope.filter.status),CommonProvider.promise({model:AuditModel,method:"get",params:get_params,success:function(audit_list){$scope.audit_list=audit_list}})},getItem:function(){CommonProvider.promise({model:AuditModel,method:"item",params:{organization_id:$stateParams.organization_id,role:"admin"},success:function(audit_item){$scope.audit=audit_item.result}})},edit:function(params){var audit={role:"admin",body:$scope.audit,organization_id:$scope.audit.organization_id};CommonProvider.promise({model:AuditModel,method:"put",params:audit,success:function(_audit){$modal.success({message:_audit.message,callback:function(){$location.path("/organization/manage/audit/list")}})},error:function(_audit){$modal.error({message:_audit.message})}})},del:function(params){return params.batch&&0==$scope.audit_list.result.checked().length?($modal.error({message:"至少需要选中一个机构资质"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中机构资质吗？":"确定要删除此机构资质吗？",info:"机构资质删除后可在机构资质回收站中查看",onsubmit:function(){CommonProvider.promise({model:AuditModel,method:params.batch?"delete":"del",params:params.batch?$scope.audit_list.result.checked():params.audit,success:function(_audit){$modal.success({message:_audit.message})},error:function(_audit){$modal.error({message:_audit.message})}})}})}}}]),angular.module("AuthController",["angular.validation","angular.validation.rule","AuthModel"]).controller("AuthController",["$rootScope","$scope","$stateParams","$location","$localStorage","$modal","AuthModel","CommonProvider","PermissionProvider",function($rootScope,$scope,$stateParams,$location,$localStorage,$modal,AuthModel,CommonProvider,PermissionProvider){$scope.login=function(){CommonProvider.promise({model:AuthModel,method:"login",params:$scope.user,success:function(_auth){$localStorage.token=_auth.result,PermissionProvider.init(),$location.path("/index")},error:function(_auth){$modal.error({message:_auth.message,info:_auth.result})}})},$scope.register=function(){CommonProvider.promise({model:AuthModel,method:"register",params:$scope.user,success:function(_auth){$localStorage.token=_auth.result,$modal.success({message:_auth.message}),PermissionProvider.init(),$location.path("/index")},error:function(_auth){$modal.error({message:_auth.message})}})},$scope.forgot=function(){CommonProvider.promise({model:AuthModel,method:"forgot",params:$scope.user,success:function(_auth){$modal.success({message:_auth.message}),$location.path("/login")},error:function(_auth){$modal.error({message:_auth.message})}})},$scope.logout=function(){CommonProvider.promise({model:AuthModel,method:"logout",success:function(_auth){delete $localStorage.token,delete $localStorage.user,$rootScope.permissions=null,$location.path("/login")},error:function(_auth){$modal.error({message:_auth.message})}})}}]),angular.module("CategoryController",["angular.validation","angular.validation.rule","angular-sortable-view","Qupload","CategoryModel"]).controller("CategoryController",["$scope","$rootScope","$state","$stateParams","$location","$modal","CategoryModel","CommonProvider",function($scope,$rootScope,$state,$stateParams,$location,$modal,CategoryModel,CommonProvider){switch($scope.category_type=$stateParams.category_type||"1",$scope.category_id=$stateParams.category_id||"0",$scope.category_title="",$scope.category_alais="",$scope.category_info={},$scope.category_type){case"1":$scope.category_info={title:"课程分类",alais:"course"};break;case"2":$scope.category_info={title:"学校分类",alais:"organization"};break;case"3":$scope.category_info={title:"文章分类",alais:"article"}}$scope.categoryAction={getLists:function(){var params={role:"admin",category_id:$scope.category_id,type:$scope.category_type,children:1};CommonProvider.promise({model:CategoryModel,params:params,method:"childrens",success:function(category_list){$scope.category_list=category_list}})},sort:function(params){CommonProvider.sort({model:CategoryModel,params:params,data:$scope.category_list.result.children,method:"sort"})},add:function(params){if(params.modal)$rootScope.category={alais:$scope.category_info.alais,pid:params.pid||0,type:$scope.category_type,redirect:params.redirect||!1},$modal.custom({title:"添加分类",template_url:"/partials/admin/category/manage/add.html",callback:function(){delete $rootScope.category}});else{$scope.category.type=$rootScope.category.type,$scope.category.pid=$rootScope.category.pid;var category_option={alais:$rootScope.category.alais,pid:$rootScope.category.pid,type:$rootScope.category.type,redirect:$rootScope.category.redirect};CommonProvider.promise({model:CategoryModel,method:"add",params:$scope.category,success:function(_category){$rootScope.modal.close(),$modal.success({message:_category.message,callback:function(){delete $rootScope.category,category_option.redirect&&$location.path("/"+category_option.alais+"/manage/category/list/"+category_option.type+"/"+category_option.pid)}})},error:function(_category){$modal.error({message:_category.message})}})}},edit:function(params){params.modal?($rootScope.category_local=params.category,$rootScope.category_edit=angular.copy(params.category.category),$modal.custom({title:"编辑分类",template_url:"/partials/admin/category/manage/edit.html",callback:function(){delete $rootScope.category_edit}})):CommonProvider.promise({model:CategoryModel,method:"put",params:{"new":$scope.category,old:$rootScope.category_local},success:function(_category){$rootScope.category_local.$parent.category=_category.result,$rootScope.modal.close(),$modal.success({message:_category.message,callback:function(){delete $rootScope.category_local}})},error:function(_category){$modal.error({message:_category.message})}})},getUploadThumb:function(data){data&&($scope.category.icon=data.key)},del:function(params){return params.batch&&0==$scope.category_list.result.children.checked().length?($modal.error({message:"至少需要选中一个分类"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中分类吗？":"确定要删除此分类吗？",info:"分类删除操作不可撤销，下级分类也将被删除",onsubmit:function(){CommonProvider.promise({model:CategoryModel,method:params.batch?"delete":"del",params:params.batch?$scope.category_list.result.children.checked():params.category,success:function(_category){$modal.success({message:_category.message})},error:function(_category){$modal.error({message:_category.message})}})}})},disable:function(params){return params.batch&&0==$scope.category_list.result.children.checked().length?($modal.error({message:"至少需要选中一个分类"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要禁用选中分类吗？":"确定要禁用此分类吗？",info:params.batch?"禁用后这些分类将不再前台显示":"禁用后该分类将不再前台显示",onsubmit:function(){CommonProvider.promise({model:CategoryModel,method:"disable",params:params.batch?$scope.category_list.result.children.checked():params.category,success:function(_category){$modal.success({message:_category.message})},error:function(_category){$modal.error({message:_category.message})}})}})},enable:function(params){return params.batch&&0==$scope.category_list.result.children.checked().length?($modal.error({message:"至少需要选中一个分类"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要启用选中分类吗？":"确定要启用此分类吗？",info:params.batch?"启用后这些分类将不再前台显示":"启用后该分类将不再前台显示",onsubmit:function(){CommonProvider.promise({model:CategoryModel,method:"enable",params:params.batch?$scope.category_list.result.children.checked():params.category,success:function(_category){$modal.success({message:_category.message})},error:function(_category){$modal.error({message:_category.message})}})}})}}}]),angular.module("ConfigController",["angular-sortable-view","angular-related-select","TabsDirective","TypeaheadDirective","ConfigModel","IndexModel","SearchModel","PartnerModel","LinkModel","PublicModel","CategoryModel","SearchService","OrganizationService","CategoryService","CourseService"]).controller("ConfigController",["$rootScope","$scope","$http","$stateParams","$location","$localStorage","$modal","SystemModel","IndexModel","LogModel","PartnerModel","LinkModel","PublicModel","SearchModel","CategoryModel","SearchService","OrganizationService","CategoryService","CourseService","CommonProvider",function($rootScope,$scope,$http,$stateParams,$location,$localStorage,$modal,SystemModel,IndexModel,LogModel,PartnerModel,LinkModel,PublicModel,SearchModel,CategoryModel,SearchService,OrganizationService,CategoryService,CourseService,CommonProvider){$scope.params={},$scope.systemAction={all_tabs:["基本设置","内容设置","用户设置","系统设置"],getLists:function(page){CommonProvider.promise({model:SystemModel,method:"get",params:{page:page||1,role:"admin"},success:function(_lists){$scope.config_list=_lists}})},getGroup:function(group){$scope.config_group=$scope.config_group||{},$scope.config_group[group]||($localStorage.config_group?$localStorage.config_group[group]&&($scope.config_group[group]=angular.copy($localStorage.config_group[group])):$localStorage.config_group={},CommonProvider.promise({model:SystemModel,method:"get",params:{per_page:100,group:group+1,role:"admin"},success:function(_config_list){$localStorage.config_group[group]=angular.copy(_config_list.result.toObject("name")),$scope.config_group[group]=_config_list.result.toObject("name")}}))},putGroup:function(group){CommonProvider.promise({model:SystemModel,method:"putGroup",params:$scope.config_group[group],success:function(_config_group){$modal.success({message:_config_group.message})}})},add:function(params){params.modal?$modal.custom({title:"新增配置项",template_url:"/partials/admin/config/system/add.html"}):CommonProvider.promise({model:SystemModel,method:"add",params:$scope.config,success:function(_config){$scope.config=null,$rootScope.modal.close(),$modal.success({message:_config.message})},error:function(_config){$modal.error({message:_config.message})}})},edit:function(params){params.modal?($rootScope.config_local=params.config,$rootScope.config_edit=angular.copy(params.config.config),$modal.custom({title:"更新配置项",template_url:"/partials/admin/config/system/edit.html",callback:function(){$rootScope.config_local=null,delete $rootScope.config_edit}})):($rootScope.config_edit.value=$rootScope.config_edit.value.toString(),CommonProvider.promise({model:SystemModel,method:"put",params:{old:$rootScope.config_local,"new":$rootScope.config_edit},success:function(_config){$rootScope.modal.close(),$modal.success({message:_config.message})},error:function(_config){$modal.error({message:_config.message})}}))},del:function(params){return params.batch&&0==$scope.config_list.result.checked().length?($modal.error({message:"至少需要选中一个配置项"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中配置项吗？":"确定要删除此配置项吗？",info:"配置项删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:SystemModel,method:params.batch?"delete":"del",params:params.batch?$scope.config_list.result.checked():params.config,success:function(_config){$modal.success({message:_config.message})},error:function(_config){$modal.error({message:_config.message})}})}})}},$scope.config_list={},$scope.config_data={},$scope.search={},$scope.indexAction={getLists:function(page){CommonProvider.promise({model:IndexModel,method:"get",params:{page:page||1,role:"admin"},success:function(_config_list){$scope.config_list=_config_list}})},getCategories:function(){CommonProvider.promise({model:CategoryModel,method:"get",params:{category_id:0,type:1},success:function(categories){var categories=categories.result;$rootScope.categories=categories}})},selectChange:function(params){var disSelects=angular.copy(params.disSelects),select_categories=disSelects.pop();$rootScope.select_categories=select_categories},manage:function(params){if(params.modal)$rootScope.config_local=params,$rootScope.config_edit=params,$modal.custom({title:"管理配置",template_url:"/partials/admin/config/index/manage.html",callback:function(){delete $rootScope.config_edit,delete $rootScope.categories,delete $rootScope.select_categories}});else{switch(params.option){case"organization":$scope.config_data.organization=$scope.config.organization.ids().join(",");break;case"category":$scope.config_data.sub_category=$scope.config.sub_category.ids().join(",");break;case"course":$scope.config_data.course=$scope.config.course.ids().join(",")}$scope.config_data.category_id=$scope.config.category_id,$scope.config_data.id=$scope.config.id,CommonProvider.promise({model:IndexModel,method:"put",params:$scope.config_data,success:function(_config){$rootScope.config_local=_config.result[params.option],$rootScope.modal.close(),$modal.success({message:_config.message,callback:function(){delete $rootScope.config_local,delete $rootScope.select_categories}})},error:function(_config){$modal.error({message:_config.message})}})}},remove:function(params){switch(params.option){case"organization":$rootScope.config_edit.data.config.organization.remove(params.config.config);break;case"category":$rootScope.config_edit.data.config.sub_category.remove(params.config.config);break;case"course":$rootScope.config_edit.data.config.course.remove(params.config.config)}},search:function(params){if(params.keyword){var params_search={keyword:params.keyword,search_type:params.type,only_name:1};return $scope.search.keyword=params.keyword,CommonProvider.request({method:"get",service:new SearchService,params:params_search}).then(function(res){return res.result})}},searchSelect:function(params){$scope.search.keyword=params.label;var _search_data={service:{},params:{},method:""};switch(params.type){case"organization":if(_search_data={service:new OrganizationService,params:{organization_id:params.item.id},method:"item"},$rootScope.config_edit.data.config.organization.find(params.item.id,"id"))return!1;break;case"course":if(_search_data={service:new CourseService,params:{course_id:params.item.id},method:"item"},$rootScope.config_edit.data.config.course.find(params.item.id,"id"))return!1}CommonProvider.request({service:_search_data.service,params:_search_data.params,method:_search_data.method,success:function(_data){switch(params.type){case"organization":$rootScope.config_edit.data.config.organization.push(_data.result);break;case"course":$rootScope.config_edit.data.config.course.push(_data.result)}}})},categorySelect:function(params){if(params.category.value){var category=params.category.value;params.category.is_selected?$rootScope.config_edit.data.config.sub_category.push(category):$rootScope.config_edit.data.config.sub_category.remove(category)}}},$scope.partner_list={},$scope.partnerAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:PartnerModel,method:"get",params:params,success:function(partner_list){$scope.partner_list=partner_list}})},add:function(params){params.modal&&$modal.custom({title:"新增入驻机构",template_url:"/partials/admin/config/partner/add.html"})}},$scope.link_list={},$scope.linkAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:LinkModel,method:"get",params:params,success:function(link_list){$scope.link_list=link_list}})},add:function(params){params.modal?$modal.custom({title:"添加友情链接",template_url:"/partials/admin/config/link/add.html"}):CommonProvider.promise({model:LinkModel,method:"add",params:$scope.link,success:function(_link){$rootScope.modal.close(),$modal.success({message:_link.message})},error:function(_link){$modal.error({message:_link.message})}})},edit:function(params){params.modal?($rootScope.link_local=params.link,$rootScope.link_edit=angular.copy(params.link.link),$modal.custom({title:"编辑友情链接",template_url:"/partials/admin/config/link/edit.html",callback:function(){delete $rootScope.link_edit}})):CommonProvider.promise({model:LinkModel,method:"put",params:$scope.link,success:function(_link){$rootScope.link_local.$parent.link=_link.result,$rootScope.modal.close(),$modal.success({message:_link.message,callback:function(){delete $rootScope.link_local}})},error:function(_link){$modal.error({message:_link.message})}})},del:function(params){return params.batch&&0==$scope.link_list.result.checked().length?($modal.error({message:"至少需要选中一个友情链接"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中友情链接吗？":"确定要删除此友情链接吗？",info:"友情链接删除后可在回收站中查看",onsubmit:function(){CommonProvider.promise({model:LinkModel,method:params.batch?"delete":"del",params:params.batch?$scope.link_list.result.checked():params.link,success:function(_link){$modal.success({message:_link.message})},error:function(_link){$modal.error({message:_link.message})}})}})}},$scope.searchAction={getHot:function(){CommonProvider.promise({model:SearchModel,method:"getHotWords",success:function(_search_hot){$scope.search_hot=_search_hot.result}})},hot:function(){CommonProvider.promise({model:SearchModel,method:"putHotWords",params:$scope.search_hot,success:function(_search_hot){$modal.success({message:_search_hot.message})},error:function(_search_hot){$modal.error({message:_search_hot.message})}})},searchInit:function(params){var type_text="course"==params.type?"课程":"学校";$modal.confirm({title:"确认操作",message:"确定要初始化"+type_text+"搜索索引？",onsubmit:function(){CommonProvider.promise({model:SearchModel,method:"searchInit",params:params,success:function(_search_init){$modal.success({message:_search_init.message}),$scope.search_init_menu=!1},error:function(_search_init){$modal.error({message:_search_init.message})}})}})},searchClean:function(params){var type_text="course"==params.type?"课程":"学校";$modal.confirm({title:"确认操作",message:"确定要清空"+type_text+"搜索索引？",onsubmit:function(){CommonProvider.promise({model:SearchModel,method:"searchClean",params:params,success:function(_search_clean){$modal.success({message:_search_clean.message}),$scope.search_clean_menu=!1},error:function(_search_clean){$modal.error({message:_search_clean.message})}})}})}},$scope.databaseAction={getExport:function(){},getImport:function(){}},$scope.logAction={getIndex:function(page){var _self=this;$scope.params={page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:LogModel,method:"get",params:params,success:function(_log_list){$scope.log_list=_log_list}})},del:function(params){return params.batch&&0==$scope.log_list.result.checked().length?($modal.error({message:"至少需要选中一条日志"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中日志吗？":"确定要删除此日志吗？",info:"日志删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:LogModel,method:"del",params:params.batch?$scope.log_list.result.checked():params.log,success:function(_log){$modal.success({message:_log.message})},error:function(_log){$modal.error({message:_log.message})}})}})},clear:function(){$modal.confirm({title:"确认删除",message:"确定要清空所有日志吗？",info:"本操作不可恢复",onsubmit:function(){CommonProvider.promise({model:LogModel,method:"clear",success:function(_log){$modal.success({message:_log.message})},error:function(_log){$modal.error({message:_log.message})}})}})}},$scope.smsAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:SmsModel,method:"get",params:params,success:function(_sms_list){$scope.sms_list=_sms_list}})}}}]),angular.module("CourseController",["Umeditor","Qupload","angular-video-player","angular-sortable-view","angular-related-select","CourseModel","CategoryModel","SectionModel","CourseService"]).controller("CourseController",["$scope","$rootScope","$state","$location","$stateParams","$modal","CourseModel","CategoryModel","SectionModel","CourseService","CommonProvider",function($scope,$rootScope,$state,$location,$stateParams,$modal,CourseModel,CategoryModel,SectionModel,CourseService,CommonProvider){$rootScope.player={},$scope.search={},$scope.course={},$scope.course_id=$stateParams.course_id||!1,$scope.categories=[],$scope.course_section=[],$scope.sections=[],$scope.sections_filter=[],$scope.filter={sort_id:"all",x_status:"all",is_live:"all",status:"all",category_id:"all"},$scope.courseAction={getIndex:function(){$scope.courseAction.getLists(),$scope.courseAction.getCategory()},filterChanged:function(){$scope.courseAction.getLists()},getLists:function(page){var get_params={role:"admin",page:page||1,per_page:16},filters=$scope.filter;for(var key in filters)"all"!=filters[key]&&(get_params[key]=filters[key]);CommonProvider.promise({model:CourseModel,method:"get",params:get_params,success:function(course_list){$scope.course_list=course_list}})},getCategory:function(params){CommonProvider.promise({model:CategoryModel,method:"get",params:{role:"admin",type:1},success:function(categories){var categories=categories.result,cate_lists=[],pushCate=function(cates,prefix){var prefix=prefix||"—";cates.forEach(function(cate){cate.pid&&(cate.name=prefix+cate.name),cate_lists.push(cate),cate.children&&cate.children.length&&pushCate(cate.children,prefix+"——")})};pushCate(categories),cate_lists.forEach(function(cate){cate.children=null}),$scope.categories=cate_lists}})},getItem:function(){CommonProvider.promise({model:CourseModel,method:"item",params:{course_id:$scope.course_id,role:"admin"},success:function(course){$scope.course=course.result,$scope.course.organization_id=$scope.course.organization_id||void 0,$scope.courseAction.getCategory({category_id:0,type:1})}})},getSection:function(){var params={course_id:$scope.course_id,role:"admin"};CommonProvider.promise({model:SectionModel,method:"get",params:params,success:function(course_section){$scope.course_section=course_section.result,$scope.sections=angular.copy($scope.course_section)}})},getSearch:function(){var params=[{field:"name",operation:"like",value:$scope.search.keyword},{field:"introduction",operation:"like",value:$scope.search.keyword},{field:"description",operation:"like",value:$scope.search.keyword}];CommonProvider.search({service:new CourseService,method:"search",params:params,success:function(_course_list){$scope.course_list=_course_list}})},audit:function(params){$rootScope.section_local=params.section.section,$scope.section=angular.copy(params.section.section),$scope.section.status=3,$scope.section.role="admin",$modal.confirm({title:"确认操作",message:"确定要审核通过该视频吗？",info:"本操作不可恢复",onsubmit:function(){CommonProvider.promise({model:SectionModel,method:"put",params:$scope.section,success:function(_section){$modal.success({message:_section.message}),$rootScope.section_local.status=3,delete $rootScope.section_local},error:function(_section){$modal.error({message:_section.message})}})}})},auditRefuse:function(params){var section=params.section,ismodel=params.ismodel;if(ismodel)$rootScope.section_edit=section,$modal.custom({title:"《"+section.name+"》 - 拒绝审核",template_url:"partials/admin/course/manage/section/video.html",callback:function(){$rootScope.section_edit=null,delete $rootScope.section_edit}});else{var section=angular.copy($rootScope.section_edit);section.status=-3,section.role="admin",section.remark=params.remark,CommonProvider.promise({model:SectionModel,method:"put",params:section,success:function(_section){$rootScope.section_edit.status=-3,$rootScope.section_edit.remark=section.remark,$rootScope.modal.close(),$modal.success({message:_section.message})},error:function(_section){$rootScope.modal.close(),$modal.error({message:_section.message})}})}},liveAudit:function(params){var section=params.section,ismodel=params.ismodel;if(ismodel)section.live={},section.live.duration={},section.live.duration.hours=parseInt(section.live_duration/60),section.live.duration.moments=parseInt(section.live_duration%60),$rootScope.section_edit=section,$modal.custom({title:"《"+section.name+"》 - 直播信息预览",template_url:"partials/admin/course/manage/section/live.html"});else{var isaudit=params.audit.pass,remark=params.audit.remark;section.live_status=isaudit?1:-1,section.role="admin",isaudit||(section.remark=remark),CommonProvider.promise({model:SectionModel,method:"put",params:section,success:function(_section){$rootScope.modal.close(),$modal.success({message:"操作成功"})},error:function(_section){$rootScope.modal.close(),$modal.error({message:_section.message})},callback:function(){$rootScope.section_edit=null}})}},preview:function(section_id){var params={role:"admin",section_id:section_id};CommonProvider.promise({model:SectionModel,method:"getVideos",params:params,success:function(videos){var video=videos.result,player={};player.modal=1,player.urls=video.urls,player.is_live=video.is_live,player.live_status=video.live_status,$rootScope.player=player,$modal.custom({title:"课程预览",template:'<style>.modal-body{overflow:hidden;}.video-player .video-js{width:100%;height:320px;}</style><div video-player data="$root.player"></div>',callback:function(){$rootScope.player=null,delete $rootScope.player}})}})},sectionFilterChanged:function(){var status=$scope.filter.section_status,type=$scope.filter.section_type;if("all"==status&&"all"==type)return $scope.sections=$scope.course_section;var chapters=angular.copy($scope.course_section),f_chapters=[];chapters.forEach(function(chapter){var sections=[];chapter.children.forEach(function(section){"all"!=type&&section.is_live!=type||("all"==status&&sections.push(section),0==status&&(section.is_live?0==section.live_status&&sections.push(section):section.status<3&&sections.push(section)),1==status&&(section.is_live?section.live_status>0&&sections.push(section):3==section.status&&sections.push(section)),-1==status&&(section.is_live?-1==section.live_status&&sections.push(section):-3==section.status&&sections.push(section)))}),chapter.children=sections,f_chapters.push(chapter)}),$scope.sections=f_chapters},edit:function(){$scope.course.role="admin",CommonProvider.promise({model:CourseModel,method:"put",params:{"new":$scope.course},success:function(_course){$modal.success({message:_course.message,callback:function(){}})},error:function(_course){$modal.error({message:_course.message})}})},getUploadThumb:function(data){data&&($scope.course.thumb=data.key)},courseCateChange:function(select){$scope.course.category_id=select.ckdSelectId},del:function(params){return params.batch&&0==$scope.course_list.result.checked().length?$modal.error({message:"至少需要选中一门课程"}):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中课程吗？":"确定要删除此课程吗？",info:"课程删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:CourseModel,method:params.batch?"delete":"del",params:params.batch?$scope.course_list.result.checked():params.course,success:function(_course){$modal.success({message:_course.message})},error:function(_course){$modal.error({message:_course.message})}})}})},disable:function(params){return params.batch&&0==$scope.course_list.result.checked().length?($modal.error({message:"至少需要选中一门课程"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要下架选中课程吗？":"确定要下架此课程吗？",info:params.batch?"下架后这些课程将不再前台显示":"下架后该课程将不再前台显示",onsubmit:function(){CommonProvider.promise({model:CourseModel,method:"disable",params:params.batch?$scope.course_list.result.checked():params.course,success:function(_course){$modal.success({message:_course.message})},error:function(_course){$modal.error({message:_course.message})}})}})},enable:function(params){return params.batch&&0==$scope.course_list.result.checked().length?($modal.error({message:"至少需要选中一个课程"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要上架选中课程吗？":"确定要上架此课程吗？",info:params.batch?"上架后选中课程将恢复正常购买":"上架后该课程将恢复正常购买",onsubmit:function(){CommonProvider.promise({model:CourseModel,method:"enable",params:params.batch?$scope.course_list.result.checked():params.course,success:function(_course){$modal.success({message:_course.message})},error:function(_course){$modal.error({message:_course.message})}})}})}}}]),angular.module("FeedbackController",["FeedbackModel"]).controller("FeedbackController",["$scope","$rootScope","$state","$stateParams","$location","$modal","FeedbackModel","CommonProvider",function($scope,$rootScope,$state,$stateParams,$location,$modal,FeedbackModel,CommonProvider){$scope.filter={},$scope.params={},$scope.feedback_list={},$scope.feedbackAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:FeedbackModel,method:"get",params:params,success:function(_feedback_list){$scope.feedback_list=_feedback_list}})},getItem:function(){CommonProvider.promise({model:FeedbackModel,method:"item",params:{feedback_id:$stateParams.feedback_id},success:function(_feedback_item){$scope.feedback=_feedback_item.result}})},del:function(params){return params.batch&&0==$scope.feedback_list.result.checked().length?($modal.error({message:"至少需要选中一条反馈"}),!1):void $modal.confirm({title:"确认删除",
message:params.batch?"确定要删除选中反馈吗？":"确定要删除此反馈吗？",info:"反馈删除后可在回收站中查看",onsubmit:function(){CommonProvider.promise({model:FeedbackModel,method:params.batch?"delete":"del",params:params.batch?$scope.feedback_list.result.checked():params.feedback,success:function(_feedback){$modal.success({message:_feedback.message})},error:function(_feedback){$modal.error({message:_feedback.message})}})}})}}}]),angular.module("HeaderController",[]).controller("HeaderController",["$rootScope","$scope","$state","$stateParams","$location",function($rootScope,$scope,$state,$stateParams,$location){$scope.asideMenusEvent=function(){$rootScope.menus&&$rootScope.menus.length&&($rootScope.menus.find?$rootScope.aside_menus=$rootScope.menus.find($scope.current_slug||"index","slug").children:$rootScope.aside_menus=$rootScope.menus[0].children,$scope.pagePermissionsEvent(),!$state.current.parent&&$rootScope.aside_menus&&$location.path($rootScope.aside_menus[0].children[0].url))},$scope.pagePermissionsEvent=function(){$scope.current_node_slug?($scope.node_permission=$rootScope.aside_menus.find($scope.current_node_slug,"slug"),$scope.node_permission&&$scope.node_permission.children&&($rootScope.page_permission=$scope.node_permission.children.find($state.current.name,"slug").children)):$rootScope.aside_menus&&$rootScope.aside_menus[0]&&$rootScope.aside_menus[0].children&&$rootScope.aside_menus[0].children[0].children&&($rootScope.page_permission=$rootScope.aside_menus[0].children[0].children),$rootScope.page_permission&&$rootScope.page_permission.toObject&&($rootScope.page_permission=$rootScope.page_permission.toObject("slug"))},$scope.$on("$stateChangeSuccess",function(){$scope.current_slug=-1==$state.current.name.indexOf(".")?$state.current.data.slug:$state.current.name.substr(0,$state.current.name.indexOf(".")),$scope.current_node_slug=$state.current.name.substr(0,$state.current.name.indexOf(".",$state.current.name.indexOf(".")+1)),$scope.asideMenusEvent()}),$scope.$on("permissionsChanged",function(){$scope.asideMenusEvent()})}]),angular.module("IndexController",["PublicModel"]).controller("IndexController",["$rootScope","$scope","$state","$stateParams","$location","$localStorage","$modal","PublicModel","CommonProvider",function($rootScope,$scope,$state,$stateParams,$location,$localStorage,$modal,PublicModel,CommonProvider){$scope.dashboardAction={clearcache:function(params){CommonProvider.promise({model:PublicModel,method:"clearcache",params:params,success:function(_cache){$modal.success({message:_cache.message})},error:function(_cache){$modal.error({message:_cache.message})}})}}}]),angular.module("MainController",["angular.modal","AuthModel","CommonModel","cfp.loadingBar"]).controller("MainController",["$rootScope","$scope","$state","$stateParams","$location","$localStorage","$modal","appConfig","AuthModel","CommonModel","cfpLoadingBar","QuploadProvider","CommonProvider",function($rootScope,$scope,$state,$stateParams,$location,$localStorage,$modal,appConfig,AuthModel,CommonModel,cfpLoadingBar,QuploadProvider,CommonProvider){$rootScope.config=appConfig,$scope.$on("$stateChangeSuccess",function(){$rootScope.title=$state.current.data.title||"Wind - Admin",$rootScope.full=$state.current.data.full||!1}),$rootScope.modal={submit:function(){$modal.confirmSubmit()},cancel:function(){$modal.confirmCancel()},loading:function(){$modal.loading()},closeLoading:function(){$modal.closeLoading()},close:function(){$modal.closeCallback()},error:function(config){$modal.error({message:config.message||"error"})},imagePreview:function(url){var img_url;img_url=url.indexOf("http")>=0?url:$rootScope.config.fileUrl+url,$modal.image({url:img_url})}},$rootScope.$on("cfpLoadingBar:loading",function(event,data){}),$rootScope.$on("cfpLoadingBar:completed",function(event,data){}),$rootScope.routeCheck=function(){$rootScope.routes&&-1==$rootScope.routes.indexOf($state.current.name)&&$location.path("/index")},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){"login"!=toState.name&&"forgot"!=toState.name&&"register"!=toState.name&&$rootScope.routes&&-1==$rootScope.routes.indexOf(toState.name)&&$location.path("/index")}),$rootScope.getThumbnail=QuploadProvider.getThumbnail,$rootScope.getStatic=QuploadProvider.getStatic,$rootScope.getConfig=function(params){var get_config={};return params.group&&(get_config={role:"admin",is_front:1,per_page:100,parge:1,group:params.group}),params.name&&(get_config.name=params.name),get_config.name||get_config.group?void CommonProvider.promise({model:CommonModel,method:get_config.name?"configByName":"config",params:get_config,success:function(config){params.success&&params.success(config)}}):!1}}]),angular.module("NoteController",["NoteModel","NoteService"]).controller("NoteController",["$scope","$rootScope","$state","$stateParams","$modal","NoteModel","NoteService","CommonProvider",function($scope,$rootScope,$state,$stateParams,$modal,NoteModel,NoteService,CommonProvider){$scope.filter={},$scope.params={},$scope.search={},$scope.note_list={},$scope.noteAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:NoteModel,method:"get",params:params,success:function(note_list){$scope.note_list=note_list}})},getSearch:function(){var params=[{field:"content",operation:"like",value:$scope.search.keyword}];CommonProvider.search({service:new NoteService,method:"search",params:params,success:function(_note_list){$scope.note_list=_note_list}})},getItem:function(){CommonProvider.promise({model:NoteModel,method:"item",params:{note_id:$stateParams.note_id},success:function(note_item){$scope.note=note_item.result}})},item:function(params){params.modal?($rootScope.note_item=angular.copy(params.note.note),$modal.custom({title:"笔记详情",template_url:"/partials/admin/article/note/item.html",callback:function(){delete $rootScope.note_item}})):$rootScope.modal.close()},edit:function(params){params.modal?($rootScope.note_local=params.note,$rootScope.note_edit=angular.copy(params.note.note),$modal.custom({title:"编辑分类",template_url:"/partials/admin/article/note/edit.html",callback:function(){delete $rootScope.note_edit}})):CommonProvider.promise({model:NoteModel,method:"put",params:{body:$scope.note,id:$scope.note.id},success:function(_note){$rootScope.note_local.$parent.note=_note.result,$rootScope.modal.close(),$modal.success({message:_note.message,callback:function(){delete $rootScope.note_local}})},error:function(_note){$modal.error({message:_note.message})}})},del:function(params){return params.batch&&0==$scope.note_list.result.checked().length?($modal.error({message:"至少需要选中一篇笔记"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中笔记吗？":"确定要删除此笔记吗？",info:"笔记删除后可在笔记回收站中查看",onsubmit:function(){CommonProvider.promise({model:NoteModel,method:params.batch?"delete":"del",params:params.batch?$scope.note_list.result.checked():params.note,success:function(_note){$modal.success({message:_note.message})},error:function(_note){$modal.error({message:_note.message})}})}})}}}]),angular.module("OrganizationController",["angular.validation","angular.validation.rule","OrganizationModel","CategoryModel","OrganizationService"]).controller("OrganizationController",["$scope","$rootScope","$state","$stateParams","$modal","$location","OrganizationModel","CategoryModel","OrganizationService","CommonProvider",function($scope,$rootScope,$state,$stateParams,$modal,$location,OrganizationModel,CategoryModel,OrganizationService,CommonProvider){$scope.filter={},$scope.params={},$scope.search={},$scope.organization_list={},$scope.organization_user_list={},$scope.organizationAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params),_self.getCategory({role:"admin",type:2})},getLists:function(params){CommonProvider.promise({model:OrganizationModel,method:"get",params:params,success:function(organization_list){$scope.organization_list=organization_list}})},getCategory:function(){var params={role:"admin",type:2};CommonProvider.promise({model:CategoryModel,method:"get",params:params,success:function(category_list){$scope.category_list=category_list.result}})},filterChanged:function(option){var _self=this,status="",category_id="";"status"==option&&(status=$scope.filter.status,status?$scope.params.status=status:delete $scope.params.status),"category"==option&&(category_id=$scope.filter.category_id,category_id?$scope.params.category_id=category_id:delete $scope.params.category_id),_self.getLists($scope.params)},getSearch:function(){var params=[{field:"name",operation:"like",value:$scope.search.keyword},{field:"introduction",operation:"like",value:$scope.search.keyword}];CommonProvider.search({service:new OrganizationService,method:"search",params:params,success:function(_organization_list){$scope.organization_list=_organization_list}})},getItem:function(){CommonProvider.promise({model:OrganizationModel,method:"item",params:{organization_id:$stateParams.organization_id},success:function(organization_item){$scope.organization=organization_item.result}})},add:function(){CommonProvider.promise({model:OrganizationModel,method:"add",params:$scope.organization,success:function(_organization){$modal.success({message:_organization.message,callback:function(){$location.path("/organization/manage/list/index")}})},error:function(_organization){$modal.error({message:_organization.message})}})},edit:function(params){$scope.organization.role="admin",CommonProvider.promise({model:OrganizationModel,method:"put",params:{"new":$scope.organization},success:function(_organization){$modal.success({message:_organization.message,callback:function(){$location.path("/organization/manage/list/index")}})},error:function(_organization){$modal.error({message:_organization.message})}})},getUploadLogo:function(data){data&&($scope.organization.logo=data.key)},getUploadScenery:function(data){data&&($scope.organization.scenery=data.key)},del:function(params){return params.batch&&0==$scope.organization_list.result.checked().length?($modal.error({message:"至少需要选中一所学校"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中学校吗？":"确定要删除此学校吗？",info:"学校删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:OrganizationModel,method:params.batch?"delete":"del",params:params.batch?$scope.organization_list.result.checked():params.organization,success:function(_organization){$modal.success({message:_organization.message})},error:function(_organization){$modal.error({message:_organization.message})}})}})},audit:function(params){params.modal?($rootScope.organization_local=params.organization,$rootScope.organization_edit=angular.copy(params.organization.organization),$modal.custom({title:"学校审核",template_url:"/partials/admin/organization/manage/audit.html",callback:function(){delete $rootScope.organization_edit}})):($scope.organization.role="admin",CommonProvider.promise({model:OrganizationModel,method:"put",params:{"new":$scope.organization,old:$rootScope.organization_local},success:function(_organization){$rootScope.modal.close(),$modal.success({message:_organization.message,callback:function(){delete $rootScope.organization_local}})},error:function(_organization){$modal.error({message:_organization.message})}}))}},$scope.organizationUserAction={getIndex:function(){$scope.organizationUserAction.getLists(),$scope.organizationAction.getLists({per_page:1e3,role:"admin"})},filterChanged:function(){$scope.organizationUserAction.getLists()},getLists:function(page){var get_params={organization_role:"admin",role:"admin",page:page||1},filters=$scope.filter;for(var key in filters)"all"!=filters[key]&&filters[key]&&(get_params[key]=filters[key]);CommonProvider.promise({model:OrganizationModel,method:"relation",params:get_params,success:function(_organization_user_list){$scope.organization_user_list=_organization_user_list}})},getItem:function(){CommonProvider.promise({model:OrganizationModel,method:"itemRelation",params:{relation_id:$stateParams.organization_user_id,role:"admin"},success:function(_organization_item){$scope.organization_user=_organization_item.result,$scope.organization_user.status=$scope.organization_user.status.toString()}})},del:function(params){if(params.organization_user){var relation_user=params.organization_user.organization_user;relation_user.relation_id=relation_user.id,relation_user.role="admin",$modal.confirm({title:"确认删除",message:"确定要删除此老师吗？",info:"老师删除后可在回收站中查看",onsubmit:function(){CommonProvider.promise({model:OrganizationModel,method:"delRelation",params:relation_user,success:function(_organization_user){$modal.success({message:_organization_user.message})},error:function(_organization_user){$modal.error({message:_organization_user.message})}})}})}},putItem:function(){var organization_user={id:$scope.organization_user.id,body:{title:$scope.organization_user.title,introduction:$scope.organization_user.introduction,status:$scope.organization_user.status,memo:$scope.organization_user.memo},organization_role:"admin",role:"admin"};CommonProvider.promise({model:OrganizationModel,method:"putRelation",params:organization_user,success:function(_organization_user){$modal.success({message:_organization_user.message})},error:function(_err){$modal.error({message:_err.message})}})},addTeacher:function(){$modal.custom({title:"增加老师",template_url:"/partials/admin/organization/organization_user/add.html",callback:function(){}})},addItem:function(){var organization_user={type:"",body:{title:$scope.organization_user.title,introduction:$scope.organization_user.introduction,status:$scope.organization_user.status,memo:$scope.organization_user.memo},organization_role:"admin",role:"admin"};console.log(organization_user),CommonProvider.promise({model:OrganizationModel,method:"addRelation",params:organization_user,success:function(_organization_user){$modal.success({message:_organization_user.message})},error:function(_err){$modal.error({message:_err.message})}})}}}]),angular.module("PaymentController",["PaymentModel"]).controller("PaymentController",["$scope","$rootScope","$state","$stateParams","$modal","PaymentModel","CommonProvider",function($scope,$rootScope,$state,$stateParams,$modal,PaymentModel,CommonProvider){$scope.payment={},$scope.payment_list={},$scope.filter={pay_type:"all",pay_status:"all"},$scope.paymentAction={getIndex:function(){$scope.paymentAction.getLists()},filterChanged:function(){$scope.paymentAction.getLists()},getLists:function(page){var get_params={page:page||1},filters=$scope.filter;for(var key in filters)"all"!=filters[key]&&filters[key]&&(get_params[key]=filters[key]);CommonProvider.promise({model:PaymentModel,method:"get",params:get_params,success:function(payment_list){$scope.payment_list=payment_list}})},getItem:function(){CommonProvider.promise({model:PaymentModel,method:"item",params:{payment_id:$stateParams.payment_id},success:function(payment_item){$scope.payment=payment_item.result}})},del:function(params){return params.batch&&0==$scope.payment_list.result.checked().length?($modal.error({message:"至少需要选中一个收款单"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中收款单吗？":"确定要删除此收款单吗？",info:"收款单删除后可在收款单回收站中查看",onsubmit:function(){CommonProvider.promise({model:PaymentModel,method:params.batch?"delete":"del",params:params.batch?$scope.payment_list.result.checked():params.payment,success:function(_payment){$modal.success({message:_payment.message})},error:function(_payment){$modal.error({message:_payment.message})}})}})}}}]),angular.module("QuestionController",["QuestionModel","QuestionService"]).controller("QuestionController",["$scope","$rootScope","$state","$stateParams","$modal","QuestionModel","QuestionService","CommonProvider",function($scope,$rootScope,$state,$stateParams,$modal,QuestionModel,QuestionService,CommonProvider){$scope.filter={},$scope.params={},$scope.search={},$scope.question_list={},$scope.questionAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:QuestionModel,method:"get",params:params,success:function(question_list){$scope.question_list=question_list}})},getSearch:function(){var params=[{field:"content",operation:"like",value:$scope.search.keyword}];CommonProvider.search({service:new QuestionService,method:"search",params:params,success:function(_question_list){$scope.question_list=_question_list}})},getItem:function(){CommonProvider.promise({model:QuestionModel,method:"item",params:{question_id:$stateParams.question_id},success:function(question_item){$scope.question=question_item.result}})},item:function(params){params.modal?($rootScope.question_item=angular.copy(params.question.question),$modal.custom({title:"问答详情",template_url:"/partials/admin/article/question/item.html",callback:function(){delete $rootScope.question_item}})):$rootScope.modal.close()},edit:function(params){params.modal?($rootScope.question_local=params.question,$rootScope.question_edit=angular.copy(params.question.question),$modal.custom({title:"编辑问答",template_url:"/partials/admin/article/question/edit.html",callback:function(){delete $rootScope.question_edit}})):CommonProvider.promise({model:QuestionModel,method:"put",params:{body:$scope.question,id:$scope.question.id},success:function(_question){$rootScope.question_local.$parent.question=_question.result,$rootScope.modal.close(),$modal.success({message:_question.message,callback:function(){delete $rootScope.question_local}})},error:function(_question){$modal.error({message:_question.message})}})},del:function(params){return params.batch&&0==$scope.question_list.result.checked().length?($modal.error({message:"至少需要选中一篇问答"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中问答吗？":"确定要删除此问答吗？",info:"问答删除后可在问答回收站中查看",onsubmit:function(){CommonProvider.promise({model:QuestionModel,method:params.batch?"delete":"del",params:params.batch?$scope.question_list.result.checked():params.question,success:function(_question){$modal.success({message:_question.message})},error:function(_question){$modal.error({message:_question.message})}})}})}}}]),angular.module("SectionController",["SectionModel"]).controller("SectionController",["$scope","$rootScope","$modal","$state","$stateParams","SectionModel","CommonProvider",function($scope,$rootScope,$modal,$state,$stateParams,SectionModel,CommonProvider){$scope.filter={status:"all",is_free:"all",is_live:"all",live_status:"all",order_field:"all"},$scope.sectionAction={filterChanged:function(){"all"==$scope.filter.is_live&&($scope.filter.status="all",$scope.filter.live_status="all"),"1"==$scope.filter.is_live&&($scope.filter.status="all"),"0"==$scope.filter.is_live&&($scope.filter.live_status="all"),$scope.sectionAction.getLists()},getLists:function(page){var get_params={role:"admin",out_type:"paginate",page:page||1,per_page:16,order_method:"desc"},filters=$scope.filter;for(var key in filters)"all"!=filters[key]&&(get_params[key]=filters[key]);CommonProvider.promise({model:SectionModel,method:"get",params:get_params,success:function(section_list){$scope.section_list=section_list}})},preview:function(section_id){var params={role:"admin",section_id:section_id};CommonProvider.promise({model:SectionModel,method:"getVideos",params:params,success:function(videos){var video=videos.result,player={};player.modal=1,player.urls=video.urls,player.is_live=video.is_live,player.live_status=video.live_status,$rootScope.player=player,$modal.custom({title:"章节预览",template:'<style>.modal-body{overflow:hidden;}.video-player .video-js{width:100%;height:320px;}</style><div video-player data="$root.player"></div>',callback:function(){$rootScope.player=null,delete $rootScope.player}})},error:function(err){$rootScope.modal.error({message:err.message})}})},liveAudit:function(params){var section=params.section,ismodel=params.ismodel;if(ismodel)section.live={},section.live.duration={},section.live.duration.hours=parseInt(section.live_duration/60),section.live.duration.moments=parseInt(section.live_duration%60),$rootScope.section_edit=section,$modal.custom({title:"《"+section.name+"》 - 直播信息预览",template_url:"partials/admin/course/manage/section/live.html"});else{var isaudit=params.audit.pass,remark=params.audit.remark;section.live_status=isaudit?1:-1,section.role="admin",isaudit||(section.remark=remark),CommonProvider.promise({model:SectionModel,method:"put",params:section,success:function(_section){$rootScope.modal.close(),$modal.success({message:"操作成功"})},error:function(_section){$rootScope.modal.close(),$modal.error({message:_section.message})},callback:function(){$rootScope.section_edit=null}})}},del:function(params){var isbatch=params.batch,checked=$scope.section_list.result.checked();return isbatch&&0==checked.length?$modal.error({message:"至少需要选中一门章节"}):void $modal.confirm({title:"确认删除",message:isbatch?"确定要删除选中章节吗？":"确定要删除此章节吗？",info:"章节删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:SectionModel,method:isbatch?"delete":"del",params:isbatch?checked:{section_id:params.section.id},success:function(_section){isbatch||$scope.section_list.result.remove(params.section),isbatch&&$scope.sectionAction.getLists($scope.section_list.pagination.current_page),$modal.success({message:_section.message})},error:function(_section){$modal.error({message:_section.message})}})}})},audit:function(params){$rootScope.section_local=params.section.section,$scope.section=angular.copy(params.section.section),$scope.section.status=3,$scope.section.role="admin",$modal.confirm({title:"确认操作",message:"确定要审核通过该视频吗？",info:"本操作不可恢复",onsubmit:function(){CommonProvider.promise({model:SectionModel,method:"put",params:$scope.section,success:function(_section){$modal.success({message:_section.message}),$rootScope.section_local.status=3,delete $rootScope.section_local},error:function(_section){$modal.error({message:_section.message})}})}})},auditRefuse:function(params){var section=params.section,ismodel=params.ismodel;if(ismodel)$rootScope.section_edit=section,$modal.custom({title:"《"+section.name+"》 - 拒绝审核",template_url:"partials/admin/course/manage/section/video.html",callback:function(){$rootScope.section_edit=null,delete $rootScope.section_edit}});else{var section=angular.copy($rootScope.section_edit);section.status=-3,section.role="admin",section.remark=params.remark,CommonProvider.promise({model:SectionModel,method:"put",params:section,success:function(_section){$rootScope.section_edit.status=-3,$rootScope.section_edit.remark=section.remark,$rootScope.modal.close(),$modal.success({message:_section.message})},error:function(_section){$rootScope.modal.close(),$modal.error({message:_section.message})}})}}}}]),angular.module("SmsController",["SmsModel","SmsService"]).controller("SmsController",["$scope","$rootScope","$state","$stateParams","$modal","SmsModel","SmsService","CommonProvider",function($scope,$rootScope,$state,$stateParams,$modal,SmsModel,SmsService,CommonProvider){$scope.filter={},$scope.params={},$scope.search={},$scope.sms_list={},$scope.smsAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:SmsModel,method:"get",params:params,success:function(_sms_list){$scope.sms_list=_sms_list}})},getItem:function(){CommonProvider.promise({model:SmsModel,method:"item",params:{sms_id:$stateParams.sms_id},success:function(sms_item){$scope.sms=sms_item.result}})},item:function(params){params.modal?($rootScope.sms_item=angular.copy(params.sms.sms),$modal.custom({title:"短信详情",template_url:"/partials/admin/article/sms/item.html",callback:function(){delete $rootScope.sms_item}})):$rootScope.modal.close()},del:function(params){return params.batch&&0==$scope.sms_list.result.checked().length?($modal.error({message:"至少需要选中一篇短信"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中短信吗？":"确定要删除此短信吗？",info:"短信删除后可在短信回收站中查看",onsubmit:function(){CommonProvider.promise({model:SmsModel,method:params.batch?"delete":"del",params:params.batch?$scope.sms_list.result.checked():params.sms,success:function(_sms){$modal.success({message:_sms.message})},error:function(_sms){$modal.error({message:_sms.message})}})}})}}}]),angular.module("TradeController",["TradeModel","TradeService"]).controller("TradeController",["$scope","$rootScope","$state","$stateParams","$modal","TradeModel","TradeService","CommonProvider",function($scope,$rootScope,$state,$stateParams,$modal,TradeModel,TradeService,CommonProvider){$scope.filter={},$scope.params={},$scope.search={},$scope.trade_list={},$scope.tradeAction={getIndex:function(page){var _self=this;$scope.params={role:"admin",page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:TradeModel,method:"get",params:params,success:function(trade_list){$scope.trade_list=trade_list}})},getItem:function(){CommonProvider.promise({model:TradeModel,method:"item",params:{trade_id:$stateParams.trade_id},success:function(trade_item){$scope.trade=trade_item.result}})},filterChanged:function(){var _self=this,status=$scope.filter.status;status?$scope.params.status=status:delete $scope.params.status,_self.getLists($scope.params)},getSearch:function(){var params=[{field:"num",operation:"like",value:$scope.search.keyword}];CommonProvider.search({service:new TradeService,method:"search",params:params,success:function(_trade_list){$scope.trade_list=_trade_list}})},del:function(params){return params.batch&&0==$scope.trade_list.result.checked().length?($modal.error({message:"至少需要选中一个订单"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中订单吗？":"确定要删除此订单吗？",info:"订单删除后可在订单回收站中查看",onsubmit:function(){CommonProvider.promise({model:TradeModel,method:params.batch?"delete":"del",params:params.batch?$scope.trade_list.result.checked():params.trade,success:function(_trade){$modal.success({message:_trade.message})},error:function(_trade){$modal.error({message:_trade.message})}})}})},getRecycle:function(page){var _self=this,params_recycle={role:"admin",x_status:0,page:page||1};_self.getLists(params_recycle)}}}]),angular.module("UserController",["angular.validation","angular.validation.rule","UserModel","angular-sortable-view","UserService"]).controller("UserController",["$scope","$rootScope","$state","$stateParams","$modal","$location","UserModel","RoleModel","PermissionModel","GrantApiModel","UserService","CommonProvider","PermissionProvider",function($scope,$rootScope,$state,$stateParams,$modal,$location,UserModel,RoleModel,PermissionModel,GrantApiModel,UserService,CommonProvider,PermissionProvider){$scope.filter={},$scope.params={},$scope.search={},$scope.userAction={getIndex:function(page){var _self=this;$scope.params={page:page||1,per_page:20},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:UserModel,method:"get",params:params,success:function(_user_list){$scope.user_list=_user_list}}),$rootScope.role_list||CommonProvider.promise({model:RoleModel,method:"get",params:{per_page:100},success:function(role_list){$rootScope.role_list=role_list}})},filterChanged:function(){var _self=this,status=$scope.filter.status;status?$scope.params.status=status:delete $scope.params.status,_self.getLists($scope.params)},getSearch:function(){var params=[{field:"name",operation:"like",value:$scope.search.keyword},{field:"id",operation:"like",value:$scope.search.keyword}];CommonProvider.search({service:new UserService,method:"search",params:params,success:function(_user_list){$scope.user_list=_user_list}})},getItem:function(){CommonProvider.promise({model:UserModel,method:"item",params:{user_id:$stateParams.user_id},success:function(user_item){$scope.user=user_item.result}})},add:function(params){params.modal?$modal.custom({title:"创建用户",template_url:"/partials/admin/user/manage/add.html"}):CommonProvider.promise({model:UserModel,method:"add",params:$scope.user,success:function(_user){CommonProvider.promise({model:UserModel,method:"role",params:{user:_user.result,ids:$rootScope.role_list.result.checked(),add:!0},success:function(_user){$rootScope.modal.close(),$modal.error({message:_user.message})},error:function(_user){$modal.error({message:_user.message})}})},error:function(_user){$modal.error({message:_user.message})}})},put:function(params){params.modal?($rootScope.user_local=params.user,$rootScope.user_edit=angular.copy(params.user.user),$modal.custom({title:"编辑用户",template_url:"/partials/admin/user/manage/edit.html",callback:function(){$rootScope.user_edit=null}})):(CommonProvider.promise({model:UserModel,method:"put",params:{"new":$scope.user,old:$rootScope.user_local},success:function(_user){$rootScope.user_local=null,$rootScope.modal.close(),$modal.success({message:_user.message})},error:function(_user){$modal.error({message:_user.message})}}),CommonProvider.promise({model:UserModel,method:"role",params:{user:$rootScope.user_local,ids:$rootScope.role_list.result.checked()}}))},role:function(user){CommonProvider.promise({model:UserModel,method:"role",params:user,success:function(_user){console.log(_user)}})},del:function(params){return params.batch&&0==$scope.user_list.result.checked().length?($modal.error({message:"至少需要选中一个用户"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中用户吗？":"确定要删除此用户吗？",info:"用户删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:UserModel,method:params.batch?"delete":"del",params:params.batch?$scope.user_list.result.checked():params.user,success:function(_user){$modal.success({message:_user.message})},error:function(_user){$modal.error({message:_user.message})}})}})},disable:function(params){return params.batch&&0==$scope.user_list.result.checked().length?($modal.error({message:"至少需要选中一个用户"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要禁用选中用户吗？":"确定要禁用此用户吗？",info:params.batch?"禁用后这些用户将不再可以登录及操作":"禁用后该用户将不再可以登录及操作",onsubmit:function(){CommonProvider.promise({model:UserModel,method:"disable",params:params.batch?$scope.user_list.result.checked():params.user,success:function(_user){$modal.success({message:_user.message})},error:function(_user){$modal.error({message:_user.message})}})}})},enable:function(params){return params.batch&&0==$scope.user_list.result.checked().length?($modal.error({message:"至少需要选中一个用户"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要启用选中用户吗？":"确定要启用此用户吗？",info:params.batch?"启用后选中用户将恢复正常操作权限":"启用后该用户将恢复正常操作权限",onsubmit:function(){CommonProvider.promise({model:UserModel,method:"enable",params:params.batch?$scope.user_list.result.checked():params.user,success:function(_user){$modal.success({message:_user.message})},error:function(_user){$modal.error({message:_user.message})}})}})},csv:function(){$modal.custom({title:"CSV",template:'<div class="text-center"><h1>来来来，CSV Import!</h1></div>'})}},$scope.roleAction={getLists:function(page){$rootScope.role_list=null,CommonProvider.promise({model:RoleModel,method:"get",params:{page:page||1},success:function(_role_list){$scope.role_list=_role_list}})},add:function(params){params.modal?$modal.custom({title:"添加角色",template_url:"/partials/admin/user/role/add.html"}):CommonProvider.promise({model:RoleModel,method:"add",params:$scope.role,success:function(_role){$rootScope.modal.close(),$modal.success({message:_role.message})},error:function(_role){$rootScope.modal.close(),$modal.error({message:_role.message})}})},edit:function(params){params.modal?($rootScope.role_local=params.role,$rootScope.role_edit=angular.copy(params.role.role),$modal.custom({title:"编辑角色",template_url:"/partials/admin/user/role/edit.html",callback:function(){delete $rootScope.role_edit}})):CommonProvider.promise({model:RoleModel,method:"put",params:{"new":$scope.role,old:$rootScope.role_local},success:function(_role){$rootScope.role_local=null,$rootScope.modal.close(),$modal.success({message:_role.message})},error:function(_role){$rootScope.modal.close(),$modal.error({
message:_role.message})}})},del:function(params){return params.batch&&0==$scope.role_list.result.checked().length?($modal.error({message:"至少需要选中一个角色"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中角色吗？":"确定要删除此角色吗？",info:"角色删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:RoleModel,method:params.batch?"delete":"del",params:params.batch?$scope.role_list.result.checked():params.role,success:function(_role){$modal.success({message:_role.message})},error:function(_role){$modal.error({message:_role.message})}})}})},disable:function(params){return params.batch&&0==$scope.role_list.result.checked().length?($modal.error({message:"至少需要选中一个角色"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要禁用选中角色吗？":"确定要禁用此角色吗？",info:params.batch?"禁用后选中角色权限将失效，成为普通用户":"禁用后该角色权限将失效，成为普通用户",onsubmit:function(){CommonProvider.promise({model:RoleModel,method:"disable",params:params.batch?$scope.role_list.result.checked():params.role,success:function(_role){$modal.success({message:_role.message})},error:function(_role){$modal.error({message:_role.message})}})}})},enable:function(params){return params.batch&&0==$scope.role_list.result.checked().length?($modal.error({message:"至少需要选中一个角色"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要启用选中角色吗？":"确定要启用此角色吗？",info:params.batch?"启用后选中角色包含用户将恢复正常操作权限":"启用后该角色包含用户将恢复正常操作权限",onsubmit:function(){CommonProvider.promise({model:RoleModel,method:"enable",params:params.batch?$scope.role_list.result.checked():params.role,success:function(_role){$modal.success({message:_role.message})},error:function(_role){$modal.error({message:_role.message})}})}})},permission:function(role){$rootScope.current_role_permissions=role.permissions,$modal.custom({title:role.name+"所拥有的权限",template_url:"/partials/admin/user/role/permission.html",callback:function(){delete $rootScope.current_role_permissions}})},getRole:function(){CommonProvider.promise({model:RoleModel,method:"getRole",params:$stateParams.role_id,success:function(_role){$scope.role=_role.result}}),CommonProvider.promise({model:PermissionModel,method:"get",success:function(permission_list){$scope.permission_list=permission_list}})},editPermissions:function(){CommonProvider.promise({model:RoleModel,method:"permission",params:{id:$scope.role.id,ids:$scope.permission_list.result.checked("children")},success:function(_role){PermissionProvider.init(),$modal.success({message:_role.message}),$location.path("/user/manage/role/list")},error:function(_role){$modal.error({message:_role.message})}})}},$scope.permissionAction={getLists:function(){CommonProvider.promise({model:PermissionModel,method:"get",success:function(permission_list){$scope.permission_list=permission_list,$rootScope.permission_list=permission_list.result}}),$rootScope.api_list||CommonProvider.promise({model:GrantApiModel,method:"get",params:{per_page:400},success:function(api_list){$rootScope.api_list=api_list.result}})},sort:function($item,$partFrom,$partTo,$indexFrom,$indexTo){for(var sort,sorts=[],i=0;i<$partTo.length;i++)sort={},sort.id=$partTo[i].id,sort.sort=i,sorts.push(sort);PermissionModel.sort(sorts)},add:function(params){params.modal?$modal.custom({title:"添加权限",template_url:"/partials/admin/user/permission/add.html"}):CommonProvider.promise({model:PermissionModel,method:"add",params:$scope.permission,success:function(permission){$rootScope.modal.close(),$modal.success({title:"添加成功"})},error:function(permission){$modal.error({title:permission.message})}})},del:function(params){return params.batch&&0==$scope.permission_list.result.checked("children").length?($modal.error({message:"至少需要选中一个角色"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中权限吗？":"确定要删除此权限吗？",info:"权限删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:PermissionModel,method:params.batch?"delete":"del",params:params.batch?$scope.permission_list.result.checked("children"):params.permission,success:function(_permission){$modal.success({message:_permission.message})},error:function(_permission){$modal.error({message:_permission.message})}})}})},edit:function(params){params.modal?($rootScope.permission_local=params.permission,$rootScope.permission_edit=angular.copy(params.permission.permission),$modal.custom({title:"编辑用户",template_url:"/partials/admin/user/permission/edit.html",callback:function(){delete $rootScope.permission_edit}})):CommonProvider.promise({model:PermissionModel,method:"put",params:{"new":$scope.permission,old:$rootScope.permission_local},success:function(_permission){$rootScope.modal.close(),$modal.success({message:_permission.message,callback:function(){delete $rootScope.permission_local}})},error:function(_permission){$modal.error({message:_permission.message})}})},disable:function(params){return params.batch&&0==$scope.permission_list.result.checked("children").length?($modal.error({message:"至少需要选中一个权限"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要禁用选中权限吗？":"确定要禁用此权限吗？",info:params.batch?"禁用权限后，所有关联用户的权限将立即失效":"禁用后该权限将失效",onsubmit:function(){CommonProvider.promise({model:PermissionModel,method:"disable",params:params.batch?$scope.permission_list.result.checked("children"):params.permission,success:function(_permission){$modal.success({message:_permission.message})},error:function(_permission){$modal.error({message:_permission.message})}})}})},enable:function(params){return params.batch&&0==$scope.permission_list.result.checked("children").length?($modal.error({message:"至少需要选中一个权限"}),!1):void $modal.confirm({title:"确认操作",message:params.batch?"确定要启用选中权限吗？":"确定要启用此权限吗？",info:params.batch?"启用后选中权限包含用户将恢复正常操作权限":"启用后该权限包含用户将恢复正常操作权限",onsubmit:function(){CommonProvider.promise({model:PermissionModel,method:"enable",params:params.batch?$scope.permission_list.result.checked("children"):params.permission,success:function(_permission){$modal.success({message:_permission.message})},error:function(_permission){$modal.error({message:_permission.message})}})}})},api:function(apis){$rootScope.current_permission_apis=apis,$modal.custom({title:"api详情",template_url:"/partials/admin/user/permission/api.html",callback:function(){delete $rootScope.current_permission_apis}})},getPermission:function(){$scope.permission=null,CommonProvider.promise({model:PermissionModel,method:"item",params:$stateParams.permission_id,success:function(_permission){$scope.permission=_permission.result}}),$rootScope.api_list||CommonProvider.promise({model:GrantApiModel,method:"get",params:{per_page:400},success:function(api_list){$rootScope.api_list=api_list.result}})},editApis:function(params){CommonProvider.promise({model:PermissionModel,method:"api",params:{id:$scope.permission.id,ids:$rootScope.api_list.checked()},success:function(_permission){$modal.success({message:_permission.message}),$location.path("/user/manage/permission/list")},error:function(_permission){$modal.error({message:_permission.message})}})},toSlug:function(){$scope.permission.slug=$scope.permission.url?$scope.permission.url.replace(/^\/|\s+$/g,"").replace(/\//g,"."):""}},$scope.apiAction={getLists:function(page){CommonProvider.promise({model:GrantApiModel,method:"get",params:{page:page||1},success:function(api_list){$scope.api_list=api_list}})},add:function(params){params.modal?$modal.custom({title:"添加API",template_url:"/partials/admin/user/api/add.html"}):CommonProvider.promise({model:GrantApiModel,method:"add",params:$scope.api,success:function(_api){$rootScope.modal.close(),$modal.success({message:_api.message})},error:function(_api){$modal.error({message:_api.message})}})},put:function(params){params.modal?($rootScope.api=angular.copy(params.api.api),$rootScope.api_local=params.api,$modal.custom({title:"添加API",template_url:"/partials/admin/user/api/edit.html",callback:function(){$rootScope.api=null}})):CommonProvider.promise({model:GrantApiModel,method:"put",params:{"new":$scope.api,old:$rootScope.api_local},success:function(_api){$rootScope.api_local=null,$rootScope.modal.close(),$modal.success({message:_api.message})},error:function(_api){$modal.error({message:_api.message})}})},del:function(params){return params.batch&&0==$scope.api_list.result.checked().length?($modal.error({message:"至少需要选中一个API"}),!1):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中API吗？":"确定要删除此API吗？",info:"API删除操作不可撤销",onsubmit:function(){CommonProvider.promise({model:GrantApiModel,method:params.batch?"delete":"del",params:params.batch?$scope.api_list.result.checked():params.api,success:function(_api){$modal.success({message:_api.message})},error:function(_api){$modal.error({message:_api.message})}})}})}}}]),angular.module("WithdrawController",["WithdrawModel"]).controller("WithdrawController",["$scope","$rootScope","$state","$stateParams","$modal","WithdrawModel","CommonProvider",function($scope,$rootScope,$state,$stateParams,$modal,WithdrawModel,CommonProvider){$scope.filter={},$scope.params={},$scope.withdraw={},$scope.withdraw_list={},$scope.withdrawAction={getIndex:function(page){var _self=this;$scope.params={page:page||1},_self.getLists($scope.params)},getLists:function(params){CommonProvider.promise({model:WithdrawModel,method:"get",params:params,success:function(_withdraw_list){$scope.withdraw_list=_withdraw_list}})},getItem:function(){CommonProvider.promise({model:WithdrawModel,method:"item",params:{withdraw_id:$stateParams.withdraw_id},success:function(_withdraw_item){$scope.withdraw=_withdraw_item.result}})},filterChanged:function(){var _self=this,status=$scope.filter.status;status?$scope.params.status=status:delete $scope.params.status,_self.getLists($scope.params)},edit:function(params){params.modal?($rootScope.withdraw_local=params.withdraw,$rootScope.withdraw_edit=angular.copy(params.withdraw.withdraw),$modal.custom({title:"处理提现",template_url:"/partials/admin/trade/withdraw/edit.html",callback:function(){delete $rootScope.withdraw_edit}})):CommonProvider.promise({model:WithdrawModel,method:"put",params:{body:$scope.withdraw,id:$scope.withdraw.id},success:function(_withdraw){$rootScope.withdraw_local.$parent.withdraw=_withdraw.result,$rootScope.modal.close(),$modal.success({message:_withdraw.message,callback:function(){delete $rootScope.withdraw_local}})},error:function(_withdraw){$modal.error({message:_withdraw.message})}})},del:function(params){return params.batch&&0==$scope.withdraw_list.result.checked().length?$modal.error({message:"至少需要选中一个提现单"}):void $modal.confirm({title:"确认删除",message:params.batch?"确定要删除选中提现单吗？":"确定要删除此提现单吗？",info:"提现单删除后可在回收站中查看",onsubmit:function(){CommonProvider.promise({model:WithdrawModel,method:params.batch?"delete":"del",params:params.batch?$scope.withdraw_list.result.checked():params.withdraw,success:function(_withdraw){$modal.success({message:_withdraw.message})},error:function(_withdraw){$modal.error({message:_withdraw.message})}})}})}}}]),angular.module("AuthProvider",["AuthModel"]).factory("PermissionProvider",["$rootScope","$localStorage","$location","$state","CommonProvider","AuthModel",function($rootScope,$localStorage,$location,$state,CommonProvider,AuthModel){return{init:function(){$localStorage.token?CommonProvider.promise({model:AuthModel,method:"check",success:function(auth){$localStorage.user=auth.result,CommonProvider.promise({method:"menu",model:AuthModel,success:function(permissions){$rootScope.permissions=permissions.result,$rootScope.menus=$rootScope.permissions.menus,$rootScope.routes=$rootScope.permissions.grant_routes,$rootScope.admin_menu_show=!1,$rootScope.$broadcast("permissionsChanged"),$rootScope.routeCheck()}})},error:function(){$location.path("/login")}}):"/login"!=$location.$$url&&"/forgot"!=$location.$$url&&"/register"!=$location.$$url&&$location.path("/login")}}}]).factory("AuthProvider",["$rootScope","$localStorage","$location","$state","$window","CommonProvider","AuthModel",function($rootScope,$localStorage,$location,$state,$window,CommonProvider,AuthModel){var AuthProvider={init:function(callback){$localStorage.token?CommonProvider.promise({model:AuthModel,method:"check",success:function(auth){$localStorage.user=auth.result,$rootScope.user=auth.result,callback&&"function"==typeof callback&&callback(auth.result)},error:function(){delete $localStorage.token,$localStorage.user&&delete $localStorage.user}}):$localStorage.user&&delete $localStorage.user},login:function(config){CommonProvider.promise({model:AuthModel,method:"login",params:config.user,success:function(auth){return $localStorage.token=auth.result,$rootScope.setTokenLimit(config.user.auto_login),config.callback?(config.callback(auth),!1):(AuthProvider.init(),void(config.modal?$rootScope.modal.close():$location.path("/index")))},error:function(auth){$rootScope.modal.close(),$rootScope.modal.error({message:auth.message,info:auth.result})}})},logout:function(){CommonProvider.promise({model:AuthModel,method:"logout",success:function(){console.log("退出成功"),delete $rootScope.user,delete $rootScope.token,delete $localStorage.user,delete $localStorage.token,$window.location.href="/"}})},check:function(callback){var user=$rootScope.user||$localStorage.user||!1;user?callback(user):$rootScope.$watch("user",function(user){user&&callback(user)})}};return AuthProvider}]),angular.module("CommonProvider",[]).factory("CommonProvider",["$q","$rootScope","$window","$location","$anchorScroll","$modal",function($q,$rootScope,$window,$location,$anchorScroll,$modal){var commonProvider={request:function(config){if(config.method="$"+config.method,config.params=config.params||{},config.body)for(var key in config.body){var name=key,value=config.body[key];config.service[name]=config.body[key]}else config.body={};var deferred=$q.defer(),success_callback=function(result){deferred.resolve(result),1==result.code&&config.success&&"function"==typeof config.success&&eval(config.success(result))},error_callback=function(error){deferred.reject(error),config.error&&"function"==typeof config.error&&eval(config.error(error))};return config.service[config.method]&&config.service[config.method](config.params,function(result){success_callback(result)},function(error){error_callback(error)}),deferred.promise},promise:function(config){config.method=config.method,config.params=config.params||{};var success_callback=function(result){1==result.code?config.success&&"function"==typeof config.success&&eval(config.success(result)):config.error&&"function"==typeof config.error&&eval(config.error(result))},error_callback=function(error){config.error&&"function"==typeof config.error&&eval(config.error(error))},result_callback=function(result){config.result&&"function"==typeof config.result&&eval(config.result(result))};config.model[config.method]&&config.model[config.method](config.params).then(function(result){result_callback(result),success_callback(result)},function(error){result_callback(error)})},search:function(config){config.method=config.method,config.params=config.params||{},config.success=config.success,config.error=config.error;var params_length=config.params.length,params_search=[];params_length>0&&angular.forEach(config.params,function(value,key){angular.forEach(value,function(v,k){params_search["column["+key+"]["+k+"]"]=v})}),commonProvider.request({service:config.service,method:"search",params:params_search,success:config.success,error:config.error})},sort:function(config){if(config.method=config.method,config.params=config.params||{},config.data=config.data||{},config.params.partTo){for(var sorts=[],sort={},i=0;i<config.params.partTo.length;i++)sort={},sort.id=config.params.partTo[i].id,sort.data={sort:i},sorts.push(sort);config.model.sort&&config.model.sort(sorts).then(function(result){config.data.find(config.params.item).sort=config.params.indexTo})}},toTop:function(){var scrollTo=function(element,to,duration){if(!(0>=duration)){var difference=to-element.scrollTop,perTick=difference/duration*10;setTimeout(function(){element.scrollTop=element.scrollTop+perTick,element.scrollTop!=to&&scrollTo(element,to,duration-10)},10)}};scrollTo(document.body,0,30)},autoTop:function(){$rootScope.$on("$locationChangeSuccess",function(){commonProvider.toTop()})},goToDom:function(id){var old=$location.hash();$location.hash(id),$anchorScroll(),$location.hash(old)},setTabActive:function(scope,tab_index){return scope?!scope.tabs||scope.tabs&&!scope.tabs.length?!1:(scope.tabs.setAttr("active",!1),void(scope.tabs[tab_index-1].active=!0)):!1},getThumbnail:function(key,type,params){if(key){var blur,default_params={mode:1,width:500,height:300,format:"jpg",interlace:1,quality:100,blur:0},param=angular.extend(default_params,params||{});switch(param.blur){case 0:blur="";break;case 1:blur="|imageMogr2/blur/2x2";break;case 2:blur="|imageMogr2/blur/5x5";break;case 3:blur="|imageMogr2/blur/10x10"}return $rootScope.config.fileUrl+key+"?imageView2/"+param.mode+"/w/"+param.width+"/h/"+param.height+"/format/"+param.format+"/interlace/"+param.interlace+"/q/"+param.quality+blur}},share:function(type){var wb_parems="url="+$location.$$absUrl+"&title="+$rootScope.title+" - "+$rootScope.description+"&language=zh_cn&searchPic=true",qq_parems="url="+$location.$$absUrl+"&title="+$rootScope.title+"&summary="+$rootScope.description+"&site=学天下&desc=我发现了一个不错的学习网站哦，快来看看吧！&pics=",qr_parems="text="+$location.$$absUrl;switch(qr_parems=qr_parems.contain("www")?qr_parems.replace(/www/gi,"m"):qr_parems.add("m.","http://"),type){case"qq":$window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?"+qq_parems);break;case"weibo":$window.open("http://service.weibo.com/share/share.php?"+wb_parems);break;case"qrcode":$modal.image({url:"/server/api/v1/qrcode?"+qr_parems})}}};return commonProvider}]),angular.module("QuploadProvider",[]).factory("QuploadProvider",["$rootScope","appConfig",function($rootScope,appConfig){var quploadProvider={getThumbnail:function(key,type,params){if(key&&""!=key){var default_params={mode:1,width:500,height:300,format:"jpg",interlace:1,quality:100,blur:0};void 0==params&&(params={});var blur,param=angular.extend(default_params,params);0==param.blur?blur="":1==param.blur?blur="|imageMogr2/blur/2x2":2==param.blur?blur="|imageMogr2/blur/5x5":3==param.blur&&(blur="|imageMogr2/blur/10x10");var thumbnail_src=appConfig.fileUrl+key+"?imageView2/"+param.mode+"/w/"+param.width+"/h/"+param.height+"/format/"+param.format+"/interlace/"+param.interlace+"/q/"+param.quality+blur;return thumbnail_src}},getStatic:function(key,params){if(key&&""!=key){var default_params={mode:1,width:500,height:300,format:"jpg",interlace:1,quality:100,blur:0};void 0==params&&(params={});var blur,param=angular.extend(default_params,params);0==param.blur?blur="":1==param.blur?blur="|imageMogr2/blur/2x2":2==param.blur?blur="|imageMogr2/blur/5x5":3==param.blur&&(blur="|imageMogr2/blur/10x10");var thumbnail_src=appConfig.staticUrl+key+"?imageView2/"+param.mode+"/w/"+param.width+"/h/"+param.height+"/format/"+param.format+"/interlace/"+param.interlace+"/q/"+param.quality+blur;return thumbnail_src}}};return quploadProvider}]),angular.module("AdvertiseService",[]).service("AdvertiseService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/advertise",{},{item:{method:"GET",url:appConfig.apiUrl+"/advertise/:advertise_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/advertise/:advertise_id"},put:{method:"PUT",url:appConfig.apiUrl+"/advertise/:advertise_id"}})}]),angular.module("AnnouncementService",[]).service("AnnouncementService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/announcement",{},{put:{method:"PUT",url:appConfig.apiUrl+"/announcement/:announcement_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/announcement/:announcement_id"}})}]),angular.module("ArticleService",[]).service("ArticleService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/article",{},{item:{method:"GET",url:appConfig.apiUrl+"/article/:article_id"},put:{method:"PUT",url:appConfig.apiUrl+"/article/:article_id"},search:{method:"GET",url:appConfig.apiUrl+"/article/search"},disable:{method:"PUT",url:appConfig.apiUrl+"/article/disable"},enable:{method:"PUT",url:appConfig.apiUrl+"/article/enable"}})}]),angular.module("AuditService",[]).service("AuditService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/organization/audit_infos",{},{put:{method:"PUT",url:appConfig.apiUrl+"/organization/:organization_id/audit_info"},item:{method:"GET",url:appConfig.apiUrl+"/organization/:organization_id/audit_info"},put:{method:"PUT",url:appConfig.apiUrl+"/organization/:organization_id/audit_info"}})}]),angular.module("AuthService",[]).service("AuthService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/account/login",{},{login:{method:"POST",url:appConfig.apiUrl+"/account/login"},logout:{method:"GET",url:appConfig.apiUrl+"/account/logout"},register:{method:"POST",url:appConfig.apiUrl+"/account/register"},forgot:{method:"PUT",url:appConfig.apiUrl+"/account/password/forget"},reset:{method:"PUT",url:appConfig.apiUrl+"/account/password/reset"},check:{method:"GET",url:appConfig.apiUrl+"/account/probe_login"},menu:{method:"GET",url:appConfig.apiUrl+"/account/menu"},getThirds:{method:"GET",url:appConfig.apiUrl+"/account/social"},thirdLogin:{method:"GET",url:appConfig.apiUrl+"/account/social/login/:type"},thirdBind:{method:"POST",url:appConfig.apiUrl+"/account/social/:type"},thirdUnbind:{method:"DELETE",url:appConfig.apiUrl+"/account/social/:id"}})}]),angular.module("BankService",[]).service("BankService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/bank_account",{},{del:{method:"DELETE",url:appConfig.apiUrl+"/bank_account/:bank_id"},getInfo:{method:"GET",url:appConfig.apiUrl+"/card_info"}})}]),angular.module("CategoryService",[]).service("CategoryService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/category",{per_page:"@per_page",page:"@page"},{getChildrens:{method:"GET",url:appConfig.apiUrl+"/category/:category_id"},put:{method:"PUT",url:appConfig.apiUrl+"/category/:category_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/category/:category_id"},disable:{method:"PUT",url:appConfig.apiUrl+"/category/disable"},enable:{method:"PUT",url:appConfig.apiUrl+"/category/enable"},sort:{method:"PUT",url:appConfig.apiUrl+"/category"}})}]),angular.module("ChatService",[]).service("ChatService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/chat/record/:section_id",{},{})}]),angular.module("CommentService",[]).service("CommentService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/course_comment",{},{del:{method:"DELETE",url:appConfig.apiUrl+"/course_comment/:comment_id"}})}]),angular.module("CommonService",[]).service("CommonService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/",{},{sms:{method:"GET",url:appConfig.apiUrl+"/sms/verify_code/:rule/:phone"},area:{method:"GET",url:appConfig.apiUrl+"/area"},config:{method:"GET",url:appConfig.apiUrl+"/config"},configByName:{method:"GET",url:appConfig.apiUrl+"/config/name/:name"}})}]),angular.module("ConfigService",[]).service("SystemService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/config",{},{putGroup:{method:"PUT",url:appConfig.apiUrl+"/config"},putItem:{method:"PUT",url:appConfig.apiUrl+"/config/:config_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/config/:config_id"}})}]).service("LogService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/log",{},{clear:{method:"DELETE",url:appConfig.apiUrl+"/log/all"}})}]),angular.module("CourseService",[]).service("CourseService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/course",{per_page:"@per_page",page:"@page"},{getUsersInfo:{method:"POST",url:appConfig.apiUrl+"/user/info"},item:{method:"GET",url:appConfig.apiUrl+"/course/:course_id"},search:{method:"GET",url:appConfig.apiUrl+"/course/search/"},del:{method:"DELETE",url:appConfig.apiUrl+"/course/:course_id"},put:{method:"PUT",url:appConfig.apiUrl+"/course/:course_id"},disable:{method:"PUT",url:appConfig.apiUrl+"/course/disable"},enable:{method:"PUT",url:appConfig.apiUrl+"/course/enable"},others:{method:"GET",url:appConfig.apiUrl+"/course/:course_id/others"},classmates:{method:"GET",url:appConfig.apiUrl+"/course/:course_id/classmates"},relation:{method:"GET",url:appConfig.apiUrl+"/course/:course_id/with/user"},operation:{method:"POST",url:appConfig.apiUrl+"/course/:course_id/operation"}})}]),angular.module("FavoriteService",[]).service("FavoriteService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/favorite/:type/:target_id",{},{get:{method:"GET",url:appConfig.apiUrl+"/favorite/:type"},getStatus:{method:"GET",url:appConfig.apiUrl+"/favorite/:type/status"}})}]),angular.module("FeedbackService",[]).service("FeedbackService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/feedback",{},{item:{method:"GET",url:appConfig.apiUrl+"/feedback/:feedback_id"},put:{method:"PUT",url:appConfig.apiUrl+"/feedback/:feedback_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/feedback/:feedback_id"}})}]),angular.module("FileService",[]).service("FileService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/file/:type",{type:"@type"},{getFileUptoken:{method:"GET",params:{token:"@token"},url:appConfig.apiUrl+"/file/file_uptoken"},getVideoUptoken:{method:"GET",params:{token:"@token"},url:appConfig.apiUrl+"/file/video_uptoken/:key"}})}]),angular.module("IndexService",[]).service("IndexService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/index",{},{partners:{method:"GET",url:appConfig.apiUrl+"/partner"},put:{method:"PUT",url:appConfig.apiUrl+"/index/:config_id"}})}]),angular.module("LinkService",[]).service("LinkService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/link",{},{item:{method:"GET",url:appConfig.apiUrl+"/link/:link_id"},put:{method:"PUT",url:appConfig.apiUrl+"/link/:link_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/link/:link_id"}})}]),angular.module("MsgService",[]).service("MsgService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/message",{per_page:"@per_page",page:"@page"},{batch:{method:"PUT",url:appConfig.apiUrl+"/message/:act_type"}})}]),angular.module("NoteService",[]).service("NoteService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/note",{},{item:{method:"GET",url:appConfig.apiUrl+"/note/:note_id"},search:{method:"GET",url:appConfig.apiUrl+"/note/search"},del:{method:"DELETE",url:appConfig.apiUrl+"/note/:note_id"},put:{method:"PUT",url:appConfig.apiUrl+"/note/:note_id"}})}]),angular.module("OrganizationService",[]).service("OrganizationService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/organization",{per_page:"@per_page",page:"@page"},{relation:{method:"GET",url:appConfig.apiUrl+"/organization_user"},itemRelation:{method:"GET",url:appConfig.apiUrl+"/organization_user/:relation_id"},addRelation:{method:"POST",url:appConfig.apiUrl+"/organization_user"},putRelation:{method:"PUT",url:appConfig.apiUrl+"/organization_user/:relation_id"},delRelation:{method:"DELETE",url:appConfig.apiUrl+"/organization_user/:relation_id"},item:{method:"GET",url:appConfig.apiUrl+"/organization/:organization_id"},search:{method:"GET",url:appConfig.apiUrl+"/organization/search"},getProfile:{method:"GET",url:appConfig.apiUrl+"/organization/:organization_id/profile"},putProfile:{method:"PUT",url:appConfig.apiUrl+"/organization/:organization_id/profile"},put:{method:"PUT",url:appConfig.apiUrl+"/organization/:organization_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/organization/:organization_id"}})}]),angular.module("PartnerService",[]).service("PartnerService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/partner",{},{put:{method:"PUT",url:appConfig.apiUrl+"/partner/:partner_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/partner/:partner_id"}})}]),angular.module("PaymentService",[]).service("PaymentService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/payment",{},{pay:{method:"POST",url:appConfig.apiUrl+"/payment"},getStatus:{method:"GET",url:appConfig.apiUrl+"/payment/:payment_id"},payment:{method:"PUT",url:appConfig.apiUrl+"/payment/:payment_id"},item:{method:"GET",url:appConfig.apiUrl+"/payment/:payment_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/payment/:payment_id"}})}]),angular.module("PublicService",[]).service("PublicService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/",{},{clearcache:{method:"DELETE",url:appConfig.apiUrl+"/cache/:tag"}})}]),angular.module("QuestionService",[]).service("QuestionService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/question",{},{item:{method:"GET",url:appConfig.apiUrl+"/question/:question_id"},search:{method:"GET",url:appConfig.apiUrl+"/question/search"},del:{method:"DELETE",url:appConfig.apiUrl+"/question/:question_id"},put:{method:"PUT",url:appConfig.apiUrl+"/question/:question_id"}})}]),angular.module("ScoreService",[]).service("ScoreService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/score",{},{getLevels:{method:"GET",url:appConfig.apiUrl+"/score_level"},getRules:{method:"GET",url:appConfig.apiUrl+"/score_rule"}})}]),angular.module("SearchService",[]).service("SearchService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/search/:search_type",{key:"@search_type"},{get:{method:"GET",params:{page:"@page",detail:"@detail",keyword:"@keyword",per_page:"@per_page",category_id:"@category_id",sort_id:"@sort_id",labels:"@labels"},headers:{"Content-Type":"application/x-www-form-encoded;charset=UTF-8"}},getHotWords:{method:"GET",url:appConfig.apiUrl+"/search/hot"},putHotWords:{method:"PUT",url:appConfig.apiUrl+"/search/hot"},searchInit:{method:"GET",url:appConfig.apiUrl+"/search/:type/init"},searchClean:{method:"GET",url:appConfig.apiUrl+"/search/:type/clean"}})}]),angular.module("SectionService",[]).service("SectionService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/section",{},{update:{method:"PUT",url:appConfig.apiUrl+"/section"},item:{method:"GET",url:appConfig.apiUrl+"/section/:section_id"},put:{method:"PUT",url:appConfig.apiUrl+"/section/:section_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/section/:section_id"},postStudyRecord:{method:"POST",url:appConfig.apiUrl+"/section/:section_id/study_record"},getVideos:{method:"GET",url:appConfig.apiUrl+"/section/:section_id/videos"},getQuestions:{method:"GET",url:appConfig.apiUrl+"/section/:section_id/questions"},initLiveSection:{method:"GET",url:appConfig.apiUrl+"/section/:section_id/live_init"},closeLiveSection:{method:"GET",url:appConfig.apiUrl+"/section/:section_id/live_finish"},getLiveUpstream:{method:"GET",url:appConfig.apiUrl+"/section/:section_id/live_upstream"}})}]),angular.module("SmsService",[]).service("SmsService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/sms",{},{item:{method:"GET",url:appConfig.apiUrl+"/sms/:sms_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/sms/:sms_id"}})}]),angular.module("StudentService",[]).service("StudentService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/user/:target_type",{},{put:{method:"PUT",url:appConfig.apiUrl+"/account/info"}})}]),angular.module("TeacherService",[]).service("TeacherService",["$resource","appConfig",function($resource,appConfig){
return $resource(appConfig.apiUrl+"/teacher/:target_type",{},{incomeDetail:{method:"GET",url:appConfig.apiUrl+"/teacher/income/detail"},incomeDaily:{method:"GET",url:appConfig.apiUrl+"/teacher/income/daily"}})}]),angular.module("TradeService",[]).service("TradeService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/trade",{per_page:"@per_page",page:"@page"},{item:{method:"GET",url:appConfig.apiUrl+"/trade/:trade_id"},search:{method:"GET",url:appConfig.apiUrl+"/trade/search"},cancel:{method:"PUT",url:appConfig.apiUrl+"/trade/:trade_id/cancel"},del:{method:"DELETE",url:appConfig.apiUrl+"/trade/:trade_id"}})}]),angular.module("UserService",[]).service("UserService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/user",{per_page:"@per_page",page:"@page"},{item:{method:"GET",url:appConfig.apiUrl+"/user/:user_id"},search:{method:"GET",url:appConfig.apiUrl+"/user/search"},del:{method:"DELETE",url:appConfig.apiUrl+"/user/:user_id"},put:{method:"PUT",url:appConfig.apiUrl+"/user/:user_id"},disable:{method:"PUT",url:appConfig.apiUrl+"/user/disable"},enable:{method:"PUT",url:appConfig.apiUrl+"/user/enable"},role:{method:"POST",url:appConfig.apiUrl+"/user/:user_id/role"}})}]).service("RoleService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/role",{per_page:"@per_page",page:"@page"},{getRole:{method:"GET",url:appConfig.apiUrl+"/role/:role_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/role/:role_id"},put:{method:"PUT",url:appConfig.apiUrl+"/role/:role_id"},disable:{method:"PUT",url:appConfig.apiUrl+"/role/disable"},enable:{method:"PUT",url:appConfig.apiUrl+"/role/enable"},permission:{method:"POST",url:appConfig.apiUrl+"/role/:role_id/permission"}})}]).service("PermissionService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/permission",{},{item:{method:"GET",url:appConfig.apiUrl+"/permission/:permission_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/permission/:permission_id"},put:{method:"PUT",url:appConfig.apiUrl+"/permission/:permission_id"},disable:{method:"PUT",url:appConfig.apiUrl+"/permission/disable"},enable:{method:"PUT",url:appConfig.apiUrl+"/permission/enable"},api:{method:"POST",url:appConfig.apiUrl+"/permission/:permission_id/api"},sort:{method:"POST",url:appConfig.apiUrl+"/permission/update_sort"}})}]).service("GrantApiService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/api",{per_page:"@per_page",page:"@page"},{del:{method:"DELETE",url:appConfig.apiUrl+"/api/:api_id"},put:{method:"PUT",url:appConfig.apiUrl+"/api/:api_id"}})}]),angular.module("WithdrawService",[]).service("WithdrawService",["$resource","appConfig",function($resource,appConfig){return $resource(appConfig.apiUrl+"/withdraw",{per_page:"@per_page",page:"@page"},{item:{method:"GET",url:appConfig.apiUrl+"/withdraw/:withdraw_id"},cancel:{method:"PUT",url:appConfig.apiUrl+"/withdraw/:withdraw_id/cancel"},put:{method:"PUT",url:appConfig.apiUrl+"/withdraw/:withdraw_id"},del:{method:"DELETE",url:appConfig.apiUrl+"/withdraw/:withdraw_id"}})}]),angular.module("HtmlFilter",[]).filter("toHtml",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]).filter("textOverflow",["$sce",function($sce){return function(text,length){return length&&text&&text.length>length?text.substr(0,length)+"...":text}}]).filter("priceFormat",[function(){return function(text){return isNaN(text)?text:text.toFixed(2)}}]).filter("readMore",function(){return function(content,length,text){var more_btn='...<a class="read-more">&nbsp;&nbsp;'+(text||"查看全部")+"&nbsp;>></a>";return 0!=content.length&&content.length<length?content:content.substr(0,length)+more_btn}}),angular.module("TimeFilter",[]).filter("dateFilter",["dateFilter",function(dateFilter){return function(text){return dateFilter(text,"yyyy-MM-dd")}}]).filter("toYMD",[function(){return function(date){return date?date.toString().substr(0,10):date}}]).filter("relativeTime",["$rootScope",function($rootScope){return function(time){return $rootScope.moment.from(time,!1)}}]).filter("toHHMMSS",function(){return function(sec,type,h_slug,m_slug,s_slug){var sec_num=parseInt(sec,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds);var hour_display,minute_display,second_display;type?(hour_display=type.indexOf("H")>-1&&hours>0,minute_display=type.indexOf("M")>-1,second_display=type.indexOf("S")>-1):hour_display=minute_display=second_display=!0;var hour_slug=void 0!=h_slug?h_slug:":",minute_slug=void 0!=m_slug?m_slug:":",second_slug=void 0!=s_slug?s_slug:"",time=(hour_display?hours+hour_slug:"")+(minute_display?minutes+minute_slug:"")+(second_display?seconds+second_slug:"");return time}}),angular.module("AdvertiseModel",["AdvertiseService"]).factory("AdvertiseModel",["AdvertiseService","CommonProvider",function(AdvertiseService,CommonProvider){var _advertise_list,_advertise_item,_advertise_model={};return _advertise_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new AdvertiseService,params:params,success:function(advertise_lists){_advertise_list=advertise_lists}})},item:function(params){return CommonProvider.request({method:"item",service:new AdvertiseService,params:params,success:function(advertise_item){_advertise_item=advertise_item}})},add:function(advertise){return CommonProvider.request({method:"save",service:new AdvertiseService(advertise)})},put:function(advertise){return CommonProvider.request({method:"put",service:new AdvertiseService(advertise),params:{advertise_id:advertise.id},success:function(_advertise){return _advertise}})},del:function(advertise){return CommonProvider.request({method:"del",service:new AdvertiseService,params:{advertise_id:advertise.id},success:function(_advertise){_advertise_list.result.remove(advertise),_advertise_list.pagination.total-=1}})}}}]),angular.module("AnnouncementModel",["AnnouncementService"]).factory("AnnouncementModel",["AnnouncementService","CommonProvider",function(AnnouncementService,CommonProvider){var _announcement_list,_announcement_model={get:function(params){return CommonProvider.request({method:"get",service:new AnnouncementService,params:params,success:function(announcement_list){_announcement_list=announcement_list}})},del:function(params){return CommonProvider.request({method:"del",service:new AnnouncementService,params:params,success:function(_announcement){var remove_item=_announcement_list.result.find(params.announcement_id,"id");_announcement_list.result.remove(remove_item),_announcement_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new AnnouncementService,params:{ids:ids.join(",")},success:function(_feedback){_announcement_model.get({page:_announcement_list.pagination.current_page})}})},put:function(params){return CommonProvider.request({method:"put",service:new AnnouncementService(params.body),params:{role:params.role,announcement_id:params.body.id}})},add:function(params){return CommonProvider.request({method:"save",service:new AnnouncementService(params.body),params:{role:params.role}})}};return _announcement_model}]),angular.module("ArticleModel",["ArticleService"]).factory("ArticleModel",["ArticleService","CommonProvider",function(ArticleService,CommonProvider){var _article_list,_article={},_article_model={};return _article_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new ArticleService,params:params,success:function(_article_lists){_article_list=_article_lists}})},add:function(article){return CommonProvider.request({method:"save",service:new ArticleService(article)})},item:function(params){return CommonProvider.request({method:"item",service:new ArticleService,params:params,success:function(_article_item){_article.info=_article_item}})},put:function(article){return CommonProvider.request({method:"put",service:new ArticleService(article),params:{article_id:article.id},success:function(_article){return _article}})},del:function(article){return CommonProvider.request({method:"del",service:new ArticleService,params:{article_id:article.article.id},success:function(_article){_article_list.result.remove(article.article),_article_list.pagination.total-=1}})},disable:function(params){var ids=params.length?params.join(","):params.article.id;return CommonProvider.request({method:"disable",service:new ArticleService({ids:ids}),success:function(_article){params.length?_article_model.get({page:_article_list.pagination.current_page}):params.article.x_status=0}})},enable:function(params){var ids=params.length?params.join(","):params.article.id;return CommonProvider.request({method:"enable",service:new ArticleService({ids:ids}),success:function(_article){params.length?_article_model.get({page:_article_list.pagination.current_page}):params.article.x_status=1}})}}}]),angular.module("AuditModel",["AuditService"]).factory("AuditModel",["AuditService","CommonProvider",function(AuditService,CommonProvider){var _audit_model={get:function(params){return CommonProvider.request({method:"get",service:new AuditService,params:params})},item:function(params){return CommonProvider.request({method:"item",service:new AuditService,params:params})},put:function(audit){return CommonProvider.request({method:"put",service:new AuditService(audit.body),params:{role:audit.role,organization_id:audit.organization_id}})}};return _audit_model}]),angular.module("AuthModel",["AuthService"]).factory("AuthModel",["AuthService","CommonProvider","$localStorage",function(AuthService,CommonProvider,$localStorage){var _auth_model={login:function(user){return CommonProvider.request({method:"login",service:new AuthService(user)})},logout:function(user){return CommonProvider.request({method:"logout",service:new AuthService})},register:function(user){return CommonProvider.request({method:"register",service:new AuthService(user)})},forgot:function(user){return CommonProvider.request({method:"forgot",service:new AuthService(user)})},check:function(){return CommonProvider.request({method:"check",service:new AuthService,error:function(err){401==err.status&&(delete $localStorage.user,delete $localStorage.token)}})},menu:function(){return CommonProvider.request({method:"menu",service:new AuthService})},reset:function(password){return CommonProvider.request({method:"reset",service:new AuthService(password)})},getThirds:function(){return CommonProvider.request({method:"getThirds",service:new AuthService})},thirdLogin:function(params){return CommonProvider.request({method:"thirdLogin",service:new AuthService,params:params})},thirdBind:function(params){return CommonProvider.request({method:"thirdBind",service:new AuthService(params.body),params:{type:params.type}})},thirdUnbind:function(params){return CommonProvider.request({method:"thirdUnbind",service:new AuthService,params:params})}};return _auth_model}]),angular.module("BankModel",["BankService"]).factory("BankModel",["BankService","CommonProvider",function(BankService,CommonProvider){var _bank_lists,_bank_model={get:function(params){return CommonProvider.request({method:"get",service:new BankService,params:params,success:function(_banks){_bank_lists=_banks}})},add:function(bank){return CommonProvider.request({method:"save",service:new BankService(bank)})},del:function(params){return CommonProvider.request({method:"del",service:new BankService,params:params})},getInfo:function(params){return CommonProvider.request({method:"getInfo",service:new BankService,params:params})}};return _bank_model}]),angular.module("CategoryModel",["CategoryService"]).factory("CategoryModel",["CategoryService","CommonProvider",function(CategoryService,CommonProvider){var _category_list,_category_model={},_category_service=new CategoryService;return _category_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new CategoryService,params:params,success:function(_lists){_category_list=_lists}})},childrens:function(params){return params.category_id=params.category_id||0,params.children=params.children||1,params.crumbs=params.crumbs||1,CommonProvider.request({method:"getChildrens",service:_category_service,params:params,success:function(_lists){_category_list=_lists}})},add:function(category){return CommonProvider.request({method:"save",service:new CategoryService(category),success:function(_category){_category_model.childrens({category_id:_category_list.result.id})}})},put:function(category){return CommonProvider.request({method:"put",service:new CategoryService(category["new"]),params:{category_id:category["new"].id}})},del:function(category){return CommonProvider.request({method:"del",service:new CategoryService,params:{category_id:category.category.id},success:function(_category){_category_list.result.children.remove(category.category)}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new CategoryService,params:{ids:ids.join(",")},success:function(_category){_category_model.childrens({category_id:_category_list.result.id})}})},disable:function(params){var ids=params.length?params.join(","):params.category.id;return CommonProvider.request({method:"disable",service:new CategoryService({ids:ids}),success:function(_category){params.length?_category_model.childrens({category_id:_category_list.result.id}):params.category.x_status=0}})},enable:function(params){var ids=params.length?params.join(","):params.category.id;return CommonProvider.request({method:"enable",service:new CategoryService({ids:ids}),success:function(_category){params.length?_category_model.childrens({category_id:_category_list.result.id}):params.category.x_status=1}})},sort:function(params){return CommonProvider.request({method:"sort",service:new CategoryService,body:{data:params}})}}}]),angular.module("ChatModel",["ChatService"]).factory("ChatModel",["ChatService","CommonProvider",function(ChatService,CommonProvider){var _chat_model={message:function(params){return CommonProvider.request({method:"get",service:new ChatService,params:params})}};return _chat_model}]),angular.module("CommentModel",["CommentService"]).factory("CommentModel",["CommentService","CommonProvider",function(CommentService,CommonProvider){var _comment_list,_comment_model={};return _comment_model={get:function(config){return config.page=config.page||1,config.per_page=config.per_page||20,CommonProvider.request({method:"get",service:new CommentService,params:config,success:function(_comment_lists){_comment_list=_comment_lists}})},post:function(params){return CommonProvider.request({method:"save",service:new CommentService(params.body),params:{role:params.role}})},del:function(params){return CommonProvider.request({method:"del",service:new CommentService,params:params})}}}]),angular.module("CommonModel",["CommonService"]).factory("CommonModel",["CommonService","CommonProvider",function(CommonService,CommonProvider){return _common_model={sms:function(config){return CommonProvider.request({method:"sms",service:new CommonService,params:config})},area:function(){return CommonProvider.request({method:"area",service:new CommonService})},config:function(params){return CommonProvider.request({method:"config",service:new CommonService,params:params})},configByName:function(params){return CommonProvider.request({method:"configByName",service:new CommonService,params:params})}},_common_model}]),angular.module("ConfigModel",["ConfigService"]).factory("SystemModel",["SystemService","CommonProvider",function(SystemService,CommonProvider){var _system_list,_system_group={},_system_model={},_system_service=new SystemService;return _system_model.get=function(params){return CommonProvider.request({method:"get",service:_system_service,params:params,success:function(config_list){void 0!=params.group?_system_group[params.group]=config_list.result.toObject("name"):_system_list=config_list}})},_system_model.putGroup=function(groups){for(key in groups)"object"==typeof groups[key].value&&(groups[key].value=groups[key].value.toString());return CommonProvider.request({method:"putGroup",service:new SystemService({data:Obj.toArray(groups)})})},_system_model.add=function(config){return CommonProvider.request({method:"save",service:new SystemService(config),success:function(_config){_system_list.result.push(_config.result)}})},_system_model.put=function(config){return CommonProvider.request({method:"putItem",service:new SystemService(config["new"]),params:{config_id:config.old.config.id},success:function(_config){config.old.config=_config.result}})},_system_model.del=function(config){return CommonProvider.request({method:"del",service:new SystemService,params:{config_id:config.config.id},success:function(_config){_system_list.result.remove(config.config)}})},_system_model["delete"]=function(ids){return CommonProvider.request({method:"delete",service:_system_service,params:{ids:ids.join(",")},success:function(_config){_system_model.get({page:_system_list.pagination.current_page})}})},_system_model}]).factory("LogModel",["LogService","CommonProvider",function(LogService,CommonProvider){var _log_list,_log_model={},_log_service=new LogService;return _log_model.get=function(params){return CommonProvider.request({method:"get",params:params,service:_log_service,success:function(logs){_log_list=logs}})},_log_model.del=function(log){var ids=log.length?log.join(","):log.log.id;return CommonProvider.request({method:"delete",service:new LogService,params:{ids:ids},success:function(_log){log.length?_log_model.get({page:_log_list.pagination.current_page}):(_log_list.result.remove(log.log),_log_list.pagination.total-=1)}})},_log_model.clear=function(log){return CommonProvider.request({method:"clear",service:_log_service,success:function(_log){_log_list.result=[],_log_list.pagination.total=0}})},_log_model}]),angular.module("CourseModel",["CourseService"]).factory("CourseModel",["CourseService","CommonProvider",function(CourseService,CommonProvider){var _course_list,_course={},_course_model={},_course_service=new CourseService;return _course_model={getUsersInfo:function(params){return CommonProvider.request({method:"getUsersInfo",service:new CourseService({user_ids:params.user_ids})})},get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new CourseService,params:params,success:function(_course_lists){_course_list=_course_lists}})},item:function(params){return CommonProvider.request({method:"item",service:_course_service,params:params,success:function(_course_item){_course.info=_course_item}})},put:function(course){return CommonProvider.request({method:"put",service:new CourseService(course["new"]),params:{course_id:course["new"].id},success:function(_course){return _course}})},add:function(course){return CommonProvider.request({method:"save",service:new CourseService(course),success:function(_course){return _course}})},del:function(course){return CommonProvider.request({method:"del",service:new CourseService,params:{course_id:course.course.id},success:function(_course){_course_list.result.remove(course.course),_course_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new CourseService,params:{ids:ids.join(",")},success:function(_course){_course_model.get({page:_course_list.pagination.current_page})}})},disable:function(params){var ids=params.length?params.join(","):params.course.id;return CommonProvider.request({method:"disable",service:new CourseService({ids:ids}),success:function(_course){params.length?_course_model.get({page:_course_list.pagination.current_page}):params.course.x_status=0}})},enable:function(params){var ids=params.length?params.join(","):params.course.id;return CommonProvider.request({method:"enable",service:new CourseService({ids:ids}),success:function(_course){params.length?_course_model.get({page:_course_list.pagination.current_page}):params.course.x_status=1}})},relation:function(course_id){return CommonProvider.request({method:"relation",service:new CourseService,params:{course_id:course_id},success:function(_relation){_course.relation=_relation}})},others:function(params){return CommonProvider.request({method:"others",service:new CourseService,params:params,success:function(_others){_course.others=_others}})},classmates:function(params){return CommonProvider.request({method:"classmates",service:new CourseService,params:params,success:function(_classmates){_course.classmates=_classmates}})},operation:function(params){return CommonProvider.request({method:"operation",service:new CourseService,params:{method:params.method,course_id:params.course_id}})}}}]),angular.module("FavoriteModel",["FavoriteService"]).factory("FavoriteModel",["FavoriteService","CommonProvider",function(FavoriteService,CommonProvider){var _favorite_lists,_favorite_model={get:function(params){return CommonProvider.request({method:"get",service:new FavoriteService,params:params,success:function(_favorites){_favorite_lists=_favorites}})},getStatus:function(params){return CommonProvider.request({method:"getStatus",service:new FavoriteService,params:params})},add:function(config){return CommonProvider.request({method:"save",service:new FavoriteService,params:config})},del:function(params){return CommonProvider.request({method:"remove",service:new FavoriteService,params:params,success:function(){_favorite_lists.pagination.total-=1}})}};return _favorite_model}]),angular.module("FeedbackModel",["FeedbackService"]).factory("FeedbackModel",["FeedbackService","CommonProvider",function(FeedbackService,CommonProvider){var _feedback_list,_feedback_model={get:function(params){return CommonProvider.request({method:"get",service:new FeedbackService,params:params,success:function(feedback_list){_feedback_list=feedback_list}})},item:function(feedback){return CommonProvider.request({method:"item",service:new FeedbackService,params:feedback})},add:function(feedback){return CommonProvider.request({method:"save",service:new FeedbackService(feedback)})},put:function(feedback){return CommonProvider.request({method:"put",service:new FeedbackService(feedback),params:{feedback_id:feedback.id}})},del:function(feedback){return CommonProvider.request({method:"del",service:new FeedbackService,params:{feedback_id:feedback.feedback.id},success:function(_feedback){_feedback_list.result.remove(feedback.feedback),_feedback_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new FeedbackService,params:{ids:ids.join(",")},success:function(_feedback){_feedback_model.get({page:_feedback_list.pagination.current_page})}})}};return _feedback_model}]),angular.module("IndexModel",["IndexService"]).factory("IndexModel",["IndexService","CommonProvider",function(IndexService,CommonProvider){return _index_model={get:function(params){return CommonProvider.request({method:"get",service:new IndexService,params:params})},partners:function(params){return CommonProvider.request({method:"partners",service:new IndexService,params:params})},put:function(config){return console.log(config),CommonProvider.request({method:"put",service:new IndexService(config),params:{config_id:config.id},success:function(_config){}})}},_index_model}]),angular.module("LinkModel",["LinkService"]).factory("LinkModel",["LinkService","CommonProvider",function(LinkService,CommonProvider){var _link_list,_link_model={get:function(params){return CommonProvider.request({method:"get",service:new LinkService,params:params,success:function(_links){_link_list=_links}})},add:function(link){return CommonProvider.request({method:"save",service:new LinkService(link),success:function(_link){_link_list.result.unshift(_link.result),_link_list.pagination.total+=1}})},put:function(link){return CommonProvider.request({method:"put",service:new LinkService(link),params:{link_id:link.id}})},del:function(link){return CommonProvider.request({method:"del",service:new LinkService,params:{link_id:link.link.id},success:function(_link){_link_list.result.remove(link.link),_link_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new LinkService,params:{ids:ids.join(",")},success:function(_link){_link_model.get({page:_link_list.pagination.current_page})}})}};return _link_model}]),angular.module("MsgModel",["MsgService"]).factory("MsgModel",["MsgService","CommonProvider",function(MsgService,CommonProvider){var _msg_model={get:function(params){return CommonProvider.request({method:"get",service:new MsgService,params:params})},batch:function(params){return CommonProvider.request({method:"batch",service:new MsgService,params:params})}};return _msg_model}]),angular.module("NoteModel",["NoteService"]).factory("NoteModel",["NoteService","CommonProvider",function(NoteService,CommonProvider){var _note_list,_note_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new NoteService,params:params,success:function(note_list){_note_list=note_list}})},post:function(note){return CommonProvider.request({method:"save",service:new NoteService(note)})},del:function(note){return CommonProvider.request({method:"del",service:new NoteService,params:{note_id:note.note.id},success:function(_note){_note_list.result.remove(note.note),_note_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new NoteService,params:{ids:ids.join(",")},success:function(_note){_note_model.get({page:_note_list.pagination.current_page})}})},item:function(note){return CommonProvider.request({method:"item",service:new NoteService,params:note})},put:function(note){return CommonProvider.request({method:"put",service:new NoteService(note.body),params:{note_id:note.id}})}};return _note_model}]),angular.module("OrganizationModel",["OrganizationService"]).factory("OrganizationModel",["OrganizationService","CommonProvider",function(OrganizationService,CommonProvider){var _organization_list,_organization_relation,_organization_model={};return _organization_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new OrganizationService,params:params,success:function(_organization_lists){_organization_list=_organization_lists}})},relation:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"relation",service:new OrganizationService,params:params,success:function(_organization_relations){_organization_relation=_organization_relations}})},itemRelation:function(params){return CommonProvider.request({method:"itemRelation",service:new OrganizationService(params),params:params})},putRelation:function(relation){return CommonProvider.request({method:"putRelation",service:new OrganizationService(relation.body),params:{role:relation.role,relation_id:relation.id,organization_role:relation.organization_role}})},addRelation:function(relation){return CommonProvider.request({method:"addRelation",service:new OrganizationService(relation.body),params:{type:relation.type}})},delRelation:function(relation){return CommonProvider.request({method:"delRelation",service:new OrganizationService,params:relation,success:function(_relation){_organization_relation.result.remove(relation),_organization_relation.pagination.total-=1}})},item:function(params){return CommonProvider.request({method:"item",service:new OrganizationService,params:params,success:function(_organization_item){return _organization_item}})},getProfile:function(params){return CommonProvider.request({method:"getProfile",service:new OrganizationService(params),params:params})},putProfile:function(params){return CommonProvider.request({method:"putProfile",service:new OrganizationService(params.body),params:{role:params.role,organization_id:params.organization_id}})},add:function(organization){return CommonProvider.request({method:"save",service:new OrganizationService(organization),success:function(_organization){return _organization}})},put:function(organization){return CommonProvider.request({method:"put",service:new OrganizationService(organization["new"]),params:{role:organization.role||"user",organization_id:organization["new"].id},success:function(_organization){void 0!=organization.old&&(_organization_list.result[organization.old.$parent.$index]=_organization.result)}})},del:function(organization){return CommonProvider.request({method:"del",service:new OrganizationService,params:{organization_id:organization.organization.id},success:function(_organization){_organization_list.result.remove(organization.organization),_organization_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new OrganizationService,params:{ids:ids.join(",")},success:function(_organization){_organization_model.get({page:_organization_list.pagination.current_page})}})}}}]),angular.module("PartnerModel",["PartnerService"]).factory("PartnerModel",["PartnerService","CommonProvider",function(PartnerService,CommonProvider){var _partner_lists,_partner_model={get:function(params){return CommonProvider.request({method:"get",service:new PartnerService,params:params,success:function(_partners){_partner_lists=_partners}})},add:function(partner){return CommonProvider.request({method:"save",service:new PartnerService(partner)})},del:function(params){return CommonProvider.request({method:"remove",service:new PartnerService,params:params,success:function(){_partner_lists.pagination.total-=1}})}};return _partner_model}]),angular.module("PaymentModel",["PaymentService"]).factory("PaymentModel",["PaymentService","CommonProvider",function(PaymentService,CommonProvider){var _payment_list,_payment={},_payment_service=new PaymentService;return _payment_model={pay:function(config){return CommonProvider.request({method:"pay",service:new PaymentService({course_ids:config.course_ids})})},getPayStatus:function(config){return CommonProvider.request({method:"getStatus",service:_payment_service,params:config})},payment:function(config){return CommonProvider.request({method:"payment",service:new PaymentService(config.body),params:{payment_id:config.payment_id}})},get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new PaymentService,params:params,success:function(_payment_lists){_payment_list=_payment_lists}})},item:function(params){return CommonProvider.request({method:"item",service:new PaymentService,params:params,success:function(_payment_item){_payment.info=_payment_item}})},del:function(payment){return CommonProvider.request({method:"del",service:new PaymentService,params:{payment_id:payment.payment.id},success:function(_payment){_payment_list.result.remove(payment.payment),_payment_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new PaymentService,params:{ids:ids.join(",")},success:function(_payment){_payment_model.get({page:_payment_list.pagination.current_page})}})}},_payment_model}]),angular.module("PublicModel",["PublicService"]).factory("PublicModel",["PublicService","CommonProvider",function(PublicService,CommonProvider){var _public_model={clearcache:function(params){return CommonProvider.request({method:"clearcache",service:new PublicService,params:params})},get:function(params){return CommonProvider.request({method:"get",service:new PublicService,params:params,success:function(_publics){
_public_lists=_publics}})}};return _public_model}]),angular.module("QuestionModel",["QuestionService"]).factory("QuestionModel",["QuestionService","CommonProvider",function(QuestionService,CommonProvider){var _question_model={get:function(params){return CommonProvider.request({method:"get",service:new QuestionService,params:params})},post:function(question){return CommonProvider.request({method:"save",service:new QuestionService(question)})},del:function(params){return CommonProvider.request({method:"del",service:new QuestionService,params:params,success:function(_question){}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new QuestionService,params:{ids:ids.join(",")},success:function(_question){_question_model.get({page:_question_list.pagination.current_page})}})},item:function(question){return CommonProvider.request({method:"item",service:new QuestionService,params:question})},put:function(question){return CommonProvider.request({method:"put",service:new QuestionService(question.body),params:{question_id:question.id}})}};return _question_model}]),angular.module("ScoreModel",["ScoreService"]).factory("ScoreModel",["ScoreService","CommonProvider",function(ScoreService,CommonProvider){var _score_model={get:function(params){return CommonProvider.request({method:"get",service:new ScoreService,params:params})},getLevels:function(params){return CommonProvider.request({method:"getLevels",service:new ScoreService,params:params})},getRules:function(params){return CommonProvider.request({method:"getRules",service:new ScoreService,params:params})}};return _score_model}]),angular.module("SearchModel",["SearchService"]).factory("SearchModel",["SearchService","CommonProvider",function(SearchService,CommonProvider){var _search_model={get:function(params){return CommonProvider.request({method:"get",service:new SearchService,params:params})},getHotWords:function(params){return CommonProvider.request({method:"getHotWords",service:new SearchService,params:params})},putHotWords:function(hot_words){return CommonProvider.request({method:"putHotWords",service:new SearchService(hot_words)})},searchInit:function(params){return CommonProvider.request({method:"searchInit",service:new SearchService,params:{type:params.type}})},searchClean:function(params){return CommonProvider.request({method:"searchClean",service:new SearchService,params:{type:params.type}})}};return _search_model}]),angular.module("SectionModel",["SectionService"]).factory("SectionModel",["SectionService","CommonProvider",function(SectionService,CommonProvider){var _section_list,_section_item,_section_model={};return _section_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new SectionService,params:params,success:function(_section_lists){_section_list=_section_lists}})},add:function(section){return CommonProvider.request({method:"save",service:new SectionService(section)})},put:function(section){return CommonProvider.request({method:"put",service:new SectionService(section),params:{section_id:section.id,role:section.role}})},del:function(params){return CommonProvider.request({method:"del",service:new SectionService,params:params})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new SectionService,params:{ids:ids.join(",")}})},item:function(params){return CommonProvider.request({method:"item",service:new SectionService,params:params,success:function(section_item){_section_item=section_item.result}})},sort:function(sorts){return CommonProvider.request({method:"update",service:new SectionService,body:{data:sorts}})},postStudyRecord:function(params){return CommonProvider.request({method:"postStudyRecord",service:new SectionService,params:params})},getVideos:function(params){return CommonProvider.request({method:"getVideos",service:new SectionService,params:params})},getQuestions:function(params){return CommonProvider.request({method:"getQuestions",service:new SectionService,params:params})},initLiveSection:function(params){return CommonProvider.request({method:"initLiveSection",service:new SectionService,params:params})},closeLiveSection:function(params){return CommonProvider.request({method:"closeLiveSection",service:new SectionService,params:params})},getLiveUpstream:function(params){return CommonProvider.request({method:"getLiveUpstream",service:new SectionService,params:params})}}}]),angular.module("SmsModel",["SmsService"]).factory("SmsModel",["SmsService","CommonProvider",function(SmsService,CommonProvider){var _sms_list,_sms_item,_sms_model={};return _sms_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new SmsService,params:params,success:function(sms_lists){_sms_list=sms_lists}})},item:function(params){return CommonProvider.request({method:"item",service:new SmsService,params:params,success:function(sms_item){_sms_item=sms_item}})},del:function(sms){return CommonProvider.request({method:"del",service:new SmsService,params:{sms_id:sms.id},success:function(_sms){_sms_list.result.remove(sms),_sms_list.pagination.total-=1}})}}}]),angular.module("StudentModel",["StudentService"]).factory("StudentModel",["StudentService","CommonProvider",function(StudentService,CommonProvider){var _student_model={get:function(params){return CommonProvider.request({method:"get",service:new StudentService,params:params})},put:function(user){return CommonProvider.request({method:"put",service:new StudentService(user)})}};return _student_model}]),angular.module("TeacherModel",["TeacherService"]).factory("TeacherModel",["TeacherService","CommonProvider",function(TeacherService,CommonProvider){var _teacher_model={get:function(params){return CommonProvider.request({method:"get",service:new TeacherService,params:params})},incomeDetail:function(params){return CommonProvider.request({method:"incomeDetail",service:new TeacherService,params:params})},incomeDaily:function(params){return CommonProvider.request({method:"incomeDaily",service:new TeacherService,params:params})}};return _teacher_model}]),angular.module("TradeModel",["TradeService"]).factory("TradeModel",["TradeService","CommonProvider",function(TradeService,CommonProvider){var _trade_list,_trade_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new TradeService,params:params,success:function(_trade_list){_trade_list=_trade_list}})},item:function(params){return CommonProvider.request({method:"item",service:new TradeService,params:params,success:function(_trade_item){return _trade_item}})},cancel:function(trade){return CommonProvider.request({method:"cancel",service:new TradeService,params:trade,success:function(_trade){}})},del:function(trade){return CommonProvider.request({method:"del",service:new TradeService,params:{trade_id:trade.trade.id},success:function(_trade){_trade_list.result.remove(trade.trade),_trade_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new TradeService,params:{ids:ids.join(",")},success:function(_trade){_trade_model.get({page:_trade_list.pagination.current_page})}})}};return _trade_model}]),angular.module("UserModel",["UserService"]).factory("UserModel",["UserService","CommonProvider",function(UserService,CommonProvider){var _user,_user_list,_user_service=new UserService,_user_model={get:function(params){return CommonProvider.request({method:"get",service:_user_service,params:params,success:function(_user_lists){_user_list=_user_lists}})},item:function(params){return CommonProvider.request({method:"item",service:new UserService,params:params,success:function(user){_user=user}})},add:function(user){return CommonProvider.request({method:"save",service:new UserService(user),success:function(_user){_user_list.result.unshift(_user.result),_user_list.pagination.total+=1}})},del:function(user){return CommonProvider.request({method:"del",service:new UserService,params:{user_id:user.user.id},success:function(_user){_user_list.result.remove(user.user),_user_list.pagination.total-=1}})},put:function(user){return CommonProvider.request({method:"put",service:new UserService(user["new"]),params:{user_id:user["new"].id},success:function(_user){var roles=angular.copy(user.old.user.roles);_user_list.result[user.old.$parent.$index]=_user.result,_user_list.result[user.old.$parent.$index].roles=roles}})},disable:function(params){var ids=params.length?params.join(","):params.user.id;return CommonProvider.request({method:"disable",service:new UserService({ids:ids}),success:function(_user){params.length?_user_model.get({page:_user_list.pagination.current_page}):params.user.x_status=0}})},enable:function(params){var ids=params.length?params.join(","):params.user.id;return CommonProvider.request({method:"enable",service:new UserService({ids:ids}),success:function(_user){params.length?_user_model.get({page:_user_list.pagination.current_page}):params.user.x_status=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new UserService,params:{ids:ids.join(",")},success:function(_user){_user_model.get({page:_user_list.pagination.current_page})}})},role:function(params){return CommonProvider.request({method:"role",service:new UserService({ids:params.ids.join(",")}),params:{user_id:params.add?params.user.id:params.user.user.id},success:function(_user){params.add?_user_list.result[0].roles=_user.result.roles:_user_list.result[params.user.$parent.$index].roles=_user.result.roles}})}};return _user_model}]).factory("RoleModel",["RoleService","CommonProvider",function(RoleService,CommonProvider){var _role_item,_role_list,_role_model={},_role_service=new RoleService;return _role_model.get=function(config){var get_config={page:config?config.page:1,per_page:config?config.per_page:20};return CommonProvider.request({method:"get",service:_role_service,params:get_config,success:function(roles){_role_list=roles}})},_role_model.add=function(role){return CommonProvider.request({method:"save",service:new RoleService(role),success:function(_role){_role_list.result.unshift(_role.result),_role_list.pagination.total+=1}})},_role_model.del=function(role){return CommonProvider.request({method:"del",service:new RoleService,params:{role_id:role.role.id},success:function(_role){_role_list.result.splice(role.$index,1),_role_list.pagination.total-=1}})},_role_model.put=function(role){return CommonProvider.request({method:"put",service:new RoleService(role["new"]),params:{role_id:role["new"].id},success:function(_role){role.old.role=_role.result}})},_role_model["delete"]=function(ids){return CommonProvider.request({method:"delete",service:new RoleService,params:{ids:ids.join(",")},success:function(_user){_role_model.get({page:_role_list.pagination.current_page})}})},_role_model.disable=function(params){var ids=params.length?params.join(","):params.role.id;return CommonProvider.request({method:"disable",service:new RoleService({ids:ids}),success:function(_role){params.length?_role_model.get({page:_role_list.pagination.current_page}):params.role.x_status=0}})},_role_model.enable=function(params){var ids=params.length?params.join(","):params.role.id;return CommonProvider.request({method:"enable",service:new RoleService({ids:ids}),success:function(_role){params.length?_role_model.get({page:_role_list.pagination.current_page}):params.role.x_status=1}})},_role_model.permission=function(role){return CommonProvider.request({method:"permission",service:new RoleService({ids:role.ids.join(",")}),params:{role_id:role.id}})},_role_model.getRole=function(role_id){return CommonProvider.request({method:"getRole",service:_role_service,params:{role_id:role_id},success:function(_role){_role_item=_role.result}})},_role_model}]).factory("PermissionModel",["PermissionService","CommonProvider",function(PermissionService,CommonProvider){var _permission_item,_permission_list,_permission_model={},_permission_service=new PermissionService;return _permission_model.get=function(){return CommonProvider.request({method:"get",service:_permission_service,success:function(permission_list){_permission_list=permission_list.result}})},_permission_model.add=function(permission){permission.type=Number(permission.type)||0;var root_index=permission.belong.root?Number(permission.belong.root.index):0,node_index=permission.belong.node?Number(permission.belong.node.index):0,page_index=permission.belong.page?Number(permission.belong.page.index):0,add_menu=function(_permission){_permission_list.push(_permission)},add_node=function(_permission){_permission_list[root_index].children?_permission_list[root_index].children.push(_permission):(_permission_list[root_index].children=[],_permission_list[root_index].children.push(_permission))},add_page=function(_permission){_permission_list[root_index]&&_permission_list[root_index].children[node_index]&&(_permission_list[root_index].children[node_index].children?_permission_list[root_index].children[node_index].children.push(_permission):(_permission_list[root_index].children[node_index].children=[],_permission_list[root_index].children[node_index].children.push(_permission)))},add_func=function(_permission){_permission_list[root_index]&&_permission_list[root_index].children[node_index]&&_permission_list[root_index].children[node_index].children[page_index]&&(_permission_list[root_index].children[node_index].children[page_index].children?_permission_list[root_index].children[node_index].children[page_index].children.push(_permission):(_permission_list[root_index].children[node_index].children[page_index].children=[],_permission_list[root_index].children[node_index].children[page_index].children.push(_permission)))},add_check=function(){switch(permission.type){case 1:permission.pid=0;break;case 2:permission.pid=permission.belong.root.id;break;case 3:permission.pid=permission.belong.node.id;break;case 4:permission.pid=permission.belong.page.id;break;default:console.log("类型参数不正确")}};return add_check(),CommonProvider.request({method:"save",service:new PermissionService(permission),success:function(_permission){switch(_permission.result.x_status=_permission.x_status||1,permission.type){case 1:add_menu(_permission.result);break;case 2:add_node(_permission.result);break;case 3:add_page(_permission.result);break;case 4:add_func(_permission.result);break;default:console.log("类型参数不正确")}}})},_permission_model.del=function(permission){return CommonProvider.request({method:"del",service:new PermissionService,params:{permission_id:permission.permission.id},success:function(_permission){1==permission.permission.type?_permission_list.splice(permission.$index,1):permission.$parent.$parent.permission.children.splice(permission.$index,1)}})},_permission_model.put=function(permission){return CommonProvider.request({method:"put",service:new PermissionService(permission["new"]),params:{permission_id:permission["new"].id},success:function(_permission){permission.old.permission=permission["new"]}})},_permission_model.disable=function(params){var ids=params.length?params.join(","):params.permission.id;return CommonProvider.request({method:"disable",service:new PermissionService({ids:ids}),success:function(_permission){params.length?_permission_model.get():params.permission.x_status=0}})},_permission_model.enable=function(params){var ids=params.length?params.join(","):params.permission.id;return CommonProvider.request({method:"enable",service:new PermissionService({ids:ids}),success:function(_permission){params.length?_permission_model.get():params.permission.x_status=1}})},_permission_model["delete"]=function(ids){return CommonProvider.request({method:"delete",service:new PermissionService,params:{ids:ids.join(",")},success:function(_permission){_permission_model.get()}})},_permission_model.item=function(id){return CommonProvider.request({method:"item",service:new PermissionService,params:{permission_id:id},success:function(_permission){_permission_item=_permission.result}})},_permission_model.api=function(params){return CommonProvider.request({method:"api",service:new PermissionService({ids:params.ids.join(",")}),params:{permission_id:params.id}})},_permission_model.sort=function(sorts){return CommonProvider.request({method:"sort",service:new PermissionService,body:{data:sorts}})},_permission_model}]).factory("GrantApiModel",["GrantApiService","CommonProvider",function(GrantApiService,CommonProvider){var _api_list,_api_model={},_api_service=new GrantApiService;return _api_model.get=function(params){return CommonProvider.request({method:"get",params:params,service:_api_service,success:function(apis){_api_list=apis}})},_api_model.add=function(api){return CommonProvider.request({method:"save",service:new GrantApiService(api),success:function(_api){_api_list.result.unshift(_api.result),_api_list.pagination.total+=1}})},_api_model.del=function(api){return CommonProvider.request({method:"del",service:new GrantApiService,params:{api_id:api.api.id},success:function(_api){_api_list.result.splice(api.$index,1),_api_list.pagination.total-=1}})},_api_model.put=function(api){return CommonProvider.request({method:"put",service:new GrantApiService(api["new"]),params:{api_id:api["new"].id},success:function(_api){api.old.api=_api.result}})},_api_model["delete"]=function(ids){return CommonProvider.request({method:"delete",service:new GrantApiService,params:{ids:ids.join(",")},success:function(_user){_api_model.get({page:_api_list.pagination.current_page})}})},_api_model}]),angular.module("WithdrawModel",["WithdrawService"]).factory("WithdrawModel",["WithdrawService","CommonProvider",function(WithdrawService,CommonProvider){var _withdraw_list,_withdraw_model={get:function(params){return params.page=params.page||1,params.per_page=params.per_page||20,CommonProvider.request({method:"get",service:new WithdrawService,params:params,success:function(_withdraw_lists){_withdraw_list=_withdraw_lists}})},apply:function(bill){return CommonProvider.request({method:"save",service:new WithdrawService(bill)})},item:function(params){return CommonProvider.request({method:"item",service:new WithdrawService,params:params,success:function(_withdraw_item){return _withdraw_item}})},cancel:function(withdraw){return CommonProvider.request({method:"cancel",service:new WithdrawService,params:withdraw,success:function(_withdraw){}})},put:function(withdraw){return CommonProvider.request({method:"put",service:new WithdrawService(withdraw.body),params:{withdraw_id:withdraw.id}})},del:function(withdraw){return CommonProvider.request({method:"del",service:new WithdrawService,params:{withdraw_id:withdraw.withdraw.id},success:function(_withdraw){_withdraw_list.result.remove(withdraw.withdraw),_withdraw_list.pagination.total-=1}})},"delete":function(ids){return CommonProvider.request({method:"delete",service:new WithdrawService,params:{ids:ids.join(",")},success:function(_withdraw){_withdraw_model.get({page:_withdraw_list.pagination.current_page})}})}};return _withdraw_model}]),angular.module("AppRoutes",["ui.router.stateHelper"]).config(["$stateProvider","$urlRouterProvider","stateHelperProvider","$httpProvider","$locationProvider",function($stateProvider,$urlRouterProvider,stateHelperProvider,$httpProvider,$locationProvider){$urlRouterProvider.otherwise("/index"),stateHelperProvider.state({name:"index",url:"/index",templateUrl:"partials/admin/index/index.html",controller:"IndexController",data:{title:"首页",url:"/index",slug:"index"},children:[{"abstract":!0,name:"action",url:"/action",template:'<div ui-view class="view-box slide-top"></div>',controller:"IndexController",data:{title:"常用操作",url:"/index/action",slug:"action"},children:[{name:"dashboard",url:"/dashboard",templateUrl:"partials/admin/index/dashboard.html",controller:"IndexController",data:{title:"快速开始",url:"/index/action/dashboard",slug:"dashboard"}},{name:"clearcache",url:"/clearcache",templateUrl:"partials/admin/index/clearcache.html",controller:"IndexController",data:{title:"缓存清理",url:"/index/action/clearcache",slug:"clearcache"}}]}]}).state({name:"course",url:"/course",templateUrl:"partials/admin/course/index.html",controller:"CourseController",data:{title:"课程",slug:"course"},children:[{"abstract":!0,name:"manage",url:"/manage",template:'<div ui-view class="view-box slide-top"></div>',controller:"CourseController",data:{title:"课程管理",slug:"manage"},children:[{"abstract":!0,name:"list",url:"/list",template:'<div ui-view class="view-box slide-top"></div>',controller:"CourseController",data:{title:"课程列表",slug:"list"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/course/manage/list.html",controller:"CourseController",data:{title:"课程列表",slug:"list"}},{name:"edit",url:"/:course_id",templateUrl:"partials/admin/course/manage/edit.html",controller:"CourseController",data:{title:"课程编辑",slug:"list",name:"course.manage.list.index"}},{name:"section",url:"/section/:course_id",templateUrl:"partials/admin/course/manage/section/list.html",controller:"CourseController",data:{title:"课程章节",slug:"list",name:"course.manage.list.index"}}]},{"abstract":!0,name:"category",url:"/category",template:'<div ui-view class="view-box slide-top"></div>',controller:"CategoryController",data:{title:"课程分类",slug:"category"},children:[{name:"list",url:"/list/:category_type/:category_id",templateUrl:"partials/admin/category/manage/list.html",controller:"CategoryController",data:{title:"课程分类",slug:"list",name:"course.manage.category.index"}},{name:"add",url:"/add",templateUrl:"partials/admin/category/manage/add.html",controller:"CategoryController",data:{title:"新增分类",slug:"list",name:"course.manage.category.index"}},{name:"edit",url:"/edit",templateUrl:"partials/admin/category/manage/edit.html",controller:"CategoryController",data:{title:"编辑分类",slug:"list",name:"course.manage.category.index"}}]},{"abstract":!0,name:"section",url:"/section",template:'<div ui-view class="view-box slide-top"></div>',controller:"SectionController",data:{title:"章节列表",slug:"section"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/course/manage/section/index.html",controller:"SectionController",data:{title:"章节列表",slug:"index",name:"course.manage.section.index"}}]}]}]}).state({name:"trade",url:"/trade",templateUrl:"partials/admin/trade/index.html",controller:"TradeController",data:{title:"订单",slug:"trade"},children:[{"abstract":!0,name:"manage",url:"/manage",template:'<div ui-view class="view-box slide-top"></div>',controller:"TradeController",data:{title:"订单管理",slug:"manage"},children:[{"abstract":!0,name:"list",url:"/list",template:'<div ui-view class="view-box slide-top"></div>',controller:"TradeController",data:{title:"订单管理",slug:"list"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/trade/manage/list.html",controller:"TradeController",data:{title:"订单列表",slug:"list"}},{name:"item",url:"/:trade_id",templateUrl:"partials/admin/trade/manage/item.html",controller:"TradeController",data:{title:"订单详情",slug:"list",name:"trade.manage.list.index"}}]},{"abstract":!0,name:"payment",url:"/payment",template:'<div ui-view class="view-box slide-top"></div>',controller:"PaymentController",data:{title:"收款单",slug:"list"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/trade/payment/list.html",controller:"PaymentController",data:{title:"收款单管理",slug:"list"}},{name:"item",url:"/:payment_id",templateUrl:"partials/admin/trade/payment/item.html",controller:"PaymentController",data:{title:"收款单详情",slug:"list",name:"trade.manage.payment.list"}}]}]},{"abstract":!0,name:"withdraw",url:"/withdraw",template:'<div ui-view class="view-box slide-top"></div>',controller:"TradeController",data:{title:"订单管理",slug:"withdraw"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/trade/withdraw/list.html",controller:"WithdrawController",data:{title:"提现列表",slug:"list"}}]}]}).state({name:"organization",url:"/organization",templateUrl:"partials/admin/organization/index.html",controller:"OrganizationController",data:{title:"学校",slug:"organization"},children:[{"abstract":!0,name:"manage",url:"/manage",template:'<div ui-view class="view-box slide-top"></div>',controller:"OrganizationController",data:{title:"学校管理",slug:"manage"},children:[{"abstract":!0,name:"list",url:"/list",template:'<div ui-view class="view-box slide-top"></div>',controller:"OrganizationController",data:{title:"学校管理",slug:"list"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/organization/manage/list.html",controller:"OrganizationController",data:{title:"学校列表",slug:"list"}},{name:"add",url:"/add",templateUrl:"partials/admin/organization/manage/add.html",controller:"OrganizationController",data:{title:"新增学校",slug:"list",name:"organization.manage.list.index"}},{name:"edit",url:"/:organization_id",templateUrl:"partials/admin/organization/manage/edit.html",controller:"OrganizationController",data:{title:"编辑学校",slug:"list",name:"organization.manage.list.index"}}]},{"abstract":!0,name:"category",url:"/category",template:'<div ui-view class="view-box slide-top"></div>',controller:"CategoryController",data:{title:"学校分类",slug:"category"},children:[{name:"list",url:"/list/:category_type/:category_id",templateUrl:"partials/admin/category/manage/list.html",controller:"CategoryController",data:{title:"学校分类",slug:"list",name:"course.manage.category.index"}},{name:"add",url:"/add",templateUrl:"partials/admin/category/manage/add.html",controller:"CategoryController",data:{title:"新增分类",slug:"list",name:"course.manage.category.index"}},{name:"edit",url:"/edit",templateUrl:"partials/admin/category/manage/edit.html",controller:"CategoryController",data:{title:"编辑分类",slug:"list",name:"course.manage.category.index"}}]},{"abstract":!0,name:"audit",url:"/audit",template:'<div ui-view class="view-box slide-top"></div>',controller:"AuditController",data:{title:"机构资质",slug:"audit"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/organization/audit/list.html",controller:"AuditController",data:{title:"机构资质列表",slug:"list",name:"organization.manage.audit.list"}},{name:"edit",url:"/:organization_id",templateUrl:"partials/admin/organization/audit/edit.html",controller:"AuditController",data:{title:"机构资质详情",slug:"list",name:"organization.manage.audit.list"}}]},{"abstract":!0,name:"organization_user",url:"/organization_user",template:'<div ui-view class="view-box slide-top"></div>',controller:"OrganizationController",data:{title:"老师列表",slug:"organization_user"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/organization/organization_user/list.html",controller:"OrganizationController",data:{title:"老师列表",slug:"list",name:"organization.manage.organization_user.list"}},{name:"item",url:"/:organization_user_id",templateUrl:"partials/admin/organization/organization_user/item.html",controller:"OrganizationController",data:{title:"老师详情",slug:"list",name:"organization.manage.organization_user.list"}}]},{"abstract":!0,name:"announcement",url:"/announcement",template:'<div ui-view class="view-box slide-top"></div>',controller:"AnnouncementController",data:{title:"公告列表",slug:"announcement"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/organization/announcement/list.html",controller:"AnnouncementController",data:{title:"公告列表",slug:"list",name:"organization.manage.announcement.list"}},{name:"edit",url:"/:announcement_id",templateUrl:"partials/admin/organization/announcement/edit.html",controller:"AnnouncementController",data:{title:"编辑公告",slug:"list",name:"organization.manage.announcement.list"}},{name:"item",url:"/:announcement_id",templateUrl:"partials/admin/organization/announcement/item.html",controller:"AnnouncementController",data:{title:"公告详情",slug:"list",name:"organization.manage.announcement.list"}}]}]}]}).state({name:"article",url:"/article",templateUrl:"partials/admin/article/index.html",controller:"ArticleController",data:{title:"内容",slug:"article"},children:[{"abstract":!0,name:"manage",url:"/manage",template:'<div ui-view class="view-box slide-top"></div>',controller:"ArticleController",data:{title:"内容管理",slug:"manage"},children:[{"abstract":!0,name:"list",url:"/list",template:'<div ui-view class="view-box slide-top"></div>',controller:"ArticleController",data:{title:"文章管理",slug:"list"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/article/manage/list.html",controller:"ArticleController",data:{title:"文章列表",slug:"index"}},{name:"add",url:"/add",templateUrl:"partials/admin/article/manage/add.html",controller:"ArticleController",data:{title:"新增文章",slug:"list",name:"article.manage.list.index"}},{name:"edit",url:"/:article_id",templateUrl:"partials/admin/article/manage/edit.html",controller:"ArticleController",data:{title:"编辑文章",slug:"list",name:"article.manage.list.index"}}]},{"abstract":!0,name:"category",url:"/category",template:'<div ui-view class="view-box slide-top"></div>',controller:"CategoryController",data:{title:"文章分类",slug:"category"},children:[{name:"list",url:"/list/:category_type/:category_id",templateUrl:"partials/admin/category/manage/list.html",controller:"CategoryController",data:{title:"文章分类",slug:"list",name:"article.manage.category.index"}},{name:"add",url:"/add",templateUrl:"partials/admin/category/manage/add.html",controller:"CategoryController",data:{title:"新增分类",slug:"list",name:"article.manage.category.index"}},{name:"edit",url:"/edit",templateUrl:"partials/admin/category/manage/edit.html",controller:"CategoryController",data:{title:"编辑分类",slug:"list",name:"article.manage.category.index"}}]}]},{"abstract":!0,name:"note",url:"/note",template:'<div ui-view class="view-box slide-top"></div>',controller:"NoteController",data:{title:"笔记管理",slug:"note"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/article/note/list.html",controller:"NoteController",data:{title:"笔记列表",slug:"note",name:"article.manage.note.list"}},{name:"item",url:"/item",templateUrl:"partials/admin/article/note/item.html",controller:"NoteController",data:{title:"笔记详情",slug:"note",name:"article.manage.note.item"}}]},{"abstract":!0,name:"question",url:"/question",template:'<div ui-view class="view-box slide-top"></div>',controller:"QuestionController",data:{title:"问答管理",slug:"question"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/article/question/list.html",controller:"QuestionController",data:{title:"问答列表",slug:"question",name:"article.question.list"}},{name:"item",url:"/:article_id",templateUrl:"partials/admin/article/question/item.html",controller:"QuestionController",data:{title:"问答详情",slug:"index",name:"article.question.item"}}]},{"abstract":!0,name:"advertise",url:"/advertise",template:'<div ui-view class="view-box slide-top"></div>',controller:"ArticleController",data:{title:"内容管理",slug:"advertise"},children:[{"abstract":!0,name:"list",url:"/list",template:'<div ui-view class="view-box slide-top"></div>',controller:"ArticleController",data:{title:"广告管理",slug:"list"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/article/advertise/list.html",controller:"AdvertiseController",data:{title:"广告列表",slug:"index"}},{name:"add",url:"/add",templateUrl:"partials/admin/article/advertise/add.html",controller:"AdvertiseController",data:{title:"新增广告",slug:"list",name:"article.advertise.list.index"}},{name:"edit",url:"/:advertise_id",templateUrl:"partials/admin/article/advertise/edit.html",controller:"AdvertiseController",data:{title:"编辑广告",slug:"list",name:"article.advertise.list.index"}}]}]},{"abstract":!0,name:"feedback",url:"/feedback",template:'<div ui-view class="view-box slide-top"></div>',controller:"ArticleController",data:{title:"内容管理",slug:"feedback"},children:[{"abstract":!0,name:"list",url:"/list",template:'<div ui-view class="view-box slide-top"></div>',controller:"ArticleController",data:{title:"反馈管理",slug:"list"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/article/feedback/list.html",
controller:"FeedbackController",data:{title:"反馈列表",slug:"index"}},{name:"item",url:"/:feedback_id",templateUrl:"partials/admin/article/feedback/item.html",controller:"FeedbackController",data:{title:"反馈详情",slug:"list",name:"article.feedback.list.index"}}]}]}]}).state({name:"user",url:"/user",templateUrl:"partials/admin/user/index.html",controller:"UserController",data:{title:"用户",url:"/user",slug:"user"},children:[{"abstract":!0,name:"manage",url:"/manage",template:'<div ui-view class="view-box slide-top"></div>',controller:"UserController",data:{title:"用户管理",slug:"manage"},children:[{name:"list",url:"/list","abstract":!0,template:'<div ui-view class="view-box slide-top"></div>',controller:"UserController",data:{title:"用户管理",slug:"list"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/user/manage/list.html",controller:"UserController",data:{title:"用户列表",slug:"index"},children:[]},{name:"item",url:"/:user_id",templateUrl:"partials/admin/user/manage/item.html",controller:"UserController",data:{title:"用户详情",slug:"item",name:"user.manage.list.index"}}]},{name:"role",url:"/role","abstract":!0,template:'<div ui-view class="view-box slide-top"></div>',controller:"UserController",data:{title:"角色管理",url:"/user/manage/role",slug:"role"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/user/role/list.html",controller:"UserController",data:{title:"角色管理",url:"/user/manage/role/list",slug:"list"}},{name:"edit",url:"/:role_id",templateUrl:"partials/admin/user/role/permission-edit.html",controller:"UserController",data:{title:"角色权限管理",url:"/user/manage/role/:role_id",slug:"edit",name:"user.manage.role.list"}}]},{name:"permission",url:"/permission","abstract":!0,template:'<div ui-view class="view-box slide-top"></div>',controller:"UserController",data:{title:"权限管理",url:"/user/manage/permission",slug:"permission"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/user/permission/list.html",controller:"UserController",data:{title:"权限管理",url:"/user/manage/permission/list",slug:"list"}},{name:"edit",url:"/:permission_id",templateUrl:"partials/admin/user/permission/api-edit.html",controller:"UserController",data:{title:"权限API编辑",url:"/user/manage/permission/:permission_id",slug:"edit",name:"user.manage.permission.list"}}]},{name:"api",url:"/api","abstract":!0,template:'<div ui-view class="view-box slide-top"></div>',controller:"UserController",data:{title:"API管理",url:"/user/manage/api",slug:"api"},children:[{name:"list",url:"/list",templateUrl:"partials/admin/user/api/list.html",controller:"UserController",data:{title:"api管理",url:"/user/manage/api/list",slug:"list"}}]}]}]}).state({name:"config",url:"/config",templateUrl:"partials/admin/config/index.html",controller:"ConfigController",data:{title:"系统",url:"/config",slug:"config"},children:[{"abstract":!0,name:"system",url:"/system",template:'<div ui-view class="view-box slide-top"></div>',controller:"ConfigController",data:{title:"系统配置",url:"/config/system",slug:"system"},children:[{name:"group",url:"/group",templateUrl:"partials/admin/config/system/group.html",controller:"ConfigController",data:{title:"系统配置",url:"/config/system/group",slug:"group"}},{name:"manage",url:"/manage",templateUrl:"partials/admin/config/system/list.html",controller:"ConfigController",data:{title:"配置管理",url:"/config/system/manage",slug:"manage"}}]},{"abstract":!0,name:"usual",url:"/usual",template:'<div ui-view class="view-box slide-top"></div>',controller:"ConfigController",data:{title:"常用配置",url:"/config/usual",slug:"usual"},children:[{name:"index",url:"/index",templateUrl:"partials/admin/config/index/index.html",controller:"ConfigController",data:{title:"首页配置",url:"/config/usual/index",slug:"index"}},{name:"link",url:"/link",templateUrl:"partials/admin/config/link/index.html",controller:"ConfigController",data:{title:"友情链接配置",url:"/config/usual/link",slug:"link"}},{name:"partner",url:"/partner",templateUrl:"partials/admin/config/partner/index.html",controller:"ConfigController",data:{title:"入驻机构管理",url:"/config/usual/partner",slug:"partner"}},{name:"search",url:"/search",templateUrl:"partials/admin/config/search/index.html",controller:"ConfigController",data:{title:"搜索管理",url:"/config/usual/search",slug:"search"}}]},{"abstract":!0,name:"database",url:"/database",template:'<div ui-view class="view-box slide-top"></div>',controller:"ConfigController",data:{title:"数据库管理",url:"/config/database",slug:"database"},children:[{name:"export",url:"/export",templateUrl:"partials/admin/config/database/export.html",controller:"ConfigController",data:{title:"数据库备份",url:"/config/database/export",slug:"export"}},{name:"import",url:"/import",templateUrl:"partials/admin/config/database/import.html",controller:"ConfigController",data:{title:"数据库还原",url:"/config/database/import",slug:"import"}}]},{"abstract":!0,name:"log",url:"/log",template:'<div ui-view class="view-box slide-top"></div>',controller:"ConfigController",data:{title:"系统日志",url:"/config/log",slug:"log"},children:[{name:"action",url:"/action",templateUrl:"partials/admin/config/log/action.html",controller:"ConfigController",data:{title:"操作日志",url:"/config/log/action",slug:"action"}},{name:"sms",url:"/sms",templateUrl:"partials/admin/config/log/sms.html",controller:"SmsController",data:{title:"短信记录",url:"/config/log/sms",slug:"sms"}}]}]}).state({name:"login",url:"/login",views:{auth:{templateUrl:"partials/admin/auth/login.html"}},controller:"AuthController",data:{title:"登录",url:"/login",slug:"login",full:!0}}).state({name:"register",url:"/register",views:{auth:{templateUrl:"partials/admin/auth/register.html"}},controller:"AuthController",data:{title:"注册",url:"/register",slug:"register",full:!0}}).state({name:"forgot",url:"/forgot",views:{auth:{templateUrl:"partials/admin/auth/forgot.html"}},controller:"AuthController",data:{title:"找回密码",url:"/forgot",slug:"forgot",full:!0}}).state({name:"UI",url:"/ui",templateUrl:"partials/admin/index/ui.html",controller:"IndexController",data:{title:"UI-Demo",url:"/ui"}}),$locationProvider.html5Mode(!0),$httpProvider.interceptors.push(["$rootScope","$q","$localStorage","$location",function($rootScope,$q,$localStorage,$location){return{request:function(config){return config.url.contain("http://up.qiniu.com")||(config.headers=config.headers||{},$localStorage.token&&(config.headers.Authorization="Bearer "+$localStorage.token)),config},response:function(response){return 200==response.status,response||$q.when(response)},responseError:function(response){switch($rootScope.modal.closeLoading(),$rootScope.modal.close(),response.status){case 401:$location.path("/login");break;case 403:$rootScope.modal.error({message:"403! 无权访问API"});break;case 404:$rootScope.modal.error({message:"404 ERROR!"});break;case 422:$rootScope.modal.error({message:"422 ERROR!",message:response.message});break;case 500:$rootScope.modal.error({message:"500 ERROR!"})}return $q.reject(response)}}}])}]);var app=angular.module("app",["ui.router","ngStorage","ngResource","ngAnimate","angular.modal","angular.loading","AppRoutes","LayoutDirective","TotopDirective","TabsDirective","LoadingDirective","CollapseDirective","PaginationDirective","MainController","HeaderController","AsideController","AuthController","IndexController","UserController","ConfigController","CategoryController","CourseController","SectionController","TradeController","PaymentController","WithdrawController","OrganizationController","AnnouncementController","AuditController","ArticleController","NoteController","QuestionController","AdvertiseController","SmsController","FeedbackController","CommonProvider","AuthProvider","QuploadProvider","AuthService","TimeFilter","HtmlFilter"]).provider("appConfig",function(){var config={baseUrl:"http://admin.xtx.com",apiUrl:"/server/api/v1",fileUrl:"http://7xnbft.com2.z0.glb.qiniucdn.com/",staticUrl:"http://7xpb5v.com2.z0.glb.qiniucdn.com"};return{config:config,$get:function(){return config}}}).config(function($validationProvider,appConfigProvider){angular.extend($validationProvider,{validCallback:function(element){$(element).parents(".form-group:first").removeClass("has-error").addClass("has-success")},invalidCallback:function(element){$(element).parents(".form-group:first").addClass("has-error")}}),$validationProvider.setErrorHTML(function(msg){return'<i class="icon icon-error"></i>'+msg}),$validationProvider.setSuccessHTML(function(msg){return'<i class="icon icon-success"></i>'+msg})}).config(["cfpLoadingBarProvider",function(cfpLoadingBarProvider){cfpLoadingBarProvider.includeSpinner=!1,cfpLoadingBarProvider.latencyThreshold=10}]).run(["PermissionProvider","CommonProvider",function(PermissionProvider,CommonProvider){PermissionProvider.init(),CommonProvider.autoTop()}]);